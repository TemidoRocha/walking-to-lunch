/*! For license information please see officebrowserfeedback_floodgate_bare.min.js.LICENSE */
!function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=45)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(8);e.Api=i;var r=n(1);e.Utils=r;var o=n(5);e.FloodgateEngine=o.FloodgateEngine},function(t,e,n){"use strict";function i(t){return"[object Date]"===Object.prototype.toString.call(t)&&!isNaN(t.getTime())}function r(t){return null==t}function o(t){return"string"==typeof t}function a(t,n){if(!t)return null;if(n<0)return n=-n,this.addSecondsWithoutOverflow(t,n);var i=t.getTime()-1e3*n;return i>e.MIN_DATE_MILLISECONDS?new Date(i):new Date(e.MIN_DATE_MILLISECONDS)}Object.defineProperty(e,"__esModule",{value:!0}),e.timeAdd=function(t,e,n){switch(e.toLowerCase()){case"h":case"hour":return new Date(t.getTime()+36e5*n);case"m":case"minute":return new Date(t.getTime()+6e4*n);case"s":case"second":return new Date(t.getTime()+1e3*n);default:throw new Error("Invalid interval value of "+e)}},e.isDate=i,e.isEnumValue=function(t,e){return t in e},e.isNumber=function(t){return null!==t&&!isNaN(t)&&isFinite(t)},e.isNOU=r,e.isObject=function(t){return null!=t&&"object"==typeof t},e.isArray=function(t){return null!=t&&Array.isArray(t)},e.isString=o,e.isBoolean=function(t){return"boolean"==typeof t},e.getDistantPast=function(){return new Date(-116444736e5)},e.getDistantFuture=function(){return new Date(640922112e5)},e.MAX_DATE_MILLISECONDS=864e13,e.MIN_DATE_MILLISECONDS=-864e13,e.addSecondsWithoutOverflow=function(t,n){if(!t)return null;if(n<0)return a(t,-1*n);var i=t.getTime()+1e3*n;return i<e.MAX_DATE_MILLISECONDS?new Date(i):new Date(e.MAX_DATE_MILLISECONDS)},e.subtractSecondsWithoutOverflow=a;var s="^((?:[a-zA-Z]{2,3}(?:-[a-zA-Z]{3}){0,3})|(?:[a-zA-Z]{4,8}))(?:-([a-zA-Z]{4}))?(?:-([a-zA-Z]{2}|[0-9]{3}))?(-.*)?$";function u(t){if(!t)return null;var e=t.match(s);return!e||e.length<1||!r(e[4])?null:e[0]}function c(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}e.isValidLanguageSubTag=function(t){if(!t)return!1;var e=u(t);return!!e&&e===t},e.extractLanguageSubtag=u,e.guid=function(){return(c()+c()+"-"+c()+"-4"+c().substr(0,3)+"-"+c()+"-"+c()+c()+c()).toLowerCase()},e.makeArrayFromObjectValuesSortedByKeyString=function(t){var e=Object.keys(t);e.sort();var n=[];for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];n.push(t[r])}return n},e.stringToDate=function(t){if(!o(t))return null;var e=t?new Date(t):null;return i(e)?e:null},e.overrideValues=function(t,e){if(!e)return e;var n=e;if(t)for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},e.isUtcDatetimeString=function(t){return!!o(t)&&/^(\d{4}\-\d\d\-\d\dT\d\d:\d\d:\d\d(\.\d\d\d)?Z)$/.test(t)},e.dateToShortUtcString=function(t){if(!i(t))return null;function e(t){return t<10?"0"+t:t.toString()}return t.getUTCFullYear()+"-"+e(t.getUTCMonth()+1)+"-"+e(t.getUTCDate())+"T"+e(t.getUTCHours())+":"+e(t.getUTCMinutes())+":"+e(t.getUTCSeconds())+"Z"}},function(t,e,n){"use strict";var i;!function(t){!function(t){t[t.FloodgateSettings=0]="FloodgateSettings",t[t.SurveyActivationStats=1]="SurveyActivationStats",t[t.SurveyEventActivityStats=2]="SurveyEventActivityStats",t[t.CampaignDefinitions=3]="CampaignDefinitions",t[t.CampaignStates=4]="CampaignStates",t[t.GovernedChannelStates=5]="GovernedChannelStates",t[t.TmsCache_MessageMetadata=6]="TmsCache_MessageMetadata",t[t.TmsCache_UserGovernance=7]="TmsCache_UserGovernance",t[t.TmsCache_CampaignContent=8]="TmsCache_CampaignContent",t[t.Tms_DynamicSettings=9]="Tms_DynamicSettings",t[t.LogLevelSettings=10]="LogLevelSettings",t[t.UserFacts=11]="UserFacts"}(t.FileType||(t.FileType={}))}(i||(i={})),t.exports=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}var e,n,i,r,o,a,s,u,c,l,p,d,h,f,g,v,m,y,S,T,C,E,A,_,w,b,I,D,F,O,L,P,N;return t.CampaignState=((e=function(){}).Deserialize=((n=function(){}).Failed="FloodgateCore_CampaignState_Deserialize_Failed",n),e),t.FileBasedCampaignStateProvider=((i=function(){}).Load=((r=function(){}).Failed="FloodgateCore_FileBasedCampaignStateProvider_Load_Failed",r),i),t.HostBasedCampaignStateProvider=((o=function(){}).GetStatesFromHost=((a=function(){}).Failed="FloodgateCore_HostBasedCampaignStateProvider_GetStatesFromHost_Failed",a),o),t.Floodgate=((s=function(){}).Initialize=((u=function(){}).Failed="FloodgateCore_Floodgate_Initialize_Failed",u),s.Start=((c=function(){}).Failed="FloodgateCore_Floodgate_Start_Failed",c),s.UserFactsLoad=((l=function(){}).Failed="FloodgateCore_Floodgate_UserFactsLoad_Failed",l),s.UserFactsSpecDeserialization=((p=function(){}).Failed="FloodgateCore_Floodgate_UserFactsSpecDeserialization_Failed",p),s.UserFactsSpecIsAMatch=((d=function(){}).Failed="FloodgateCore_Floodgate_UserFactsSpecIsAMatch_Failed",d),s),t.FloodgateEngine=((h=function(){}).Make=((f=function(){}).Failed="FloodgateCore_FloodgateEngine_Make_Failed",f),h.Start=((g=function(){}).Failed="FloodgateCore_FloodgateEngine_Start_Failed",g),h.StartAsync=((v=function(){}).Failed="FloodgateCore_FloodgateEngine_StartAsync_Failed",v.Stopped="FloodgateCore_FloodgateEngine_StartAsync_Stopped",v),h.OnSurveyActivated=((m=function(){}).ActivationStatsSuppressedSurvey="FloodgateCore_FloodgateEngine_OnSurveyActivated_ActivationStatsSuppressedSurvey",m.ClosedChannelType="FloodgateCore_FloodgateEngine_OnSurveyActivated_ClosedChannelType",m),h),t.GovernedChannelState=((y=function(){}).Deserialize=((S=function(){}).Failed="FloodgateCore_GovernedChannelState_Deserialize_Failed",S),y),t.FileBasedGovernedChannelStateProvider=((T=function(){}).Load=((C=function(){}).Failed="FloodgateCore_FileBasedGovernedChannelStateProvider_Load_Failed",C),T),t.HostBasedGovernedChannelStateProvider=((E=function(){}).GetStatesFromHost=((A=function(){}).Failed="FloodgateCore_HostBasedGovernedChannelStateProvider_GetStatesFromHost_Failed",A),E),t.SurveyStatCollectionActivation=((_=function(){}).FromJson=((w=function(){}).Failed="FloodgateCore_SurveyStatCollectionActivation_FromJson_Failed",w),_.ToJson=((b=function(){}).Failed="FloodgateCore_SurveyStatCollectionActivation_ToJson_Failed",b),_),t.HostBasedSurveyActivationStatsProvider=((I=function(){}).GetSurveyStatsFromHost=((D=function(){}).Failed="FloodgateCore_HostBasedSurveyActivationStatsProvider_GetSurveyStatsFromHost_Failed",D),I),t.SurveyStatCollectionEventActivity=((F=function(){}).FromJson=((O=function(){}).Failed="FloodgateCore_SurveyStatCollectionEventActivity_FromJson_Failed",O),F.ToJson=((L=function(){}).Failed="FloodgateCore_SurveyStatCollectionEventActivity_ToJson_Failed",L),F),t.SurveyActivity=((P=function(){}).LogActivity=((N=function(){}).EventsReprocessed="FloodgateCore_SurveyActivity_LogActivity_EventsReprocessed",N),P),t}();e.TelemetryEvent=i},function(t,e,n){"use strict";var i;!function(t){!function(t){t[t.Feedback=0]="Feedback",t[t.Nps=1]="Nps",t[t.Psat=2]="Psat",t[t.Bps=3]="Bps",t[t.Fps=4]="Fps",t[t.Nlqs=5]="Nlqs",t[t.GenericMessagingSurface=12]="GenericMessagingSurface"}(t.Type||(t.Type={})),t.DOM_FEEDBACKSURVEY_TAGNAME="FeedbackSurvey",t.DOM_NPS_TAGNAME="Nps",t.DOM_PSAT_TAGNAME="Psat",t.DOM_BPS_TAGNAME="Bps",t.DOM_FPS_TAGNAME="Fps",t.DOM_NLQS_TAGNAME="Nlqs",t.LAUNCHER_TYPE_DEFAULT="survey"}(i||(i={})),t.exports=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(6),o=n(26),a=n(17),s=n(3),u=n(37),c=n(10),l=n(20),p=n(38),d=n(39),h=n(18),f=n(21),g=i.FileType,v=function(){function t(){}return t.prototype.log_TriggerMet=function(t,e,n){},t.prototype.log_UserSelected=function(t,e,n){},t.prototype.log_CampaignLoad_Failed=function(t){},t.prototype.log_Error=function(t,e){},t.prototype.log_Event=function(t,e){},t}(),m={run:function(t){},shouldAcceptActivity:function(t){return!0}},y=function(){function t(e,n,i,r,o,a,s,u){if(this.initializationStatus=0,this.candidateSurveys={},this.launchedSurveys={},this.launchedLaunchers=[],!e)throw new Error("surveyClient must not be null");if(!n)throw new Error("activityListener must not be null");if(!i)throw new Error("launcherFactory must not be null");if(!r)throw new Error("onSurveyActivatedCallback must not be null");if(!o)throw new Error("storage must not be null");if(!a)throw new Error("governor must not be null");if(!u)throw new Error("transporterFactory must not be null");this.surveyClient=e,this.activityListener=n,this.launcherFactory=i,this.onSurveyActivatedCallback=r,this.storage=o,this.governor=a,this.surveyActivationStatsProvider=s,t.transporterFactory=u,this.loggedFirstStart=!1,this.setPendingSurveys(null),this.activityListener.clearSurveys();var c=this;this.activityListener.setCallback({run:function(t){c.onSurveyActivated(t)},shouldAcceptActivity:function(t){return c.shouldAcceptActivity(t)}})}return t.setTelemetryLogger=function(e){if(!e)throw new Error("telemetryLogger must not be null");t.telemetryLogger=e},t.getTelemetryLogger=function(){return t.telemetryLogger},t.getTransportFactory=function(){return t.transporterFactory},t.make=function(e,n,i,u,c,f,g,v,y,S){try{var T=l.GovernedChannelStateProviderFactory.make(u,c),C=h.SurveyActivationStatsProviderFactory.make(u,c),E=a.CampaignStateProviderFactory.make(u,c);return y.push(new r.FileSystemCampaignDefinitionProvider(u)),new t(new o.CampaignManager(E,y,f,g,e,new Date,S),new d(m,this.getTelemetryLogger),n,i,u,new p.Governor(T),C,v)}catch(t){this.telemetryLogger.log_Event(s.TelemetryEvent.FloodgateEngine.Make.Failed,{ErrorMessage:t.toString()})}},t.prototype.mergeAndSave=function(){this.saveSettings(),this.saveSurveyActivationHistory(),this.saveSurveyEventActivityHistory(),this.surveyClient.saveCurrentState(),this.governor.saveChannelStates()},t.prototype.start=function(){if(2!==this.initializationStatus&&3!==this.initializationStatus)try{this.setInitializationStatus(2),this.loadSettingsAndPriorEventCounts();var e=this.getAvailableChannelTypes();this.surveyClient.refreshSurveyDefinitions(e),this.setPendingSurveysAndStartFloodgate(),this.setInitializationStatus(3)}catch(e){this.setInitializationStatus(1),t.getTelemetryLogger().log_Event(s.TelemetryEvent.FloodgateEngine.Start.Failed,{ErrorMessage:e&&e.toString()})}},t.prototype.startAsync=function(){if(2===this.initializationStatus||3===this.initializationStatus)return Promise.resolve();try{this.setInitializationStatus(2),this.loadSettingsAndPriorEventCounts();var e=this.getAvailableChannelTypes(),n=this;return new Promise((function(i,r){n.surveyClient.refreshSurveyDefinitionsAsync(e).then((function(){4===n.initializationStatus?(n.setInitializationStatus(3),n.stop(),t.getTelemetryLogger().log_Event(s.TelemetryEvent.FloodgateEngine.StartAsync.Stopped,{ErrorMessage:"Stopped because of a pending stop() call"})):n.setPendingSurveysAndStartFloodgate(),i()})).catch((function(e){n.setInitializationStatus(1),t.getTelemetryLogger().log_Event(s.TelemetryEvent.FloodgateEngine.StartAsync.Failed,{ErrorMessage:e&&e.message}),r(e)}))}))}catch(e){return this.setInitializationStatus(1),t.getTelemetryLogger().log_Event(s.TelemetryEvent.FloodgateEngine.StartAsync.Failed,{ErrorMessage:e&&e.toString()}),Promise.resolve()}},t.prototype.stop=function(){3===this.initializationStatus&&(this.mergeAndSave(),this.setPendingSurveys(null),this.updateActivityListenerWithCurrentSurveyDefinitions()),this.setInitializationStatus(4)},t.prototype.getActivityListener=function(){return this.activityListener},t.prototype.setInitializationStatus=function(t){this.initializationStatus=t},t.prototype.saveSettings=function(){this.storage.fileLock(g.FloodgateSettings);try{this.writeString(g.FloodgateSettings,u.FloodgateSettings.toJson(this.floodgateSettings))}finally{this.storage.fileUnlock(g.FloodgateSettings)}},t.prototype.loadSettingsAndPriorEventCounts=function(){this.floodgateSettings=u.FloodgateSettings.fromJson(this.readString(g.FloodgateSettings)),this.previousSurveyActivationStats=this.surveyActivationStatsProvider.load(),this.previousSurveyEventActivityStats=f.SurveyStatCollectionEventActivity.fromJson(this.readString(g.SurveyEventActivityStats))},t.prototype.getAvailableChannelTypes=function(){var t=this.governor.getAvailableChannelData(),e=[];return t.forEach((function(t){t&&e.push(t.getType())})),e},t.prototype.setPendingSurveysAndStartFloodgate=function(){this.setPendingSurveys(this.surveyClient.getAppSurveys()),this.updateActivityListenerWithCurrentSurveyDefinitions(),this.setInitializationStatus(3),this.loggedFirstStart||(this.loggedFirstStart=!0,this.getActivityListener().logActivity(d.FloodgateStartActivityName))},t.prototype.saveSurveyActivationHistory=function(){this.storage.fileLock(g.SurveyActivationStats);try{var t=this.surveyActivationStatsProvider.load(),e=new h.SurveyStatCollectionActivation;for(var n in this.launchedSurveys)if(this.launchedSurveys.hasOwnProperty(n)){var i=new h.SurveyActivationStats,r=this.launchedSurveys[n];i.Type=r.getType(),i.ExpirationTimeUtc=r.getSurveyInfo().getExpirationTimeUtc(),i.ActivationTimeUtc=new Date,e.addStats(r.getSurveyInfo().getId(),i)}t.accumulate(e),this.surveyActivationStatsProvider.save(t),this.previousSurveyActivationStats=t}finally{this.storage.fileUnlock(g.SurveyActivationStats)}},t.prototype.saveSurveyEventActivityHistory=function(){this.storage.fileLock(g.SurveyEventActivityStats);try{var t=f.SurveyStatCollectionEventActivity.fromJson(this.readString(g.SurveyEventActivityStats)),e=new Date,n=new f.SurveyStatCollectionEventActivity,i=function(t){if(r.candidateSurveys.hasOwnProperty(t)){var i=new f.SurveyEventActivityStats,o=r.candidateSurveys[t];if(!o.getSurveyInfo().isActiveForDate(e))return"continue";i.ExpirationTimeUtc=o.getSurveyInfo().getExpirationTimeUtc();var a=o.getSurveyInfo().getActivationEvent().getTrackingSet(),s=[];if(a.getList().forEach((function(t){t&&t.getIsAggregate()&&s.push(t.getActivity())})),0===s.length)return"continue";i.Counts=new Array(s.length);for(var u=0;u<s.length;u++)i.Counts[u]=r.activityListener.moveSessionCountIntoBaseCount(s[u]);n.addStats(o.getSurveyInfo().getId(),i)}},r=this;for(var o in this.candidateSurveys)i(o);t.accumulate(n),this.writeString(g.SurveyEventActivityStats,f.SurveyStatCollectionEventActivity.toJson(t)),this.previousSurveyEventActivityStats=t}finally{this.storage.fileUnlock(g.SurveyEventActivityStats)}},t.prototype.setPendingSurveys=function(t){if(this.candidateSurveys={},t)for(var e in t)if(t.hasOwnProperty(e)){var n=t[e];this.launcherFactory.AcceptsSurvey(n)&&(this.candidateSurveys[e]=n)}},t.prototype.updateActivityListenerWithCurrentSurveyDefinitions=function(){var e=new Array;for(var n in this.candidateSurveys)if(this.candidateSurveys.hasOwnProperty(n)){var i=this.candidateSurveys[n];if(this.previousSurveyActivationStats.getBySurveyId(i.getSurveyInfo().getId()))continue;if(!i.getSurveyInfo().isActiveForDate(new Date))continue;t.telemetryLogger.log_UserSelected(i.getSurveyInfo().getBackEndId(),i.getSurveyInfo().getId(),i.getType()),e.push(i)}this.activityListener.setSurveys(e,this.previousSurveyEventActivityStats)},t.prototype.shouldAcceptActivity=function(t){return 3===this.initializationStatus||t===d.FloodgateStartActivityName},t.prototype.onSurveyActivated=function(e){t.telemetryLogger.log_TriggerMet(e.getSurveyInfo().getBackEndId(),e.getSurveyInfo().getId(),e.getType());var n=!1,i=e.getSurveyInfo().getGovernedChannelType();if(this.candidateSurveys[e.getSurveyInfo().getId()])if(e.getSurveyInfo().isActiveForDate(new Date)){if(this.governor.refreshChannelData(),this.governor.isChannelOpen(i))this.surveyActivationStatsProvider.load().getBySurveyId(e.getSurveyInfo().getId())?t.getTelemetryLogger().log_Event(s.TelemetryEvent.FloodgateEngine.OnSurveyActivated.ActivationStatsSuppressedSurvey,{CampaignId:e.getSurveyInfo().getBackEndId(),SurveyId:e.getSurveyInfo().getId()}):0===Object.keys(this.launchedSurveys).length&&(this.launchedSurveys[e.getSurveyInfo().getId()]=e,n=!0);else t.getTelemetryLogger().log_Event(s.TelemetryEvent.FloodgateEngine.OnSurveyActivated.ClosedChannelType,{ClosedChannelType:c.GovernedChannelType[i]})}else;else;this.mergeAndSave(),this.activityListener.clearSurveys(),n&&(this.governor.startChannelCooldown(i),this.surveyClient.onSurveyActivated(e.getSurveyInfo()),this.launchLauncher(e))},t.prototype.readString=function(t){return this.storage.read(t)},t.prototype.writeString=function(t,e){this.storage.write(t,e)},t.prototype.launchLauncher=function(t){var e=this.launcherFactory.makeSurveyLauncher(t);e&&(this.launchedLaunchers.push(e),this.onSurveyActivatedCallback.onSurveyActivated(e,t))},t.telemetryLogger=new v,t}();e.FloodgateEngine=y},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),a=n(5),s=n(10),u=n(1),c=n(42),l=u.getDistantFuture,p=u.isBoolean,d=u.isNOU,h=u.isNumber,f=u.isString,g=u.isUtcDatetimeString,v=u.stringToDate,m=function(){function t(){}return t.deserialize=function(t){var e;return t&&0===t.Type&&(e=y.deserialize(t)),void 0===e?null:e},t.prototype.validate=function(){return!0},t}();e.CampaignLanguageRange=m;var y=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return t&&(n.languageSubTag=t.Value),n.validate()?n:null},e.prototype.isInRange=function(t){if(d(t))return!1;var e=u.extractLanguageSubtag(t);return!d(e)&&e.toLocaleUpperCase()===this.languageSubTag.toLocaleUpperCase()},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&(!(d(this.languageSubTag)||!f(this.languageSubTag))&&!!u.isValidLanguageSubTag(this.languageSubTag))},e}(m);e.CampaignLanguageRangeLanguageSubtag=y;var S=function(){function t(){}return t.deserialize=function(t){var e;if(d(t))return null;switch(t.Type){case 0:e=T.deserialize(t);break;case 1:e=C.deserialize(t);break;case 2:e=E.deserialize(t);break;case 3:e=A.deserialize(t)}return void 0===e?null:e},t.prototype.validate=function(){return!0},t}();e.CampaignScope=S;var T=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){return new e},e.prototype.isInScope=function(){return!0},e.prototype.validate=function(){return!!t.prototype.validate.call(this)},e}(S);e.CampaignScopeAny=T;var C=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e,i=[];if(d(t))return null;for(var r in t.Languages)if(t.Languages.hasOwnProperty(r)){var o=t.Languages[r];o&&i.push(m.deserialize(o))}return 0===i.length&&(i=null),n.languageRanges=i,n.validate()?n:null},e.prototype.setEnvironmentProvider=function(t){this.environmentProvider=t},e.prototype.isInScope=function(){if(d(this.languageRanges))return!0;if(d(this.environmentProvider)||!this.environmentProvider.getLanguage())return!1;var t=this.environmentProvider.getLanguage();for(var e in this.languageRanges){if(this.languageRanges.hasOwnProperty(e))if(this.languageRanges[e].isInRange(t))return!0}return!1},e.prototype.validate=function(){if(!t.prototype.validate.call(this))return!1;if(this.languageRanges)for(var e in this.languageRanges)if(this.languageRanges.hasOwnProperty(e)&&!this.languageRanges[e])return!1;return!0},e}(S);e.CampaignScopeEnvironmentCrossProduct=C;var E=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return n.userFacts=c.deserializeUserFacts(t),n.validate()?n:null},e.prototype.setUserFactsProvider=function(t){this.userFactsProvider=t},e.prototype.isInScope=function(){var t=this;return!!d(this.userFacts)||!!this.userFactsProvider&&this.userFacts.some((function(e){var n=t.userFactsProvider.getUserFact(e.getName());return e.isAMatch(n)}))},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&c.validateUserFacts(this.userFacts)},e}(S);e.CampaignScopeUserFactAny=E;var A=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return n.userFacts=c.deserializeUserFacts(t),n.validate()?n:null},e.prototype.setUserFactsProvider=function(t){this.userFactsProvider=t},e.prototype.isInScope=function(){var t=this;return!!d(this.userFacts)||!!this.userFactsProvider&&this.userFacts.every((function(e){var n=t.userFactsProvider.getUserFact(e.getName());return e.isAMatch(n)}))},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&c.validateUserFacts(this.userFacts)},e}(S);e.CampaignScopeUserFactAll=A;var _=function(){function t(){}return t.deserialize=function(t){var e;if(d(t))return null;switch(t.Type){case 0:e=w.deserialize(t);break;case 1:e=b.deserialize(t)}return void 0===e?null:e},t.prototype.validate=function(){return!0},t}();e.CampaignDuration=_;var w=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return t&&(n.intervalSeconds=t.IntervalSeconds),n.validate()?n:null},e.prototype.asTimeIntervalSeconds=function(){return this.intervalSeconds},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&!!h(this.intervalSeconds)},e}(_);e.CampaignDurationTimeInterval=w;var b=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){return new e},e.prototype.asTimeIntervalSeconds=function(){return null},e}(_);e.CampaignDurationSingleBuildChange=b;var I=function(){function t(){}return t.deserialize=function(e){var n=new t;if(!d(e)){n.additionalData=[];for(var i=0,r=e;i<r.length;i++){"EmailAddress"===r[i]&&n.additionalData.push(0)}}return n.validate()?n:null},t.prototype.validate=function(){return!d(this.additionalData)},t}();e.CampaignAdditionalDataRequested=I;var D=function(){function t(){}return t.deserialize=function(t){var e;return t&&0===t.Type&&(e=F.deserialize(t)),void 0===e?null:e},t.prototype.validate=function(){return!0},t}();e.CampaignDistribution=D;var F=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return t&&(n.maxDelaySeconds=t.MaxDelaySeconds,n.chunks=t.Chunks),n.validate()?n:null},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&(!(!h(this.maxDelaySeconds)||this.maxDelaySeconds<0)&&!(!h(this.chunks)||this.chunks<0))},e}(D);e.CampaignDistributionRamp=F;var O=function(){function t(){}return t.deserialize=function(t){var e;return t&&0===t.Type&&(e=L.deserialize(t)),void 0===e?null:e},t.prototype.getActiveSurveyTimeIntervalSeconds=function(){var t=this.nominationPeriod.asTimeIntervalSeconds();return h(t)?t:this.fallbackSurveyDurationSeconds},t.prototype.calculateSurveyStartTimeFromDate=function(t){return t||new Date},t.prototype.calculateSurveyExpirationTimeFromSurveyStartTime=function(t){return t=t||new Date,u.addSecondsWithoutOverflow(t,this.getActiveSurveyTimeIntervalSeconds())},t.prototype.getCampaignCooldown=function(t){return t?this.cooldownPeriod:this.nominationPeriod},t.prototype.validate=function(){return!d(this.nominationPeriod)&&(d(this.cooldownPeriod)&&(this.cooldownPeriod=this.nominationPeriod),!(!h(this.nominationPeriod.asTimeIntervalSeconds())&&(!h(this.fallbackSurveyDurationSeconds)||this.fallbackSurveyDurationSeconds<=0)))},t}();e.CampaignNominationScheme=O;var L=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return d(t)?null:(t.DistributionModel&&(n.distributionModel=D.deserialize(t.DistributionModel)),t.CooldownPeriod&&(n.cooldownPeriod=_.deserialize(t.CooldownPeriod)),t.NominationPeriod&&(n.nominationPeriod=_.deserialize(t.NominationPeriod)),n.fallbackSurveyDurationSeconds=t.FallbackSurveyDurationSeconds,n.percentageDenominator=t.PercentageDenominator,n.percentageNumerator=t.PercentageNumerator,n.validate()?n:null)},e.prototype.evaluateNominationRules=function(){var t=Math.random();return Math.floor(t*this.percentageDenominator)<this.percentageNumerator},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&(!(!h(this.percentageDenominator)||!h(this.percentageNumerator))&&(!(this.percentageDenominator<=0||this.percentageNumerator<0)&&!(this.percentageNumerator>this.percentageDenominator)))},e}(O);e.CampaignNominationSchemeRatioPercentage=L;var P=function(){function t(){}return t.deserialize=function(t){var e;if(d(t))return null;switch(t.Type){case 0:e=N.deserialize(t);break;case 1:e=U.deserialize(t)}return void 0===e?null:e},t.prototype.validate=function(){return!0},t}();e.CampaignSurveyEvent=P;var N=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return d(t)?null:(n.activity=t.Activity,n.count=t.Count,n.isAggregate=t.IsAggregate,n.validate()?n:null)},e.prototype.validate=function(){return!!t.prototype.validate.call(this)&&(!(d(this.activity)||!f(this.activity))&&(!(!h(this.count)||this.count<=0)&&!!p(this.isAggregate)))},e}(P);e.CampaignSurveyEventCountedActivity=N;var U=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e,i=[];if(d(t))return null;for(var r in t.Sequence)if(t.Sequence.hasOwnProperty(r)){var o=t.Sequence[r];o&&i.push(N.deserialize(o))}return 0===i.length&&(i=null),n.sequence=i,n.validate()?n:null},e.prototype.validate=function(){if(!t.prototype.validate.call(this))return!1;if(d(this.sequence))return!1;for(var e in this.sequence)if(this.sequence.hasOwnProperty(e)&&!this.sequence[e])return!1;return!0},e}(P);e.CampaignSurveyEventCountedActivitySequence=U;var M=function(){function t(){}return t.deserialize=function(e,n){var i=new t;return d(e)?null:(i.prompt=k.deserialize(e.Prompt),i.rating=R.deserialize(e.Rating),i.comment=x.deserialize(e.Question),i.multipleChoice=B.deserialize(e.MultipleChoice),i.validate(n)?i:null)},t.prototype.validate=function(t){return!d(this.prompt)&&(t?!d(this.rating)||!d(this.multipleChoice)||!d(this.comment):!d(this.rating)&&!d(this.comment))},t}();e.CampaignSurveyContent=M;var B=function(){function t(){}return t.deserialize=function(e){var n=new t;return d(e)?null:(n.question=e.Question,n.availableOptions=e.AvailableOptions,n.minNumberOfSelectedOptions=e.MinNumberOfSelectedOptions,n.maxNumberOfSelectedOptions=e.MaxNumberOfSelectedOptions,n.validate()?n:null)},t.prototype.validate=function(){if(d(this.question)||!f(this.question)||d(this.availableOptions)||!Array.isArray(this.availableOptions)||this.availableOptions.length<2||d(this.minNumberOfSelectedOptions)||!h(this.minNumberOfSelectedOptions)||d(this.maxNumberOfSelectedOptions)||!h(this.maxNumberOfSelectedOptions))return!1;for(var t in this.availableOptions)if(this.availableOptions.hasOwnProperty(t)&&!f(this.availableOptions[t]))return!1;return!0},t}();e.CampaignSurveyContentMultipleChoice=B;var k=function(){function t(){}return t.deserialize=function(e){var n=new t;return d(e)?null:(n.title=e.Title,n.question=e.Question,n.yesLabel=e.YesLabel,n.noLabel=e.NoLabel,n.validate()?n:null)},t.prototype.validate=function(){return!(d(this.title)||!f(this.title)||d(this.question)||!f(this.question)||d(this.yesLabel)||!f(this.yesLabel)||d(this.noLabel)||!f(this.noLabel))},t}();e.CampaignSurveyContentPrompt=k;var R=function(){function t(){}return t.deserialize=function(e){var n=new t;return d(e)?null:(n.isZeroBased=e.IsZeroBased,n.question=e.Question,n.ratingValuesAscending=e.RatingValuesAscending,n.validate()?n:null)},t.prototype.validate=function(){if(d(this.question)||!f(this.question)||d(this.ratingValuesAscending)||!Array.isArray(this.ratingValuesAscending)||this.ratingValuesAscending.length<2||this.ratingValuesAscending.length>11)return!1;if(d(this.isZeroBased))this.isZeroBased=!1;else if(!p(this.isZeroBased))return!1;for(var t in this.ratingValuesAscending)if(this.ratingValuesAscending.hasOwnProperty(t)&&!f(this.ratingValuesAscending[t]))return!1;return!0},t}();e.CampaignSurveyContentRating=R;var x=function(){function t(){}return t.deserialize=function(e){var n=new t;return d(e)?null:(n.question=e.Question,n.validate()?n:null)},t.prototype.validate=function(){return!(d(this.question)||!f(this.question))},t}();e.CampaignSurveyContentComment=x;var V=function(){function t(){}return t.deserialize=function(e){if(d(e))return null;var n=new t;return n.contentMetadata=e.ContentMetadata,n.validate()?n:null},t.prototype.validate=function(){return!(d(this.contentMetadata)||!u.isObject(this.contentMetadata))},t}();e.CampaignSurveyMetadata=V;var G=function(){function t(){}return t.deserialize=function(t){var e;if(d(t))return null;switch(t.Type){case 0:e=J.deserialize(t);break;case 1:e=W.deserialize(t);break;case 2:e=z.deserialize(t);break;case 3:e=q.deserialize(t);break;case 4:e=j.deserialize(t);break;case 22:e=H.deserialize(t)}return void 0===e?null:e},t.prototype.validate=function(){return!d(this.activationEvent)},t}();e.CampaignSurveyTemplate=G;var z=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return d(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.content=M.deserialize(t.Content,!0),n.validate()?n:null)},e.prototype.validate=function(){return!(!t.prototype.validate.call(this)||d(this.content))},e}(G);e.CampaignSurveyTemplateFps=z;var q=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return d(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.content=M.deserialize(t.Content),n.validate()?n:null)},e.prototype.validate=function(){return!(!t.prototype.validate.call(this)||d(this.content))},e}(G);e.CampaignSurveyTemplateNlqs=q;var j=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return d(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.content=M.deserialize(t.Content),n.validate()?n:null)},e.prototype.validate=function(){return!(!t.prototype.validate.call(this)||d(this.content))},e}(G);e.CampaignSurveyTemplateNps=j;var J=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return d(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.validate()?n:null)},e.prototype.validate=function(){return!!t.prototype.validate.call(this)},e}(G);e.CampaignSurveyTemplateNps5PointStatic=J;var W=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){var n=new e;return d(t)?null:(n.activationEvent=P.deserialize(t.ActivationEvent),n.validate()?n:null)},e.prototype.validate=function(){return!!t.prototype.validate.call(this)},e}(G);e.CampaignSurveyTemplateNps11PointStatic=W;var H=function(t){function e(){return t.call(this)||this}return r(e,t),e.deserialize=function(t){if(d(t))return null;var n=new e;return n.activationEvent=P.deserialize(t.ActivationEvent),n.metadata=V.deserialize(t.Metadata),n.validate()?n:null},e.prototype.validate=function(){return!(!t.prototype.validate.call(this)||d(this.metadata))},e}(G);e.CampaignSurveyTemplateGenericMessagingSurface=H;var K=function(){function t(){}return t.deserialize=function(e){var n=new t;if(d(e))return null;n.campaignId=e.CampaignId,n.governedChannelType=e.GovernedChannelType,n.startTime=e.StartTimeUtc,n.endTime=e.EndTimeUtc,n.launcherType=e.LauncherType;var i=I.deserialize(e.AdditionalDataRequested);return n.additionalDataRequested=i?i.additionalData:[],e.SurveyTemplate&&(n.surveyTemplate=G.deserialize(e.SurveyTemplate)),e.NominationScheme&&(n.nominationScheme=O.deserialize(e.NominationScheme)),e.Scope&&(n.scope=S.deserialize(e.Scope)),n.validate()?n:null},t.prototype.validate=function(){if(d(this.scope)&&(this.scope=new T),d(this.campaignId)||!f(this.campaignId))return!1;if(!h(this.governedChannelType)||!u.isEnumValue(this.governedChannelType,s.GovernedChannelType))return!1;if(d(this.nominationScheme))return!1;if(d(this.surveyTemplate))return!1;if(!d(this.launcherType)&&!f(this.launcherType))return!1;if(d(this.startTime))this.startTime=l();else{if(!g(this.startTime))return!1;this.startTime=v(this.startTime)}if(d(this.endTime))this.endTime=l();else{if(!g(this.endTime))return!1;this.endTime=v(this.endTime)}return!0},t}();function Y(t){var e=[];if(d(t))return{result:e,error:"Empty"};if(!Array.isArray(t))return{result:e,error:"Not an array"};for(var n=[],i=0;i<t.length;i++){var r=t[i];if(r){var o=K.deserialize(r);o?e.push(o):n.push(i)}else n.push(i)}return{result:e,error:n.length>0?"Invalid campaign definitions at indexes: "+n.toString():void 0}}e.CampaignDefinition=K,e.FilterValidCampaignDefinitions=Y;var Q=function(){function t(t){if(d(t))throw new Error("storage must not be null");this.storage=t}return t.prototype.load=function(){var t,e=this.storage.read(o.FileType.CampaignDefinitions);if(d(e))return[];try{t=JSON.parse(e)}catch(t){return a.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed(t.toString()),[]}return Y(t).result},t.prototype.loadAsync=function(){var t=this.load();return new Promise((function(e,n){e(t)}))},t}();e.FileSystemCampaignDefinitionProvider=Q},function(t,e,n){"use strict";var i;!function(t){t.DOM_PROMPT_TAGNAME="Prompt",t.DOM_COMMENT_TAGNAME="Comment",t.DOM_RATING_TAGNAME="Rating",t.DOM_MULTIPLECHOICE_TAGNAME="MultipleChoice",t.JSON_PROMPT_KEYNAME="prompt",t.JSON_PROMPTTITLE_KEYNAME="title",t.JSON_PROMPTYESTEXT_KEYNAME="yesButtonText",t.JSON_PROMPTNOTEXT_KEYNAME="noButtonText",t.JSON_COMMENT_KEYNAME="comment",t.JSON_RATING_KEYNAME="rating",t.JSON_RATINGOPTIONS_KEYNAME="options",t.JSON_QUESTION_KEYNAME="question",t.JSON_MULTIPLECHOICE_KEYNAME="multipleChoice",t.JSON_APPLICATION_KEYNAME="application",t.JSON_EXTENDEDMANIFESTDATA_KEYNAME="extendedManifestData",t.JSON_SURVEYSTRINGS_KEYNAME="surveyStrings",t.JSON_SURVEYSPECIFICDATA_KEYNAME="surveySpecificData"}(i||(i={})),t.exports=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(16);e.ISurveyInfo=i;var r=n(24);e.IActivityListener=r;var o=n(25);e.IFloodgateSettingIdMap=o;var a=n(2);e.IFloodgateStorageProvider=a;var s=n(4);e.ISurvey=s;var u=n(7);e.ISurveyComponent=u;var c=n(6);e.CampaignDefinition=c.CampaignDefinition},function(t,e,n){"use strict";var i=n(4),r=n(10),o=n(16),a=n(1),s=a.getDistantFuture,u=a.getDistantPast,c=a.isNOU,l=a.isDate,p=function(){function t(t){if(c(t))throw new Error("data must not be null");if(c(t.id)||""===t.id)throw new Error("data.id must not be null or empty");if(c(t.governedChannelType)&&(t.governedChannelType=r.GovernedChannelType.getDefault()),c(t.expirationTimeUtc)||""===t.expirationTimeUtc)throw new Error("data.expirationTimeUtc must not be null or empty");if(c(t.activationEvent))throw new Error("data.activationEvent must not be null");(c(t.backEndIdentifier)||""===t.backEndIdentifier)&&(t.backEndIdentifier=t.id),c(t.launcherType)&&(t.launcherType=i.LAUNCHER_TYPE_DEFAULT),this.data=t}return t.prototype.getId=function(){return this.data.id},t.prototype.getBackEndId=function(){return this.data.backEndIdentifier},t.prototype.getGovernedChannelType=function(){return this.data.governedChannelType},t.prototype.getRawStartTimeUtc=function(){return this.data.startTimeUtc},t.prototype.getStartTimeUtc=function(){if(c(this.data.startTimeUtc))return u();var t=new Date(this.data.startTimeUtc);return l(t)?t:s()},t.prototype.getExpirationTimeUtc=function(){if(c(this.data.expirationTimeUtc))return u();var t=new Date(this.data.expirationTimeUtc);return l(t)?t:u()},t.prototype.getRawExpirationTimeUtc=function(){return this.data.expirationTimeUtc},t.prototype.isActiveForDate=function(t){return!c(t)&&(t>=this.getStartTimeUtc()&&t<=this.getExpirationTimeUtc())},t.prototype.getActivationEvent=function(){return this.data.activationEvent},t.prototype.getPreferredLaunchType=function(){return this.data.preferredLaunchType},t.prototype.isAdditionalDataRequested=function(t){if(c(this.data.additionalDataRequested))return!1;for(var e=0,n=this.data.additionalDataRequested;e<n.length;e++){if(n[e]===t)return!0}return!1},t.prototype.getLauncherType=function(){return this.data.launcherType},t.prototype.getMetadata=function(){return this.data.metadata},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(o.DOM_TYPE_TAGNAME);e.appendChild(t.createTextNode(o.DOM_TYPE_VALUE));var n=t.createElement(o.DOM_ID_TAGNAME);return n.appendChild(t.createTextNode(this.getBackEndId())),[e,n]},t.prototype.getJsonElements=function(){var t={};t[o.JSON_ID_KEYNAME]=this.getBackEndId();var e={};return e[o.JSON_SURVEY_KEYNAME]=t,e},t}();!function(t){var e=function(){this.preferredLaunchType="Default"};t.SurveyDataSourceData=e}(p||(p={})),t.exports=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i,r=n(1);!function(t){t[t.Standard=0]="Standard",t[t.Urgent=1]="Urgent",t[t.Banner=2]="Banner",t[t.TeachingMessage=3]="TeachingMessage"}(i=e.GovernedChannelType||(e.GovernedChannelType={})),function(t){t.getDefault=function(){return t.Standard}}(i=e.GovernedChannelType||(e.GovernedChannelType={}));var o=function(){function t(t,e,n,o){if(!r.isEnumValue(t,i))throw new Error("type is not a valid GovernedChannelType");if(!e)throw new Error("name must not be null or empty");if(n<0)throw new Error("cooldownSeconds must not be negative");this.type=t,this.name=e,this.cooldownSeconds=n,this.setCooldownStartTime(o)}return t.prototype.setCooldownStartTime=function(t){this.cooldownStartTime=t,r.isNOU(this.cooldownStartTime)?this.cooldownEndTime=r.getDistantPast():this.cooldownEndTime=r.addSecondsWithoutOverflow(this.cooldownStartTime,this.cooldownSeconds)},t.prototype.isOpen=function(){return this.isOpenAtDate(new Date)},t.prototype.isOpenAtDate=function(t){return!!t&&t>this.cooldownEndTime},t.prototype.getType=function(){return this.type},t.prototype.getName=function(){return this.name},t.prototype.getCooldownSeconds=function(){return this.cooldownSeconds},t.prototype.getCooldownStartTime=function(){return this.cooldownStartTime},t.prototype.getCooldownEndTime=function(){return this.cooldownEndTime},t}();e.GovernedChannel=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),r=n(5),o=function(){function t(){}return t.prototype.getCampaignId=function(){return this.getSurveyInfo().getBackEndId()},t.prototype.getLauncherType=function(){return this.getSurveyInfo().getLauncherType()},t.prototype.submit=function(){var t=i.Type[this.getType()],e=r.FloodgateEngine.getTransportFactory().makeTransporter(t);e.setManifestValues(this.getJsonElements()),e.submit()},t}();e.Survey=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(18),r=function(){function t(){this.items={},this.itemCount=0}return t.prototype.add=function(t,e){this.items[t]||this.itemCount++,this.items[t]=e},t.prototype.find=function(t){return this.items[t]},t.prototype.remove=function(t){var e=this.items[t];return e&&(delete this.items[t],this.itemCount--),e},t.prototype.count=function(){return this.itemCount},t}();e.ItemCollection=r,e.extractSettingItemValueSubString=function(t){if(!t)return t;var e=t.indexOf(o)+o.length,n=t.indexOf(a);return e<0||n<0?t:t.substring(e,n)},e.makeSettingItemValue=function(t){return t?o+t+a:o+a},e.MergeAndUpdateGovernedChannelStates=function(t,e){var n=new r;if(!t&&!e)return n;if(!t)return n.add(0,e),n;if(!e)return n.add(0,t),n.add(1,t),n;var i=[],o=[];return t&&t.forEach((function(t){for(var n,r=-1,a=0;a<e.length;a++)if((n=e[a]).getType()===t.getType()){r=a;break}if(-1===r)return i.push(t),void o.push(t);t.getCooldownStartTime()>n.getCooldownStartTime()?(i.push(t),o.push(t)):i.push(n),e.splice(r,1)})),e&&e.forEach((function(t){i.push(t)})),n.add(0,i),o.length>0&&n.add(1,o),n},e.MergeAndUpdateCampaignStates=function(t,e){var n=new r;if(!t&&!e)return n;if(!t)return n.add(0,e),n;if(!e)return n.add(0,t),n.add(1,t),n;var i=[],o=[];return t&&t.forEach((function(t){for(var n,r=new Date,a=-1,s=0;s<e.length;s++)if((n=e[s]).CampaignId===t.CampaignId){a=s;break}return-1===a?(i.push(t),void o.push(t)):n.LastCooldownEndTimeUtc>r?(i.push(n),void e.splice(a,1)):t.LastCooldownEndTimeUtc>r?(i.push(t),o.push(t),void e.splice(a,1)):(t.getCooldownStartDate()>n.getCooldownStartDate()||t.getCooldownStartDate()===n.getCooldownStartDate()&&t.LastNominationTimeUtc>n.LastNominationTimeUtc?(i.push(t),o.push(t)):i.push(n),void e.splice(a,1))})),e&&e.forEach((function(t){i.push(t)})),n.add(0,i),o.length>0&&n.add(1,o),n},e.MergeAndUpdateSurveyActivationStats=function(t,e){var n=new r;if(!t&&!e)return n;if(!t)return n.add(0,e),n;if(!e)return n.add(0,t),n.add(1,t),n;var o=new i.SurveyStatCollectionActivation,a=new i.SurveyStatCollectionActivation,s=t.getStats(),u=e.getStats();for(var c in s)if(s.hasOwnProperty(c)){var l=u[c];if(!l){o.addStats(c,s[c]),a.addStats(c,s[c]);continue}s[c].ActivationTimeUtc>l.ActivationTimeUtc?(o.addStats(c,s[c]),a.addStats(c,s[c])):o.addStats(c,u[c]),delete u[c]}for(var c in u)u.hasOwnProperty(c)&&o.addStats(c,u[c]);n.add(0,o);var p=a.getStats();for(var d in p)if(p.hasOwnProperty(d)){n.add(1,a);break}return n};var o="<data>",a="</data>"},function(t,e,n){"use strict";var i=n(7),r=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.question)throw new Error("data.question must not be null or empty");this.data=t,this.userComment=""}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getType=function(){return"Comment"},t.prototype.getQuestion=function(){return this.data.question},t.prototype.setSubmittedText=function(t){this.userComment=t},t.prototype.getSubmittedText=function(){return this.userComment},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(i.DOM_COMMENT_TAGNAME);return e.appendChild(t.createTextNode(this.getSubmittedText())),[e]},t.prototype.getJsonElements=function(){var t={};return t[i.JSON_COMMENT_KEYNAME]=this.getSubmittedText(),t},t.prototype.getComponentJson=function(){var t;return(t={})[i.JSON_QUESTION_KEYNAME]=this.getQuestion(),t},t}();!function(t){var e=function(){};t.CommentComponentData=e}(r||(r={})),t.exports=r},function(t,e,n){"use strict";var i=n(7),r=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.question)throw new Error("data.question must not be null or empty");if(!t.title)throw new Error("data.title must not be null or empty");if(!t.yesButtonLabel)throw new Error("data.yesButtonLabel must not be null or empty");if(!t.noButtonLabel)throw new Error("data.noButtonLabel must not be null or empty");this.data=t,this.selectedButton=0}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getType=function(){return"Prompt"},t.prototype.getTitle=function(){return this.data.title},t.prototype.getQuestion=function(){return this.data.question},t.prototype.getYesButtonText=function(){return this.data.yesButtonLabel},t.prototype.getNoButtonText=function(){return this.data.noButtonLabel},t.prototype.setButtonSelected=function(t){t&&(this.selectedButton=t)},t.prototype.getButtonSelected=function(){return this.selectedButton},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(i.DOM_PROMPT_TAGNAME);return e.appendChild(t.createTextNode(this.promptButtonToString(this.getButtonSelected()))),[e]},t.prototype.getJsonElements=function(){var t={};return t[i.JSON_PROMPT_KEYNAME]=this.promptButtonToString(this.getButtonSelected()),t},t.prototype.getComponentJson=function(){var t;return(t={})[i.JSON_PROMPTTITLE_KEYNAME]=this.getTitle(),t[i.JSON_QUESTION_KEYNAME]=this.getQuestion(),t[i.JSON_PROMPTYESTEXT_KEYNAME]=this.getYesButtonText(),t[i.JSON_PROMPTNOTEXT_KEYNAME]=this.getNoButtonText(),t},t.prototype.promptButtonToString=function(t){switch(t){case 0:return"Unselected";case 1:return"Yes";case 2:return"No";default:return"Unknown"}},t}();!function(t){var e=function(){};t.PromptComponentData=e}(r||(r={})),t.exports=r},function(t,e,n){"use strict";var i=n(7),r=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.question)throw new Error("data.question must not be null or empty");if(!t.ratingValuesAscending||t.ratingValuesAscending.length<2)throw new Error("data.ratingValuesAscending must not be null or have less than two choices");t.ratingValuesAscending.forEach((function(t){if(!t)throw new Error("rating values must not contain null or empty")})),this.data=t,this.selectedIndex=-1}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getType=function(){return"Rating"},t.prototype.getQuestion=function(){return this.data.question},t.prototype.getRatingValuesAscending=function(){return this.data.ratingValuesAscending},t.prototype.getSelectedRating=function(){return this.isRatingIndexValid(this.selectedIndex)?this.data.ratingValuesAscending[this.selectedIndex]:""},t.prototype.setSelectedRatingIndex=function(t){this.isRatingIndexValid(t)?this.selectedIndex=t:this.selectedIndex=-1},t.prototype.getSelectedRatingIndex=function(){return this.selectedIndex},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(i.DOM_RATING_TAGNAME);return this.isRatingIndexValid(this.getSelectedRatingIndex())?e.appendChild(t.createTextNode(this.getNormalizedRatingScore().toFixed(6))):e.appendChild(t.createTextNode("Not rated")),[e]},t.prototype.getJsonElements=function(){var t={};return this.isRatingIndexValid(this.getSelectedRatingIndex())?t[i.JSON_RATING_KEYNAME]=this.getNormalizedRatingScore():t[i.JSON_RATING_KEYNAME]="Not rated",t},t.prototype.getComponentJson=function(){var t;return(t={})[i.JSON_QUESTION_KEYNAME]=this.getQuestion(),t[i.JSON_RATINGOPTIONS_KEYNAME]=this.getRatingValuesAscending(),t},t.prototype.getNormalizedRatingScore=function(){return this.isRatingIndexValid(this.getSelectedRatingIndex())?this.data.isZeroBased?this.selectedIndex/(this.data.ratingValuesAscending.length-1):(this.selectedIndex+1)/this.data.ratingValuesAscending.length:-1},t.prototype.isRatingIndexValid=function(t){return t>=0&&t<this.data.ratingValuesAscending.length},t}();!function(t){var e=function(){};t.RatingComponentData=e}(r||(r={})),t.exports=r},function(t,e,n){"use strict";var i;!function(t){t.DOM_TYPE_TAGNAME="Type",t.DOM_TYPE_VALUE="Survey",t.DOM_ID_TAGNAME="SurveyID",t.JSON_SURVEY_KEYNAME="survey",t.JSON_ID_KEYNAME="surveyId"}(i||(i={})),t.exports=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(5),a=n(12),s=n(1),u=i.FileType,c=s.getDistantPast,l=s.isBoolean,p=s.isDate,d=s.isNOU,h=s.isString,f=s.isUtcDatetimeString,g=s.stringToDate,v=function(){function t(t,e,n,i,r,o,a,s,u,c,l,p){if(this.CampaignId=t,this.LastNominationTimeUtc=e,this.LastNominationBuildNumber=n,this.DeleteAfterSecondsWhenStale=i,this.ForceCandidacy=r,this.IsCandidate=o,this.DidCandidateTriggerSurvey=a,this.LastSurveyActivatedTimeUtc=s,this.LastSurveyId=u,this.LastSurveyStartTimeUtc=c,this.LastSurveyExpirationTimeUtc=l,this.LastCooldownEndTimeUtc=p,!this.validate())throw new Error("Constructor arguments are not valid")}return t.deserialize=function(e){var n;if(!e)return null;try{n=new t(e.CampaignId,e.LastNominationTimeUtc,e.LastNominationBuildNumber,e.DeleteAfterSecondsWhenStale,!1,e.IsCandidate,e.DidCandidateTriggerSurvey,e.LastSurveyActivatedTimeUtc,e.LastSurveyId,e.LastSurveyStartTimeUtc,e.LastSurveyExpirationTimeUtc,e.LastCooldownEndTimeUtc)}catch(t){return o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.CampaignState.Deserialize.Failed,{ErrorMessage:t.toString()}),null}return n},t.prototype.validate=function(){if(!this.CampaignId||!h(this.CampaignId))return!1;if(d(this.LastNominationBuildNumber)||!h(this.LastNominationBuildNumber))return!1;if(!s.isNumber(this.DeleteAfterSecondsWhenStale)||this.DeleteAfterSecondsWhenStale<0)return!1;if(!l(this.IsCandidate)||!l(this.DidCandidateTriggerSurvey))return!1;if(this.IsCandidate){if(d(this.LastSurveyStartTimeUtc)||d(this.LastSurveyExpirationTimeUtc))return!1;if(!h(this.LastSurveyId))return!1}if(this.DidCandidateTriggerSurvey&&d(this.LastSurveyActivatedTimeUtc))return!1;if(d(this.LastSurveyId))this.LastSurveyId="";else if(!h(this.LastSurveyId))return!1;if(f(this.LastNominationTimeUtc))this.LastNominationTimeUtc=g(this.LastNominationTimeUtc);else if(!p(this.LastNominationTimeUtc))return!1;if(d(this.LastSurveyActivatedTimeUtc))this.LastSurveyActivatedTimeUtc=c();else if(f(this.LastSurveyActivatedTimeUtc))this.LastSurveyActivatedTimeUtc=g(this.LastSurveyActivatedTimeUtc);else if(!p(this.LastSurveyActivatedTimeUtc))return!1;if(d(this.LastSurveyStartTimeUtc))this.LastSurveyStartTimeUtc=c();else if(f(this.LastSurveyStartTimeUtc))this.LastSurveyStartTimeUtc=g(this.LastSurveyStartTimeUtc);else if(!p(this.LastSurveyStartTimeUtc))return!1;if(d(this.LastSurveyExpirationTimeUtc))this.LastSurveyExpirationTimeUtc=c();else if(f(this.LastSurveyExpirationTimeUtc))this.LastSurveyExpirationTimeUtc=g(this.LastSurveyExpirationTimeUtc);else if(!p(this.LastSurveyExpirationTimeUtc))return!1;if(d(this.LastCooldownEndTimeUtc))this.LastCooldownEndTimeUtc=c();else if(f(this.LastCooldownEndTimeUtc))this.LastCooldownEndTimeUtc=g(this.LastCooldownEndTimeUtc);else if(!p(this.LastCooldownEndTimeUtc))return!1;return!0},t.prototype.markCurrentSurveyTakenOnDate=function(t,e){this.DidCandidateTriggerSurvey=!0,this.LastSurveyActivatedTimeUtc=null!=t?t:new Date,this.LastCooldownEndTimeUtc=s.addSecondsWithoutOverflow(this.LastSurveyActivatedTimeUtc,e)},t.prototype.getCooldownStartDate=function(){return this.IsCandidate?this.DidCandidateTriggerSurvey?this.LastSurveyActivatedTimeUtc:this.LastSurveyStartTimeUtc:this.LastNominationTimeUtc},t}();e.CampaignState=v;var m=function(){function t(){}return t.make=function(t,e){return e?new S(t,e):new T(t)},t}();e.CampaignStateProviderFactory=m;var y=function(){},S=function(){function t(t,e){if(!e)throw new Error("host-based storage must not be null");this.hostBasedStorage=e,t&&(this.fileBasedStateProvider=new T(t))}return t.prototype.load=function(){var t,e=this.getStatesFromHost();return this.fileBasedStateProvider&&(t=this.fileBasedStateProvider.load()),a.MergeAndUpdateCampaignStates(t,e).find(0)},t.prototype.save=function(t){var e=this;if(t){var n=this.getStatesFromHost(),i=a.MergeAndUpdateCampaignStates(t,n),r=i.find(1),o=i.find(0);r&&r.forEach((function(t){var n=a.makeSettingItemValue(JSON.stringify(t));e.hostBasedStorage.upsertSettingItem(u[u.CampaignStates],t.CampaignId,n)})),this.fileBasedStateProvider&&this.fileBasedStateProvider.save(o)}},t.prototype.getStatesFromHost=function(){var t=[],e=this.hostBasedStorage.readSettingList(u[u.CampaignStates]);for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],s=a.extractSettingItemValueSubString(i),c={};try{c=JSON.parse(s);var l=v.deserialize(c);l&&t.push(l)}catch(t){o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.HostBasedCampaignStateProvider.GetStatesFromHost.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+t.toString()+".  Input:"+s})}}return t},t}();e.HostBasedCampaignStateProvider=S;var T=function(){function t(t){if(!t)throw new Error("storage must not be null");this.storage=t}return t.prototype.load=function(){var t,e=this.storage.read(u.CampaignStates);if(!e)return[];try{t=JSON.parse(e);var n=[];return t&&t.CampaignStates&&t.CampaignStates.forEach((function(t){var e=v.deserialize(t);e&&n.push(e)})),n}catch(t){return o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.FileBasedCampaignStateProvider.Load.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+t.toString()+".  Input:"+e}),[]}},t.prototype.save=function(t){if(t){var e=new y;e.CampaignStates=t;var n=JSON.stringify(e);this.storage.write(u.CampaignStates,n)}},t}();e.FileBasedCampaignStateProvider=T},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),a=o.FileType,s=n(4),u=n(3),c=n(5),l=n(12),p=n(19),d=n(1),h=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.fromJson=function(t){var n,i=new e;if(!t)return c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.SurveyStatCollectionActivation.FromJson.Failed,{ErrorMessage:"Input json is null or empty."}),i;try{n=JSON.parse(t)}catch(t){return c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.SurveyStatCollectionActivation.FromJson.Failed,{ErrorMessage:"Json parsing failed. "+t.toString()}),i}return i.deserialize(n)?i:new e},e.toJson=function(t){return t||(c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.SurveyStatCollectionActivation.ToJson.Failed,{ErrorMessage:"Input json is null or empty."}),t=new e),JSON.stringify(t)},e.prototype.accumulate=function(t){if(t){var e=t.getStats();for(var n in e)e.hasOwnProperty(n)&&this.addStats(n,e[n])}},e.prototype.deserialize=function(t){var e=t.Surveys,n=new Date;for(var i in e)if(e.hasOwnProperty(i)){var r=new m;r.deserialize(e[i])&&r.ExpirationTimeUtc>n&&this.addStats(i,r)}return this.validate()},e.prototype.validate=function(){return d.isObject(this.getStats())},e}(p.SurveyStatCollection);e.SurveyStatCollectionActivation=h;var f=function(){function t(){}return t.make=function(t,e){return e?new g(t,e):new v(t)},t}();e.SurveyActivationStatsProviderFactory=f;var g=function(){function t(t,e){if(!e)throw new Error("host-based storage must not be null");this.hostBasedStorage=e,t&&(this.fileBasedStorageProvider=new v(t))}return t.prototype.load=function(){var t=this.getSurveyStatsFromHost(),e=new h;return this.fileBasedStorageProvider&&(e=this.fileBasedStorageProvider.load()),l.MergeAndUpdateSurveyActivationStats(e,t).find(0)},t.prototype.save=function(t){if(t){var e=this.getSurveyStatsFromHost(),n=l.MergeAndUpdateSurveyActivationStats(t,e),i=n.find(1),r=n.find(0);if(i){var o=i.getStats();for(var s in o)if(o.hasOwnProperty(s)){var u=l.makeSettingItemValue(JSON.stringify(o[s]));this.hostBasedStorage.upsertSettingItem(a[a.SurveyActivationStats],s,u)}}this.fileBasedStorageProvider&&this.fileBasedStorageProvider.save(r)}},t.prototype.getSurveyStatsFromHost=function(){var t=new h,e=this.hostBasedStorage.readSettingList(a[a.SurveyActivationStats]);for(var n in e)if(e.hasOwnProperty(n)){var i=l.extractSettingItemValueSubString(e[n]),r=new m,o=void 0;try{o=JSON.parse(i),r.deserialize(o)}catch(t){c.FloodgateEngine.getTelemetryLogger().log_Event(u.TelemetryEvent.HostBasedSurveyActivationStatsProvider.GetSurveyStatsFromHost.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+t.toString()+".  Input:"+i})}var s=new Date;r.ExpirationTimeUtc<=s?this.hostBasedStorage.deleteSettingItem(a[a.SurveyActivationStats],n):t.addStats(n,r)}return t},t}();e.HostBasedSurveyActivationStatsProvider=g;var v=function(){function t(t){if(!t)throw new Error("storage must not be null");this.storage=t}return t.prototype.load=function(){var t=this.storage.read(o.FileType.SurveyActivationStats);return t?h.fromJson(t):new h},t.prototype.save=function(t){if(t){var e=h.toJson(t);this.storage.write(o.FileType.SurveyActivationStats,e)}},t}();e.FileBasedSurveyActivationStatsProvider=v;var m=function(){function t(){}return t.prototype.deserialize=function(t){return this.ActivationTimeUtc=t.ActivationTimeUtc,this.ExpirationTimeUtc=t.ExpirationTimeUtc,this.Type=t.Type,this.validate()},t.prototype.validate=function(){return!!d.isUtcDatetimeString(this.ActivationTimeUtc)&&(this.ActivationTimeUtc=d.stringToDate(this.ActivationTimeUtc),!!d.isUtcDatetimeString(this.ExpirationTimeUtc)&&(this.ExpirationTimeUtc=d.stringToDate(this.ExpirationTimeUtc),d.isEnumValue(this.Type,s.Type)))},t}();e.SurveyActivationStats=m},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.Surveys={},this.Surveys={}}return t.prototype.addStats=function(t,e){this.Surveys[t]=e},t.prototype.getBySurveyId=function(t){return this.Surveys[t]},t.prototype.getStats=function(){return this.Surveys},t}();e.SurveyStatCollection=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=n(3),o=n(5),a=n(10),s=n(12),u=n(1),c=i.FileType,l=function(){function t(t,e){if(this.ChannelType=t,this.CooldownStartTimeUtc=e,!this.validate())throw new Error("Constructor arguments are not valid")}return t.deserialize=function(e){var n;if(!e)return null;try{n=new t(e.ChannelType,e.CooldownStartTimeUtc)}catch(t){return o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.GovernedChannelState.Deserialize.Failed,{ErrorMessage:t.toString()}),null}return n},t.prototype.validate=function(){return!!u.isEnumValue(this.ChannelType,a.GovernedChannelType)&&(u.isUtcDatetimeString(this.CooldownStartTimeUtc)?this.CooldownStartTimeUtc=u.stringToDate(this.CooldownStartTimeUtc):!u.isNOU(this.CooldownStartTimeUtc)&&u.isDate(this.CooldownStartTimeUtc)||(this.CooldownStartTimeUtc=u.getDistantPast()),!0)},t.prototype.getType=function(){return this.ChannelType},t.prototype.getCooldownStartTime=function(){return this.CooldownStartTimeUtc},t}();e.GovernedChannelState=l;var p=function(){function t(){}return t.make=function(t,e){return e?new h(t,e):new f(t)},t}();e.GovernedChannelStateProviderFactory=p;var d=function(){},h=function(){function t(t,e){if(!e)throw new Error("host-based storage must not be null");this.hostBasedStorage=e,t&&(this.fileBasedStateProvider=new f(t))}return t.prototype.load=function(){var t,e=this.getStatesFromHost();return this.fileBasedStateProvider&&(t=this.fileBasedStateProvider.load()),s.MergeAndUpdateGovernedChannelStates(t,e).find(0)},t.prototype.save=function(t){var e=this;if(t){var n=this.getStatesFromHost(),i=s.MergeAndUpdateGovernedChannelStates(t,n),r=i.find(1),o=i.find(0);r&&r.forEach((function(t){var n=s.makeSettingItemValue(JSON.stringify(t));e.hostBasedStorage.upsertSettingItem(c[c.GovernedChannelStates],String(t.getType()),n)})),this.fileBasedStateProvider&&this.fileBasedStateProvider.save(o)}},t.prototype.getStatesFromHost=function(){var t=[],e=this.hostBasedStorage.readSettingList(c[c.GovernedChannelStates]);for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],a=s.extractSettingItemValueSubString(i),u={};try{u=JSON.parse(a);var p=l.deserialize(u);p&&t.push(p)}catch(t){o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.HostBasedGovernedChannelStateProvider.GetStatesFromHost.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+t.toString()+".  Input:"+a})}}return t},t}();e.HostBasedGovernedChannelStateProvider=h;var f=function(){function t(t){if(!t)throw new Error("storage must not be null");this.storage=t}return t.prototype.load=function(){var t,e=this.storage.read(c.GovernedChannelStates);if(!e)return[];try{t=JSON.parse(e);var n=[];return t&&t.ChannelStates&&t.ChannelStates.forEach((function(t){var e=l.deserialize(t);e&&n.push(e)})),n}catch(t){return o.FloodgateEngine.getTelemetryLogger().log_Event(r.TelemetryEvent.FileBasedGovernedChannelStateProvider.Load.Failed,{ErrorMessage:"Json parsing/deserializing failed. "+t.toString()+".  Input:"+e}),[]}},t.prototype.save=function(t){if(t){var e=new d;e.ChannelStates=t;var n=JSON.stringify(e);this.storage.write(c.GovernedChannelStates,n)}},t}();e.FileBasedGovernedChannelStateProvider=f},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),a=n(5),s=n(19),u=n(1),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.fromJson=function(t){var n,i=new e;if(!t)return a.FloodgateEngine.getTelemetryLogger().log_Event(o.TelemetryEvent.SurveyStatCollectionEventActivity.FromJson.Failed,{ErrorMessage:"Input json is null or empty."}),i;try{n=JSON.parse(t)}catch(t){return a.FloodgateEngine.getTelemetryLogger().log_Event(o.TelemetryEvent.SurveyStatCollectionEventActivity.FromJson.Failed,{ErrorMessage:"Json parsing failed. "+t.toString()}),i}return i.deserialize(n)?i:new e},e.toJson=function(t){return t||(a.FloodgateEngine.getTelemetryLogger().log_Event(o.TelemetryEvent.SurveyStatCollectionEventActivity.ToJson.Failed,{ErrorMessage:"Input json is null or empty."}),t=new e),JSON.stringify(t)},e.prototype.accumulate=function(t){if(t){var e=t.getStats();for(var n in e)if(e.hasOwnProperty(n)){var i=this.getBySurveyId(n);if(i||((i=new l).Counts=[],this.addStats(n,i)),i.ExpirationTimeUtc=e[n].ExpirationTimeUtc,i.Counts.length<e[n].Counts.length){var r=i.Counts.slice();i.Counts=r}for(var o=0;o<e[n].Counts.length;o++)i.Counts[o]||(i.Counts[o]=0),i.Counts[o]+=e[n].Counts[o]}}},e.prototype.deserialize=function(t){var e=t.Surveys,n=new Date;for(var i in e)if(e.hasOwnProperty(i)){var r=new l;r.deserialize(e[i])&&r.ExpirationTimeUtc>n&&this.addStats(i,r)}return this.validate()},e.prototype.validate=function(){return u.isObject(this.getStats())},e}(s.SurveyStatCollection);e.SurveyStatCollectionEventActivity=c;var l=function(){function t(){}return t.prototype.deserialize=function(t){return this.ExpirationTimeUtc=t.ExpirationTimeUtc,this.Counts=t.Counts,this.validate()},t.prototype.validate=function(){if(!this.Counts)return!1;for(var t=0;t<this.Counts.length;t++){var e=this.Counts[t];if(!u.isNumber(e))return!1;e<0&&(this.Counts[t]=0)}return!!u.isUtcDatetimeString(this.ExpirationTimeUtc)&&(this.ExpirationTimeUtc=u.stringToDate(this.ExpirationTimeUtc),!0)},t}();e.SurveyEventActivityStats=l},function(t,e,n){"use strict";t.exports=n(23).polyfill()},function(t,e,n){t.exports=function(){"use strict";function t(t){return"function"==typeof t}var e=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},n=0,i=void 0,r=void 0,o=function(t,e){d[n]=t,d[n+1]=e,2===(n+=2)&&(r?r(h):y())},a="undefined"!=typeof window?window:void 0,s=a||{},u=s.MutationObserver||s.WebKitMutationObserver,c="undefined"==typeof self&&"[object process]"==={}.toString.call(Object({})),l="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function p(){var t=setTimeout;return function(){return t(h,1)}}var d=new Array(1e3);function h(){for(var t=0;t<n;t+=2)(0,d[t])(d[t+1]),d[t]=void 0,d[t+1]=void 0;n=0}var f,g,v,m,y=void 0;function S(t,e){var n=this,i=new this.constructor(E);void 0===i[C]&&M(i);var r=n._state;if(r){var a=arguments[r-1];o((function(){return N(r,i,a,n._result)}))}else L(n,i,t,e);return i}function T(t){if(t&&"object"==typeof t&&t.constructor===this)return t;var e=new this(E);return I(e,t),e}c?y=function(){return Object({}).nextTick(h)}:u?(g=0,v=new u(h),m=document.createTextNode(""),v.observe(m,{characterData:!0}),y=function(){m.data=g=++g%2}):l?((f=new MessageChannel).port1.onmessage=h,y=function(){return f.port2.postMessage(0)}):y=void 0===a?function(){try{var t=Function("return this")().require("vertx");return void 0!==(i=t.runOnLoop||t.runOnContext)?function(){i(h)}:p()}catch(t){return p()}}():p();var C=Math.random().toString(36).substring(2);function E(){}var A=void 0,_=1,w=2;function b(e,n,i){n.constructor===e.constructor&&i===S&&n.constructor.resolve===T?function(t,e){e._state===_?F(t,e._result):e._state===w?O(t,e._result):L(e,void 0,(function(e){return I(t,e)}),(function(e){return O(t,e)}))}(e,n):void 0===i?F(e,n):t(i)?function(t,e,n){o((function(t){var i=!1,r=function(t,e,n,i){try{t.call(e,n,i)}catch(t){return t}}(n,e,(function(n){i||(i=!0,e!==n?I(t,n):F(t,n))}),(function(e){i||(i=!0,O(t,e))}),t._label);!i&&r&&(i=!0,O(t,r))}),t)}(e,n,i):F(e,n)}function I(t,e){if(t===e)O(t,new TypeError("You cannot resolve a promise with itself"));else if(r=typeof(i=e),null===i||"object"!==r&&"function"!==r)F(t,e);else{var n=void 0;try{n=e.then}catch(e){return void O(t,e)}b(t,e,n)}var i,r}function D(t){t._onerror&&t._onerror(t._result),P(t)}function F(t,e){t._state===A&&(t._result=e,t._state=_,0!==t._subscribers.length&&o(P,t))}function O(t,e){t._state===A&&(t._state=w,t._result=e,o(D,t))}function L(t,e,n,i){var r=t._subscribers,a=r.length;t._onerror=null,r[a]=e,r[a+_]=n,r[a+w]=i,0===a&&t._state&&o(P,t)}function P(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var i=void 0,r=void 0,o=t._result,a=0;a<e.length;a+=3)i=e[a],r=e[a+n],i?N(n,i,r,o):r(o);t._subscribers.length=0}}function N(e,n,i,r){var o=t(i),a=void 0,s=void 0,u=!0;if(o){try{a=i(r)}catch(t){u=!1,s=t}if(n===a)return void O(n,new TypeError("A promises callback cannot return that same promise."))}else a=r;n._state!==A||(o&&u?I(n,a):!1===u?O(n,s):e===_?F(n,a):e===w&&O(n,a))}var U=0;function M(t){t[C]=U++,t._state=void 0,t._result=void 0,t._subscribers=[]}var B=function(){function t(t,n){this._instanceConstructor=t,this.promise=new t(E),this.promise[C]||M(this.promise),e(n)?(this.length=n.length,this._remaining=n.length,this._result=new Array(this.length),0===this.length?F(this.promise,this._result):(this.length=this.length||0,this._enumerate(n),0===this._remaining&&F(this.promise,this._result))):O(this.promise,new Error("Array Methods must be provided an Array"))}return t.prototype._enumerate=function(t){for(var e=0;this._state===A&&e<t.length;e++)this._eachEntry(t[e],e)},t.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,i=n.resolve;if(i===T){var r=void 0,o=void 0,a=!1;try{r=t.then}catch(t){a=!0,o=t}if(r===S&&t._state!==A)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(n===k){var s=new n(E);a?O(s,o):b(s,t,r),this._willSettleAt(s,e)}else this._willSettleAt(new n((function(e){return e(t)})),e)}else this._willSettleAt(i(t),e)},t.prototype._settledAt=function(t,e,n){var i=this.promise;i._state===A&&(this._remaining--,t===w?O(i,n):this._result[e]=n),0===this._remaining&&F(i,this._result)},t.prototype._willSettleAt=function(t,e){var n=this;L(t,void 0,(function(t){return n._settledAt(_,e,t)}),(function(t){return n._settledAt(w,e,t)}))},t}(),k=function(){function e(t){this[C]=U++,this._result=this._state=void 0,this._subscribers=[],E!==t&&("function"!=typeof t&&function(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}(),this instanceof e?function(t,e){try{e((function(e){I(t,e)}),(function(e){O(t,e)}))}catch(e){O(t,e)}}(this,t):function(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}())}return e.prototype.catch=function(t){return this.then(null,t)},e.prototype.finally=function(e){var n=this.constructor;return t(e)?this.then((function(t){return n.resolve(e()).then((function(){return t}))}),(function(t){return n.resolve(e()).then((function(){throw t}))})):this.then(e,e)},e}();return k.prototype.then=S,k.all=function(t){return new B(this,t).promise},k.race=function(t){var n=this;return e(t)?new n((function(e,i){for(var r=t.length,o=0;o<r;o++)n.resolve(t[o]).then(e,i)})):new n((function(t,e){return e(new TypeError("You must pass an array to race."))}))},k.resolve=T,k.reject=function(t){var e=new this(E);return O(e,t),e},k._setScheduler=function(t){r=t},k._setAsap=function(t){o=t},k._asap=o,k.polyfill=function(){var t=void 0;if("undefined"!=typeof window)t=window;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=k},k.Promise=k,k}()},function(t,e,n){"use strict";var i;!function(t){var e=function(){function t(){}return t.AppLaunch="AppLaunch",t.AppUsageTime="AppUsageTime",t.AppResume="AppResume",t}();t.ActivityName=e}(i||(i={})),t.exports=i},function(t,e,n){"use strict";var i;!function(t){t.RoamingSettingIdMap={CampaignStates:1258,GovernedChannelStates:1257,SurveyActivationStats:1259}}(i||(i={})),t.exports=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(5),r=n(1),o=n(6),a=n(17),s=n(27),u=n(3),c=r.getDistantFuture,l=r.getDistantPast,p=r.isArray,d=r.isNOU,h=function(){function t(t,e,n,i,r,o,a){if(!t)throw new Error("stateProvider must not be null");if(!p(e))throw new Error("definitionProviders is either null or not an array type");if(!n)throw new Error("stringProvider must not be null");if(d(r))throw new Error("currentBuildNumber must not be null");this.campaignStates={},this.campaignDefinitions={},this.userFacts=[],this.stateProvider=t,this.definitionProviders=e,this.stringProvider=n,this.userFactsProvider=a,this.environmentProvider=i,this.currentBuildNumber=r,o=o||new Date}return t.isStateUpForNomination=function(e,n,i,r){if(!e||!n)return!1;if(i=i||new Date,e.ForceCandidacy)return!0;var o=n.nominationScheme.getCampaignCooldown(e.IsCandidate&&e.DidCandidateTriggerSurvey);return!!o&&(!!t.hasBuildChangeDurationElapsed(o,e.LastNominationBuildNumber,r)||t.hasTimeIntervalDurationElapsed(o,e.getCooldownStartDate(),i))},t.isDateInRange=function(t,e,n){return t=t||new Date,e=e||l(),n=n||c(),e.getTime()<=t.getTime()&&n.getTime()>=t.getTime()},t.hasTimeIntervalDurationElapsed=function(t,e,n){if(d(t)||!(t instanceof o.CampaignDurationTimeInterval))return!1;if(!e||!n)return!1;var i=r.addSecondsWithoutOverflow(e,t.intervalSeconds);return n.getTime()>=i.getTime()},t.hasBuildChangeDurationElapsed=function(t,e,n){return!d(t)&&t instanceof o.CampaignDurationSingleBuildChange&&(d(e)||d(n)?null===e!=(null===n):!(e===n))},t.isCampaignInScope=function(e,n,i,r){return!!e&&(n=n||new Date,!!t.isDateInRangeWithDefinition(n,e)&&!(e.scope&&((e.scope instanceof o.CampaignScopeUserFactAny||e.scope instanceof o.CampaignScopeUserFactAll)&&e.scope.setUserFactsProvider(r),e.scope instanceof o.CampaignScopeEnvironmentCrossProduct&&e.scope.setEnvironmentProvider(i),!e.scope.isInScope())))},t.isDateInRangeWithDefinition=function(e,n){return!!n&&(e=e||new Date,t.isDateInRange(e,n.startTime?n.startTime:c(),n.endTime))},t.prototype.getActiveSurveys=function(){var t={};for(var e in this.campaignStates)if(this.campaignStates.hasOwnProperty(e)){var n=this.campaignStates[e];if(!n.IsCandidate)continue;var i=this.campaignDefinitions[n.CampaignId];if(!i)continue;var r=s.CampaignSurveyFactory.makeSurvey(n,i.governedChannelType,i.surveyTemplate,this.stringProvider,i.additionalDataRequested,i.launcherType);if(!r)continue;t[r.getSurveyInfo().getId()]=r}return t},t.prototype.onCampaignSurveyActivated=function(t,e){var n=this.campaignStates[t];n&&(e=e||new Date,n.markCurrentSurveyTakenOnDate(e,this.campaignDefinitions[t].nominationScheme.cooldownPeriod.asTimeIntervalSeconds()),this.saveCurrentState())},t.prototype.getCampaignStates=function(){return this.campaignStates},t.prototype.getCampaignDefinitions=function(){return this.campaignDefinitions},t.prototype.getUserFacts=function(){return this.userFacts},t.prototype.onSurveyActivated=function(t){t&&this.onCampaignSurveyActivated(t.getBackEndId(),new Date)},t.prototype.refreshSurveyDefinitions=function(t,e){this.refreshSurveyDefinitionsPrivate(t,e||new Date)},t.prototype.refreshSurveyDefinitionsAsync=function(t,e){var n=this;return new Promise((function(i,r){n.refreshSurveyDefinitionsPrivateAsync(t,e||new Date).then((function(){i()})).catch((function(t){r(t)}))}))},t.prototype.getAppSurveys=function(){return this.getActiveSurveys()},t.prototype.saveCurrentState=function(){var t=r.makeArrayFromObjectValuesSortedByKeyString(this.campaignStates);this.stateProvider.save(t)},t.prototype.refreshSurveyDefinitionsPrivate=function(t,e){this.campaignStates={},this.campaignDefinitions={},this.userFacts=[],this.loadAndFilterCampaignData(e,t),this.evaluateCampaigns(e)},t.prototype.refreshSurveyDefinitionsPrivateAsync=function(t,e){this.campaignStates={},this.campaignDefinitions={},this.userFacts=[];var n=this;return new Promise((function(i,r){n.loadAndFilterCampaignDataAsync(e,t).then((function(){n.evaluateCampaigns(e),i()})).catch((function(t){r(t)}))}))},t.prototype.loadAndFilterCampaignDataAsync=function(t,e){t=t||new Date;for(var n=[],r=[],o=this.userFactsProvider&&this.userFactsProvider.loadAsync(),a=0,s=Object.keys(this.definitionProviders);a<s.length;a++){var c=s[a],l=this.definitionProviders[c],h=l&&l.loadAsync();d(h)||(h=h.catch((function(){i.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed("Failed to load from campaign definition provider"),Promise.resolve()})),r.push(h))}var f=this;return new Promise((function(a,s){Promise.all(r).then((function(r){for(var s=0,c=Object.keys(r);s<c.length;s++){var l=r[c[s]];p(l)&&(n=n.concat(l))}var h=function(i){f.userFacts=i||[],f.FilterCampaignData(t,e,n),a()};d(o)?h():o.then((function(t){h(t)})).catch((function(){i.FloodgateEngine.getTelemetryLogger().log_Error(u.TelemetryEvent.Floodgate.UserFactsLoad.Failed,"Failed to load from user facts provider"),h()}))})).catch((function(t){i.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed("Failed to load from campaign definition provider")}))}))},t.prototype.loadAndFilterCampaignData=function(t,e){t=t||new Date;for(var n=[],r=0,o=Object.keys(this.definitionProviders);r<o.length;r++){var a=o[r];try{var s=this.definitionProviders[a]&&this.definitionProviders[a].load();p(s)&&(n=n.concat(s))}catch(t){i.FloodgateEngine.getTelemetryLogger().log_CampaignLoad_Failed("Failed to load from campaign definition provider. "+t.toString())}}try{this.userFacts=this.userFactsProvider&&this.userFactsProvider.load()||[]}catch(t){i.FloodgateEngine.getTelemetryLogger().log_Error(u.TelemetryEvent.Floodgate.UserFactsLoad.Failed,"Failed to load from user facts provider. "+t)}this.FilterCampaignData(t,e,n)},t.prototype.FilterCampaignData=function(e,n,i){var o={};for(var a in i)if(i.hasOwnProperty(a)){if(o[(l=i[a]).campaignId]=l,n&&n.indexOf(l.governedChannelType)<0)continue;if(!t.isCampaignInScope(l,e,this.environmentProvider,this.userFactsProvider))continue;this.campaignDefinitions[l.campaignId]=l}var s=this.stateProvider.load(),u=[];for(var a in s)if(s.hasOwnProperty(a)){var c=s[a];this.campaignDefinitions.hasOwnProperty(c.CampaignId)||u.push(c),this.campaignStates[c.CampaignId]=c}for(var a in u)if(u.hasOwnProperty(a)){if(!(c=u[a]))continue;var l,p=!1;(l=o[c.CampaignId])?t.isStateUpForNomination(c,l,e,this.currentBuildNumber)&&(p=!0):c.LastNominationTimeUtc.getTime()<=r.subtractSecondsWithoutOverflow(e,c.DeleteAfterSecondsWhenStale).getTime()&&(p=!0),p&&delete this.campaignStates[c.CampaignId]}},t.prototype.evaluateCampaigns=function(e){for(var n in e=e||new Date,this.campaignDefinitions)if(this.campaignDefinitions.hasOwnProperty(n)){var i=this.campaignDefinitions[n],o=this.campaignStates[i.campaignId];if(!o||t.isStateUpForNomination(o,i,e,this.currentBuildNumber)){var s=o?o.LastSurveyId:"",u=o?o.LastSurveyStartTimeUtc:l(),c=o?o.LastSurveyExpirationTimeUtc:l(),p=o?o.LastSurveyActivatedTimeUtc:l(),d=o?o.LastCooldownEndTimeUtc:l(),h=o&&o.ForceCandidacy||i.nominationScheme.evaluateNominationRules();h&&(s=r.guid(),u=i.nominationScheme.calculateSurveyStartTimeFromDate(e),c=i.nominationScheme.calculateSurveyExpirationTimeFromSurveyStartTime(u));var f=new a.CampaignState(i.campaignId,e,this.currentBuildNumber,i.nominationScheme.getActiveSurveyTimeIntervalSeconds(),!1,h,!1,p,s,u,c,d);this.campaignStates[f.CampaignId]=f}}},t}();e.CampaignManager=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(4),r=n(28),o=n(31),a=n(32),s=n(34),u=n(35),c=n(36),l=n(9),p=n(1),d=n(6),h=p.dateToShortUtcString,f=p.isNOU,g=function(){function t(){}return t.makeSurvey=function(e,n,i,r,o,l){return e&&i&&r?i instanceof d.CampaignSurveyTemplateNps5PointStatic?c.make5Point(t.makeSurveyDataSourceData(e,n,i,o,l),r):i instanceof d.CampaignSurveyTemplateNps11PointStatic?c.make11Point(t.makeSurveyDataSourceData(e,n,i,o,l),r):i instanceof d.CampaignSurveyTemplateFps?a.makeFps(t.makeSurveyDataSourceData(e,n,i,o,l),r,i):i instanceof d.CampaignSurveyTemplateNlqs?u.makeNlqs(t.makeSurveyDataSourceData(e,n,i,o,l),r,i):i instanceof d.CampaignSurveyTemplateNps?c.makeCustom(t.makeSurveyDataSourceData(e,n,i,o,l),r,i):i instanceof d.CampaignSurveyTemplateGenericMessagingSurface?s.makeCustom(t.makeSurveyDataSourceData(e,n,i,o,l)):null:null},t.makeSurveyDataSourceData=function(e,n,r,o,a){if(!e||!r)return null;var s=new l.SurveyDataSourceData;return s.activationEvent=t.makeEvent(e,r.activationEvent),s.metadata=t.makeMetadata(r.metadata),s.id=e.LastSurveyId,s.backEndIdentifier=e.CampaignId,s.expirationTimeUtc=h(e.LastSurveyExpirationTimeUtc),s.governedChannelType=n,s.startTimeUtc=h(e.LastSurveyStartTimeUtc),s.additionalDataRequested=o||[],s.launcherType=a||i.LAUNCHER_TYPE_DEFAULT,s},t.makeCountedActivityEventData=function(t){if(!t)return null;var e=new r.CountedActivityEventData;return e.activity=t.activity,e.count=t.count,e.isAggregate=t.isAggregate,e},t.makeCountedActivityEvent=function(e,n){if(!e||!n)return null;var i=t.makeCountedActivityEventData(n);return i?new r.CountedActivityEvent(i):null},t.makeCountedActivitySequenceEvent=function(e,n){if(!e||!n)return null;var i=new r.CountedActivitySequenceEventData;i.sequence=[];for(var o=0,a=n.sequence;o<a.length;o++){var s=a[o],u=t.makeCountedActivityEventData(s);if(!u)return null;i.sequence.push(u)}return new r.CountedActivitySequenceEvent(i)},t.makeEvent=function(e,n){return n instanceof d.CampaignSurveyEventCountedActivity?t.makeCountedActivityEvent(e,n):n instanceof d.CampaignSurveyEventCountedActivitySequence?t.makeCountedActivitySequenceEvent(e,n):null},t.makeMetadata=function(t){if(f(t)||f(t.contentMetadata))return null;var e=new o.Metadata;return e.contentMetadata=t.contentMetadata,new o.SurveyMetadata(e)},t}();e.CampaignSurveyFactory=g},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(29),r=n(30),o=function(){function t(t){if(!t)throw new Error("data must not be null");if(t.count<=0)throw new Error("count must be greater than 0");if(!t.activity||0===t.activity.length)throw new Error("activity must not be null or an empty string");this.data=t}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getActivity=function(){return this.data.activity},t.prototype.getCount=function(){return this.data.count},t.prototype.isAggregate=function(){return this.data.isAggregate},t.prototype.getType=function(){return"CountedActivity"},t.prototype.getTrackingSet=function(){var t=new Array;return t.push(new i.ActivityTrackingData(this.data.activity,this.data.count,this.data.isAggregate)),new r.ActivityTrackingSet(!1,t)},t}();e.CountedActivityEvent=o;var a=function(){};e.CountedActivityEventData=a;var s=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.sequence)throw new Error("data.sequence must not be null");if(0===t.sequence.length)throw new Error("data.sequence size must be greater than 0");this.data=[];for(var e=0,n=t.sequence;e<n.length;e++){var i=n[e];this.data.push(new o(i))}}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getSequence=function(){return this.data},t.prototype.getType=function(){return"CountedActivitySequence"},t.prototype.getTrackingSet=function(){for(var t=new Array,e=0,n=this.data;e<n.length;e++){var o=n[e];t.push(new i.ActivityTrackingData(o.getActivity(),o.getCount(),o.isAggregate()))}return new r.ActivityTrackingSet(!0,t)},t}();e.CountedActivitySequenceEvent=s;var u=function(){function t(){}return t.prototype.CountedActivitySequenceEventData=function(){},t}();e.CountedActivitySequenceEventData=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e,n){this.activity=t,this.count=e,this.isAggregate=n}return t.prototype.getActivity=function(){return this.activity},t.prototype.getCount=function(){return this.count},t.prototype.setCount=function(t){this.count=t},t.prototype.getIsAggregate=function(){return this.isAggregate},t}();e.ActivityTrackingData=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){this.isOrdered=t,this.list=e}return t.prototype.getIsOrdered=function(){return this.isOrdered},t.prototype.getList=function(){return this.list},t}();e.ActivityTrackingSet=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.contentMetadata)throw new Error("content metadata must not be null");if(!i.isObject(t.contentMetadata))throw new Error("content metadata must be of object type");this.data=t}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getContentMetadata=function(){return this.data.contentMetadata},t}();e.SurveyMetadata=r;var o=function(){};e.Metadata=o},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=n(4),a=n(7),s=n(13),u=n(33),c=n(14),l=n(15),p=n(1),d=n(11),h=n(9),f=p.isNOU,g=function(t){function e(e){var n=t.call(this)||this;if(f(e))throw new Error("data must not be null");return n.surveyInfo=new h(e.baseData),n.prompt=new c(e.promptData),n.question=e.commentData?new s(e.commentData):null,n.rating=e.ratingData?new l(e.ratingData):null,n.multipleChoice=e.multipleChoiceData?new u(e.multipleChoiceData):null,n}return r(e,t),e.make=function(t){try{return new e(t)}catch(t){return null}},e.makeFps=function(t,n,i){if(f(t)||f(n)||f(i))return null;var r=[],o=[],a=i.content;if(f(a)||f(a.prompt)||f(a.rating)&&f(a.multipleChoice)&&f(a.comment))return null;var p=new e.FpsSurveyData;if(p.baseData=t,p.promptData=new c.PromptComponentData,p.promptData.title=n.getCustomString(a.prompt.title),p.promptData.question=n.getCustomString(a.prompt.question),p.promptData.yesButtonLabel=n.getCustomString(a.prompt.yesLabel),p.promptData.noButtonLabel=n.getCustomString(a.prompt.noLabel),f(p.promptData.title)||f(p.promptData.question)||f(p.promptData.yesButtonLabel)||f(p.promptData.noButtonLabel))return null;if(a.rating){p.ratingData=new l.RatingComponentData,p.ratingData.question=n.getCustomString(a.rating.question),p.ratingData.isZeroBased=a.rating.isZeroBased;for(var d=0,h=a.rating.ratingValuesAscending;d<h.length;d++){var g=h[d],v=n.getCustomString(g);if(f(v))return null;r.push(v)}if(p.ratingData.ratingValuesAscending=r,f(p.ratingData.question)||f(p.ratingData.ratingValuesAscending))return null}if(a.multipleChoice){p.multipleChoiceData=new u.MultipleChoiceComponentData,p.multipleChoiceData.question=n.getCustomString(a.multipleChoice.question),p.multipleChoiceData.minNumberOfSelectedOptions=a.multipleChoice.minNumberOfSelectedOptions,p.multipleChoiceData.maxNumberOfSelectedOptions=a.multipleChoice.maxNumberOfSelectedOptions;for(var m=0,y=a.multipleChoice.availableOptions;m<y.length;m++){g=y[m],v=n.getCustomString(g);if(f(v))return null;o.push(v)}if(p.multipleChoiceData.availableOptions=o,f(p.multipleChoiceData.question)||f(p.multipleChoiceData.availableOptions))return null}return a.comment&&(p.commentData=new s.CommentComponentData,p.commentData.question=n.getCustomString(a.comment.question),f(p.commentData.question))?null:this.make(p)},e.prototype.getType=function(){return o.Type.Fps},e.prototype.getSurveyInfo=function(){return this.surveyInfo},e.prototype.getCommentComponent=function(){return this.question},e.prototype.getPromptComponent=function(){return this.prompt},e.prototype.getRatingComponent=function(){return this.rating},e.prototype.getMultipleChoiceComponent=function(){return this.multipleChoice},e.prototype.getComponent=function(t){switch(t){case"Comment":return this.getCommentComponent();case"Prompt":return this.getPromptComponent();case"Rating":return this.getRatingComponent();case"MultipleChoice":return this.getMultipleChoiceComponent();default:return null}},e.prototype.getDomElements=function(t){if(f(t))throw new Error("Document must not be null");var e=t.createElement(o.DOM_FPS_TAGNAME);return this.getSurveyInfo().getDomElements(t).forEach((function(t){f(t)||e.appendChild(t)})),this.getCommentComponent().getDomElements(t).forEach((function(t){f(t)||e.appendChild(t)})),this.getRatingComponent()&&this.getRatingComponent().getDomElements(t).forEach((function(t){f(t)||e.appendChild(t)})),this.getMultipleChoiceComponent()&&this.getMultipleChoiceComponent().getDomElements(t).forEach((function(t){f(t)||e.appendChild(t)})),[e]},e.prototype.getJsonElements=function(){var t,e={};return(e=p.overrideValues(this.getSurveyInfo().getJsonElements(),e))[a.JSON_APPLICATION_KEYNAME]={},e[a.JSON_APPLICATION_KEYNAME][a.JSON_EXTENDEDMANIFESTDATA_KEYNAME]=JSON.stringify(((t={})[a.JSON_SURVEYSTRINGS_KEYNAME]=this.makeSurveyStrings(),t[a.JSON_SURVEYSPECIFICDATA_KEYNAME]=this.makeResponseString(),t)),e},e.prototype.makeResponseString=function(){var t={};return this.question&&(t[a.JSON_COMMENT_KEYNAME]=[this.getCommentComponent().getSubmittedText()]),this.multipleChoice&&(t[a.JSON_MULTIPLECHOICE_KEYNAME]=[this.getMultipleChoiceComponent().getOptionSelectedStates()]),this.rating&&(t[a.JSON_RATING_KEYNAME]=[{numberOfOptions:this.getRatingComponent().getRatingValuesAscending().length,selectedRating:this.getRatingComponent().getSelectedRatingIndex()}]),JSON.stringify(t)},e.prototype.makeSurveyStrings=function(){var t={};return this.prompt&&(t[a.JSON_PROMPT_KEYNAME]=this.prompt.getComponentJson()),this.rating&&(t[a.JSON_RATING_KEYNAME]=[this.rating.getComponentJson()]),this.question&&(t[a.JSON_COMMENT_KEYNAME]=[this.question.getComponentJson()]),this.multipleChoice&&(t[a.JSON_MULTIPLECHOICE_KEYNAME]=[this.multipleChoice.getComponentJson()]),JSON.stringify(t)},e}(d.Survey);!function(t){var e=function(){};t.FpsSurveyData=e}(g||(g={})),t.exports=g},function(t,e,n){"use strict";var i=n(7),r=function(){function t(t){if(!t)throw new Error("data must not be null");if(!t.question)throw new Error("data.question must not be null or empty");if(!t.availableOptions||t.availableOptions.length<2)throw new Error("data.availableOptions must not be null or have less than two choices");t.availableOptions.forEach((function(t){if(!t)throw new Error("Option values must not contain null or empty")})),this.data=t,this.optionStates=new Array(t.availableOptions.length);for(var e=0;e<this.optionStates.length;e++)this.optionStates[e]=!1}return t.make=function(e){try{return new t(e)}catch(t){return null}},t.prototype.getType=function(){return"MultipleChoice"},t.prototype.getQuestion=function(){return this.data.question},t.prototype.getAvailableOptions=function(){return this.data.availableOptions},t.prototype.getOptionSelectedStates=function(){return this.optionStates},t.prototype.getMinNumberofSelectedOptions=function(){return this.data.minNumberOfSelectedOptions},t.prototype.getMaxNumberofSelectedOptions=function(){return this.data.maxNumberOfSelectedOptions},t.prototype.setOptionSelectedStates=function(t){for(var e=0;e<t.length;e++)this.optionStates[e]=t[e]},t.prototype.ValidateMinNumberofSelectedOptions=function(){var t=0;return this.optionStates.forEach((function(e){e&&t++})),t>=this.getMinNumberofSelectedOptions()},t.prototype.ValidateMaxNumberofSelectedOptions=function(){var t=0;return this.optionStates.forEach((function(e){e&&t++})),t<=this.getMaxNumberofSelectedOptions()},t.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(i.DOM_MULTIPLECHOICE_TAGNAME);return e.appendChild(t.createTextNode(this.getOptionSelectedStates().toString())),[e]},t.prototype.getJsonElements=function(){var t={};return t[i.JSON_MULTIPLECHOICE_KEYNAME]=this.getOptionSelectedStates().toString(),t},t.prototype.getComponentJson=function(){var t;return(t={})[i.JSON_QUESTION_KEYNAME]=this.getQuestion(),t[i.JSON_RATINGOPTIONS_KEYNAME]=this.getAvailableOptions(),t},t}();!function(t){var e=function(){};t.MultipleChoiceComponentData=e}(r||(r={})),t.exports=r},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=n(4),a=n(1),s=n(11),u=n(9),c=a.isNOU,l=function(t){function e(e){var n=t.call(this)||this;if(!e)throw new Error("data must not be null");if(n.surveyInfo=new u(e.baseData),c(n.surveyInfo.getMetadata()))throw new Error("metadata must not be null");return n}return r(e,t),e.make=function(t){try{return new e(t)}catch(t){return null}},e.makeCustom=function(t){if(c(t))return null;var n=new e.GenericMessagingSurfaceSurveyData;return n.baseData=t,this.make(n)},e.prototype.getType=function(){return o.Type.GenericMessagingSurface},e.prototype.getSurveyInfo=function(){return this.surveyInfo},e.prototype.getComponent=function(t){return null},e.prototype.getDomElements=function(t){return[]},e.prototype.getJsonElements=function(){return{}},e}(s.Survey);!function(t){var e=function(){};t.GenericMessagingSurfaceSurveyData=e}(l||(l={})),t.exports=l},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=n(4),a=n(13),s=n(14),u=n(15),c=n(1),l=n(11),p=n(9),d=c.isNOU,h=c.overrideValues,f=function(t){function e(e){var n=t.call(this)||this;if(d(e))throw new Error("data must not be null");return n.surveyInfo=new p(e.baseData),n.prompt=new s(e.promptData),n.question=new a(e.commentData),n.rating=new u(e.ratingData),n}return r(e,t),e.make=function(t){try{return new e(t)}catch(t){return null}},e.makeNlqs=function(t,n,i){if(d(t)||d(n)||d(i))return null;var r=[],o=i.content;if(d(o)||d(o.comment)||d(o.prompt)||d(o.rating))return null;var c=new e.NlqsSurveyData;c.baseData=t,c.promptData=new s.PromptComponentData,c.ratingData=new u.RatingComponentData,c.commentData=new a.CommentComponentData,c.promptData.title=n.getCustomString(o.prompt.title),c.promptData.question=n.getCustomString(o.prompt.question),c.promptData.yesButtonLabel=n.getCustomString(o.prompt.yesLabel),c.promptData.noButtonLabel=n.getCustomString(o.prompt.noLabel),c.ratingData.question=n.getCustomString(o.rating.question),c.ratingData.isZeroBased=o.rating.isZeroBased,c.commentData.question=n.getCustomString(o.comment.question);for(var l=0,p=o.rating.ratingValuesAscending;l<p.length;l++){var h=p[l],f=n.getCustomString(h);if(d(f))return null;r.push(f)}return c.ratingData.ratingValuesAscending=r,d(c.ratingData.question)||d(c.commentData.question)||d(c.promptData.title)||d(c.promptData.question)||d(c.promptData.yesButtonLabel)||d(c.promptData.noButtonLabel)||d(c.ratingData.ratingValuesAscending)?null:this.make(c)},e.prototype.getType=function(){return o.Type.Nlqs},e.prototype.getSurveyInfo=function(){return this.surveyInfo},e.prototype.getCommentComponent=function(){return this.question},e.prototype.getPromptComponent=function(){return this.prompt},e.prototype.getRatingComponent=function(){return this.rating},e.prototype.getComponent=function(t){switch(t){case"Comment":return this.getCommentComponent();case"Prompt":return this.getPromptComponent();case"Rating":return this.getRatingComponent();default:return null}},e.prototype.getDomElements=function(t){if(d(t))throw new Error("Document must not be null");var e=t.createElement(o.DOM_NLQS_TAGNAME);return this.getSurveyInfo().getDomElements(t).forEach((function(t){d(t)||e.appendChild(t)})),this.getCommentComponent().getDomElements(t).forEach((function(t){d(t)||e.appendChild(t)})),this.getRatingComponent().getDomElements(t).forEach((function(t){d(t)||e.appendChild(t)})),[e]},e.prototype.getJsonElements=function(){var t={};return t=h(this.getSurveyInfo().getJsonElements(),t),t=h(this.getCommentComponent().getJsonElements(),t),t=h(this.getRatingComponent().getJsonElements(),t)},e}(l.Survey);!function(t){var e=function(){};t.NlqsSurveyData=e}(f||(f={})),t.exports=f},function(t,e,n){"use strict";var i,r=this&&this.__extends||(i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),o=n(4),a=n(7),s=n(13),u=n(14),c=n(15),l=n(1),p=n(11),d=n(9),h=l.isNOU,f=l.overrideValues,g=function(t){function e(e){var n=t.call(this)||this;if(!e)throw new Error("data must not be null");return n.surveyInfo=new d(e.baseData),n.prompt=new u(e.promptData),n.question=new s(e.commentData),n.rating=new c(e.ratingData),n}return r(e,t),e.make=function(t){try{return new e(t)}catch(t){return null}},e.makeCustom=function(t,n,i){if(h(t)||h(n)||h(i))return null;var r=[],o=i.content;if(h(o)||h(o.comment)||h(o.prompt)||h(o.rating))return null;var a=new e.NpsSurveyData;a.baseData=t,a.promptData=new u.PromptComponentData,a.ratingData=new c.RatingComponentData,a.commentData=new s.CommentComponentData,a.promptData.title=n.getCustomString(o.prompt.title),a.promptData.question=n.getCustomString(o.prompt.question),a.promptData.yesButtonLabel=n.getCustomString(o.prompt.yesLabel),a.promptData.noButtonLabel=n.getCustomString(o.prompt.noLabel),a.ratingData.question=n.getCustomString(o.rating.question),a.ratingData.isZeroBased=o.rating.isZeroBased,a.commentData.question=n.getCustomString(o.comment.question);for(var l=0,p=o.rating.ratingValuesAscending;l<p.length;l++){var d=p[l],f=n.getCustomString(d);if(h(f))return null;r.push(f)}return a.ratingData.ratingValuesAscending=r,h(a.ratingData.question)||h(a.commentData.question)||h(a.promptData.title)||h(a.promptData.question)||h(a.promptData.yesButtonLabel)||h(a.promptData.noButtonLabel)||h(a.ratingData.ratingValuesAscending)?null:this.make(a)},e.make5Point=function(t,n){if(!t||!n)return null;var i=new e.NpsSurveyData;i.baseData=t,i.ratingData=new c.RatingComponentData,i.ratingData.isZeroBased=!1,i.commentData=new s.CommentComponentData,i.promptData=new u.PromptComponentData,i.ratingData.question=n.loadStringResource(4),i.commentData.question=n.loadStringResource(21),i.promptData.title=n.loadStringResource(0),i.promptData.question=n.loadStringResource(1),i.promptData.yesButtonLabel=n.loadStringResource(2),i.promptData.noButtonLabel=n.loadStringResource(3);var r=new Array(5);return r[0]=n.loadStringResource(16),r[1]=n.loadStringResource(17),r[2]=n.loadStringResource(18),r[3]=n.loadStringResource(19),r[4]=n.loadStringResource(20),i.ratingData.question&&i.commentData.question&&i.promptData.title&&i.promptData.question&&i.promptData.yesButtonLabel&&i.promptData.noButtonLabel&&r[0]&&r[1]&&r[2]&&r[3]&&r[4]?(i.ratingData.ratingValuesAscending=r,this.make(i)):null},e.make11Point=function(t,n){if(!t||!n)return null;var i=new e.NpsSurveyData;i.baseData=t,i.ratingData=new c.RatingComponentData,i.ratingData.isZeroBased=!0,i.commentData=new s.CommentComponentData,i.promptData=new u.PromptComponentData,i.ratingData.question=n.loadStringResource(4),i.commentData.question=n.loadStringResource(21),i.promptData.title=n.loadStringResource(0),i.promptData.question=n.loadStringResource(1),i.promptData.yesButtonLabel=n.loadStringResource(2),i.promptData.noButtonLabel=n.loadStringResource(3);var r=new Array(11);return r[0]=n.loadStringResource(5),r[1]=n.loadStringResource(6),r[2]=n.loadStringResource(7),r[3]=n.loadStringResource(8),r[4]=n.loadStringResource(9),r[5]=n.loadStringResource(10),r[6]=n.loadStringResource(11),r[7]=n.loadStringResource(12),r[8]=n.loadStringResource(13),r[9]=n.loadStringResource(14),r[10]=n.loadStringResource(15),i.ratingData.question&&i.commentData.question&&i.promptData.title&&i.promptData.question&&i.promptData.yesButtonLabel&&i.promptData.noButtonLabel&&r[0]&&r[1]&&r[2]&&r[3]&&r[4]&&r[5]&&r[6]&&r[7]&&r[8]&&r[9]&&r[10]?(i.ratingData.ratingValuesAscending=r,this.make(i)):null},e.prototype.getType=function(){return o.Type.Nps},e.prototype.getSurveyInfo=function(){return this.surveyInfo},e.prototype.getCommentComponent=function(){return this.question},e.prototype.getPromptComponent=function(){return this.prompt},e.prototype.getRatingComponent=function(){return this.rating},e.prototype.getComponent=function(t){switch(t){case"Comment":return this.getCommentComponent();case"Prompt":return this.getPromptComponent();case"Rating":return this.getRatingComponent();default:return null}},e.prototype.getDomElements=function(t){if(!t)throw new Error("Document must not be null");var e=t.createElement(o.DOM_NPS_TAGNAME);return this.getSurveyInfo().getDomElements(t).forEach((function(t){t&&e.appendChild(t)})),this.getCommentComponent().getDomElements(t).forEach((function(t){t&&e.appendChild(t)})),this.getRatingComponent().getDomElements(t).forEach((function(t){t&&e.appendChild(t)})),[e]},e.prototype.getJsonElements=function(){var t,e={};return e=f(this.getSurveyInfo().getJsonElements(),e),e=f(this.getCommentComponent().getJsonElements(),e),(e=f(this.getRatingComponent().getJsonElements(),e))[a.JSON_APPLICATION_KEYNAME]={},e[a.JSON_APPLICATION_KEYNAME][a.JSON_EXTENDEDMANIFESTDATA_KEYNAME]=JSON.stringify(((t={})[a.JSON_SURVEYSTRINGS_KEYNAME]=this.makeSurveyStrings(),t)),e},e.prototype.makeSurveyStrings=function(){var t={};return this.prompt&&(t[a.JSON_PROMPT_KEYNAME]=this.prompt.getComponentJson()),this.rating&&(t[a.JSON_RATING_KEYNAME]=[this.rating.getComponentJson()]),this.question&&(t[a.JSON_COMMENT_KEYNAME]=[this.question.getComponentJson()]),JSON.stringify(t)},e}(p.Survey);!function(t){var e=function(){};t.NpsSurveyData=e}(g||(g={})),t.exports=g},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.toJson=function(t){return JSON.stringify(t)},t.fromJson=function(t){return JSON.parse(t)},t}();e.FloodgateSettings=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(10),r=n(20),o=n(1).isNOU,a=function(t,e){this.name=t,this.cooldownSeconds=e},s=function(){function t(t){if(!t)throw new Error("channelStateProvider must not be null");this.channelStateProvider=t,this.loadChannels()}return t.prototype.refreshChannelData=function(){this.loadChannels()},t.prototype.getAvailableChannelData=function(){var t=[];for(var e in this.channels)if(this.channels.hasOwnProperty(e)){var n=this.channels[e];n.isOpen()&&t.push(n)}return t},t.prototype.isChannelOpen=function(t){if(o(t))throw new Error("type must not be null");return this.channels[t].isOpen()},t.prototype.startChannelCooldown=function(t,e){if(o(t))throw new Error("type must not be null");e=e||new Date,this.channels[t].setCooldownStartTime(e),this.saveChannelStates()},t.prototype.saveChannelStates=function(){var t=[];for(var e in this.channels)if(this.channels.hasOwnProperty(e)){var n=this.channels[e],i=new r.GovernedChannelState(n.getType(),n.getCooldownStartTime());t.push(i)}this.channelStateProvider.save(t)},t.prototype.loadChannels=function(){for(var e in this.loadChannelStatesFromProvider(),i.GovernedChannelType)if(i.GovernedChannelType.hasOwnProperty(e)){var n=Number(e);if(isNaN(n)||this.channels[n])continue;var r=t.defaultChannelData[n],o=new i.GovernedChannel(n,r.name,r.cooldownSeconds,null);this.channels[n]=o}},t.prototype.loadChannelStatesFromProvider=function(){this.channels=[];var e=this.channelStateProvider.load();for(var n in e)if(e.hasOwnProperty(n)){var r=e[n],o=r.getType(),a=t.defaultChannelData[o],s=new i.GovernedChannel(o,a.name,a.cooldownSeconds,r.getCooldownStartTime());this.channels[s.getType()]=s}},t.minute=60,t.hour=60*t.minute,t.day=24*t.hour,t.defaultChannelData=[new a(i.GovernedChannelType[i.GovernedChannelType.Standard],14*t.day),new a(i.GovernedChannelType[i.GovernedChannelType.Urgent],0),new a(i.GovernedChannelType[i.GovernedChannelType.Banner],15*t.day),new a(i.GovernedChannelType[i.GovernedChannelType.TeachingMessage],15*t.day)],t}();e.Governor=s},function(t,e,n){"use strict";var i=n(40),r=n(3),o=n(41),a=n(21),s=[],u=0,c=function(){function t(t,e){if(!t)throw new Error("callback must not be null");this.trackedActivityMap={},this.callback=t,this.loggerCallback=e}return t.prototype.logActivity=function(t,e){void 0===e&&(e=1),this.logActivity_private(t,0,e,null)},t.prototype.logActivityStartTime=function(t,e){this.logActivity_private(t,1,0,e)},t.prototype.logActivityStopTime=function(t,e){this.logActivity_private(t,2,0,e)},t.prototype.setSurveys=function(t,e){if(void 0===e&&(e=new a.SurveyStatCollectionEventActivity),t&&0!==t.length&&e){for(var n=new Object,r=0,s=t;r<s.length;r++){for(var u=s[r],c=u.getSurveyInfo().getActivationEvent().getTrackingSet(),l=!1,p=0,d=c.getList();p<d.length;p++){var h=d[p];if(n.hasOwnProperty(h.getActivity())){l=!0;break}}if(!l){for(var f=e.getBySurveyId(u.getSurveyInfo().getId()),g=[c.getList().length],v=new Array(c.getList().length),m=0,y=0,S=0,T=c.getList();S<T.length;S++){h=T[S];g[y]=0,h.getIsAggregate()&&f&&m<f.Counts.length&&(g[y]=f.Counts[m++]),v[y]=this.trackedActivityMap[h.getActivity()],y++}var C=new i(c);C.initCounts(g,v,!1);for(var E=0,A=C.generateActivityIndexList();E<A.length;E++){var _=A[E],w=new o.IndexedTracker;w.index=_.index,w.survey=u,w.tracker=C,n[_.activity]=w}}}this.copyObject(this.trackedActivityMap,n)}},t.prototype.clearSurveys=function(){var t=this;Object.getOwnPropertyNames(this.trackedActivityMap).forEach((function(e){delete t.trackedActivityMap[e]}))},t.prototype.getCount=function(t){var e;return(e=this.trackedActivityMap[t])?e.tracker.getCount(e.index):0},t.prototype.getSessionCount=function(t){var e;return(e=this.trackedActivityMap[t])?e.tracker.getSessionCount(e.index):0},t.prototype.moveSessionCountIntoBaseCount=function(t){var e;return(e=this.trackedActivityMap[t])?e.tracker.moveSessionCountIntoBaseCount(e.index):0},t.prototype.getSurvey=function(t){var e;return(e=this.trackedActivityMap[t])?e.survey:null},t.prototype.setCallback=function(t){this.callback=t},t.prototype.resetQueuedActivities=function(){s=[]},t.prototype.logActivity_private=function(e,n,i,o){var a=this;if(this.callback&&!this.callback.shouldAcceptActivity(e)&&(u++,s.length<t.MaxPendingActivitiesQueueSize&&s.push({activityName:e,logType:n,increment:i,timestamp:o})),e===t.FloodgateStartActivityName){if(u>0){var c=this.loggerCallback&&this.loggerCallback();c&&c.log_Event(r.TelemetryEvent.SurveyActivity.LogActivity.EventsReprocessed,{Count:s.length,Dropped:u-s.length}),s.map((function(t){return a.logActivity_core(t.activityName,t.logType,t.increment,t.timestamp)}))}return u=0,void this.resetQueuedActivities()}this.logActivity_core(e,n,i,o)},t.prototype.logActivity_core=function(t,e,n,i){var r=this.trackedActivityMap[t];if(r){switch(e){case 1:return void r.tracker.startTime(r.index,i);case 2:n=r.tracker.stopTime(r.index,i);case 0:break;default:return}2===r.tracker.incrementActivity(r.index,n)&&this.executeCallback(r.survey)}},t.prototype.executeCallback=function(t){this.callback.run(t)},t.prototype.copyObject=function(t,e){Object.keys(e).forEach((function(n){t[n]=e[n]}))},t.FloodgateStartActivityName="FloodgateFirstStart",t.MaxPendingActivitiesQueueSize=100,t}();t.exports=c},function(t,e,n){"use strict";var i=function(){function t(t){if(!t)throw new Error("trackingSet must not be null");if(t.getList().length>32)throw new Error("trackingSet list size must be less than 32");this.isOrdered=t.getIsOrdered(),this.trackedActivities=t.getList(),this.currentIndex=0,this.activationMask=0,this.currentActivationFlags=0,this.isActivationByInitPending=!1,this.currentCounts=new Array(this.trackedActivities.length),this.currentStartTimes=new Array(this.trackedActivities.length),this.currentSessionCounts=new Array(this.trackedActivities.length);for(var e=0;e<this.trackedActivities.length;e++)this.currentCounts[e]=0,this.currentSessionCounts[e]=0;for(e=0;e<this.trackedActivities.length;e++)this.activationMask|=1<<e,this.trackedActivities[e].getCount()<1&&this.trackedActivities[e].setCount(1)}return t.prototype.getCount=function(t){return this.isValidIndex(t)?this.currentCounts[t]:0},t.prototype.getSessionCount=function(t){return this.isValidIndex(t)?this.currentSessionCounts[t]:0},t.prototype.getStartTime=function(t){return this.isValidIndex(t)?this.currentStartTimes[t]:null},t.prototype.moveSessionCountIntoBaseCount=function(t){if(!this.isValidIndex(t))return 0;var e=this.currentSessionCounts[t];return this.currentSessionCounts[t]=0,e},t.prototype.initCounts=function(t,e,n){void 0===n&&(n=!1);for(var i=0;i<this.trackedActivities.length&&!(this.isOrdered&&i>this.currentIndex);i++)i<e.length&&e[i]&&(this.currentSessionCounts[i]=this.currentCounts[i]=e[i].tracker.getSessionCount(e[i].index),this.currentStartTimes[i]=e[i].tracker.getStartTime(e[i].index)),this.trackedActivities[i].getIsAggregate()&&i<t.length&&(this.currentCounts[i]+=t[i]),this.hasCountCrossedThreshold(i)&&this.finishActivityAtIndex(i);this.isActivated()&&!n&&(this.isActivationByInitPending=!0)},t.prototype.generateActivityIndexList=function(){for(var e=new Array,n=0;n<this.trackedActivities.length;n++){var i=new t.ActivityIndex;i.activity=this.trackedActivities[n].getActivity(),i.index=n,e.push(i)}return e},t.prototype.incrementActivity=function(t,e){if(!this.isValidIndex(t))return 0;if(e<0)throw new Error("increment must be non-negative");if(this.isOrdered&&t>this.currentIndex)return 0;var n=!this.hasCountCrossedThreshold(t);return this.currentCounts[t]+=e,this.currentSessionCounts[t]+=e,this.isActivationByInitPending?this.isPermittedIndexForActivationByInit(t)?this.commitActivation():0:n&&this.hasCountCrossedThreshold(t)?(this.finishActivityAtIndex(t),this.isActivated()?this.commitActivation():1):0},t.prototype.startTime=function(t,e){this.isValidIndex(t)&&(this.currentStartTimes[t]=e||new Date)},t.prototype.stopTime=function(t,e){if(!this.isValidIndex(t))return 0;var n=this.currentStartTimes[t];return this.currentStartTimes[t]=null,n?n>(e=e||new Date)?0:(e.getTime()-n.getTime())/1e3:0},t.prototype.isValidIndex=function(t){return t<this.trackedActivities.length},t.prototype.isActivated=function(){return(this.currentActivationFlags&this.activationMask)===this.activationMask},t.prototype.finishActivityAtIndex=function(t){if(!this.isValidIndex(t))throw new Error("Index is not valid");this.currentActivationFlags|=1<<t,t+1<this.trackedActivities.length&&(this.currentIndex=t+1)},t.prototype.hasCountCrossedThreshold=function(t){if(!this.isValidIndex(t))throw new Error("Index is not valid");return this.currentCounts[t]>=this.trackedActivities[t].getCount()},t.prototype.isPermittedIndexForActivationByInit=function(t){return!this.isOrdered||t+1===this.currentCounts.length},t.prototype.commitActivation=function(){return this.isActivationByInitPending=!1,2},t}();!function(t){var e=function(){};t.ActivityIndex=e}(i||(i={})),t.exports=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){};e.IndexedTracker=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(43);e.deserializeUserFacts=function(t){var e=[];for(var n in t.UserFacts)if(t.UserFacts.hasOwnProperty(n)){var r=t.UserFacts[n];r&&e.push(i.UserFact.deserialize(r))}return 0===e.length&&(e=null),e},e.validateUserFacts=function(t){if(t)for(var e in t)if(t.hasOwnProperty(e)&&!t[e])return!1;return!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),r=n(5),o=n(1),a=o.isNOU,s=o.isNumber,u=[0,1,2,3,4,5],c=function(){function t(t){this.input=t}return t.deserialize=function(e){return this.validate(e)?new t(e):null},t.validate=function(t){if(a(t))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Input is null or undefined for user fact"),!1;if(t&&a(t.Name)||a(t.Type)||a(t.Value))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Either of the required parameters Name: "+t.Name+", Type: "+t.Type+" or Value: "+t.Value+" are not provided for the user fact"),!1;if(!this.validateUserFactType(t.Type))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Invalid UserFactType value "+t.Type+" is provided for user fact"),!1;if(t.LatencyType&&!this.validateLatencyType(t.LatencyType))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Invalid LatencyType value "+t.LatencyType+" is provided for user fact of type "+t.Type),!1;if(t.LatencyType&&0!==t.LatencyType&&a(t.LatencyDurationInSeconds))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"LatencyDurationInSeconds value "+t.LatencyDurationInSeconds+" is not provided for user fact of type "+t.Type),!1;if(t.LatencyDurationInSeconds&&!s(t.LatencyDurationInSeconds))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Invalid LatencyDurationInSeconds value "+t.LatencyDurationInSeconds+" is provided for user fact of type "+t.Type),!1;if(1===t.Type&&a(t.IntervalType))return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecDeserialization.Failed,"Required parameter intervalType is not provided for user fact of type "+t.Type),!1;var e=0===t.Type||4===t.Type?[0,1]:u;return!(t.Comparator&&!function(t,e){return-1!==e.indexOf(t)}(t.Comparator,e))||(r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,"Unsupported comparator type for user fact of type "+t.Type),!1)},t.assertNever=function(t){return!1},t.validateLatencyType=function(t){return 0===t||3===t||1===t||2===t||this.assertNever(t)},t.validateUserFactType=function(t){return 0===t||2===t||3===t||4===t||1===t||this.assertNever(t)},t.prototype.isAMatch=function(t){if(!t||!t.userFactValue)return!1;if(!this.isLatencyAcceptable(t))return!1;try{return 0===this.getType()?function(t,e,n){var i=JSON.parse(e.userFactValue.toLowerCase());return l(!!t,!!i,n)}(this.getValue(),t,this.getComparator()):2===this.getType()?function(t,e,n){var i=Date.parse(e.userFactValue);if(!p(i,e.userFactValue,e.userFactName))return!1;var r=Date.parse(t);if(!p(r,t,null,2))return!1;return l(r,i,n)}(this.getValue(),t,this.getComparator()):3===this.getType()?function(t,e,n){var i=parseInt(e.userFactValue,10);if(!p(i,e.userFactValue,e.userFactName))return!1;return l(t,i,n)}(this.getValue(),t,this.getComparator()):4===this.getType()?function(t,e,n){return l(t.toLowerCase(),e.userFactValue.toLowerCase(),n)}(this.getValue(),t,this.getComparator()):1===this.getType()?function(t,e,n,o){var a=Date.parse(e.userFactValue);if(!p(a,e.userFactValue,e.userFactName))return!1;var s=Date.now(),u=0===o?s-a:a-s;if(u<0)return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,"Incorrect current time interval type was provided for user fact of type 1"),!1;return l(864e5*t,u,n)}(this.getValue(),t,this.getComparator(),this.getIntervalType()):(r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,"Unsupported type of user fact was provided"),!1)}catch(t){return r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,t),!1}},t.prototype.getType=function(){return this.input.Type},t.prototype.getName=function(){return this.input.Name},t.prototype.getValue=function(){return this.input.Value},t.prototype.getComparator=function(){return this.input.Comparator||0},t.prototype.getLatencyType=function(){return this.input.LatencyType||0},t.prototype.getLatencyDurationInSeconds=function(){return this.input.LatencyDurationInSeconds},t.prototype.getIntervalType=function(){return this.input.IntervalType},t.prototype.isLatencyAcceptable=function(t){var e=this.getType();return!(!a(this.getLatencyDurationInSeconds())&&!function(t,e,n){var i;switch(t){case 0:break;case 1:i=n.sourceDateTime;break;case 2:i=n.storageDateTime;break;case 3:i=n.clientIngestionDateTime}if(!a(i)){var r=Date.parse(i);return Date.now()-r<=1e3*e}return!0}(this.getLatencyType(),this.getLatencyDurationInSeconds(),t))||(r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,"Latency duration not acceptable for user fact of type "+e),!1)},t}();function l(t,e,n){switch(n){case 0:return e===t;case 1:return e!==t;case 2:return e>t;case 3:return e>=t;case 4:return e<t;case 5:return e<=t}}function p(t,e,n,o){if(!s(t)){var a="User fact "+n+" has invalid value "+e;return o&&(a="Invalid date time value "+e+" was provided for user fact of type "+o),r.FloodgateEngine.getTelemetryLogger().log_Error(i.TelemetryEvent.Floodgate.UserFactsSpecIsAMatch.Failed,a),!1}return!0}e.UserFact=c},function(t,e,n){var i;i=function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=15)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.low=0,this.high=0,this.low=parseInt(t,10),this.low<0&&(this.high=-1)}return t.prototype.Equals=function(e){var n=new t(e);return this.low===n.low&&this.high===n.high},t}();e.Int64=i;var r=function(){function t(t){this.low=0,this.high=0,this.low=parseInt(t,10)}return t.prototype.Equals=function(e){var n=new t(e);return this.low===n.low&&this.high===n.high},t}();e.UInt64=r;var o=function(){function t(){}return t.ToByte=function(t){return this.ToUInt8(t)},t.ToInt16=function(t){return 32767&t|(32768&t)<<16>>16},t.ToInt32=function(t){return 2147483647&t|2147483648&t},t.ToUInt8=function(t){return 255&t},t.ToUInt32=function(t){return 4294967295&t},t}();e.Number=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.NotSet=0]="NotSet",t[t.DistinguishedName=1]="DistinguishedName",t[t.GenericData=2]="GenericData",t[t.IPV4Address=3]="IPV4Address",t[t.IPv6Address=4]="IPv6Address",t[t.MailSubject=5]="MailSubject",t[t.PhoneNumber=6]="PhoneNumber",t[t.QueryString=7]="QueryString",t[t.SipAddress=8]="SipAddress",t[t.SmtpAddress=9]="SmtpAddress",t[t.Identity=10]="Identity",t[t.Uri=11]="Uri",t[t.Fqdn=12]="Fqdn",t[t.IPV4AddressLegacy=13]="IPV4AddressLegacy"}(e.AWTPiiKind||(e.AWTPiiKind={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(9),r=n(1),o=n(3),a=function(){function t(){}return t.getPayloadBlob=function(t,e){var n=new i.IO.MemoryStream,r=new i.CompactBinaryProtocolWriter(n);return r.WriteFieldBegin(i.BondDataType.BT_MAP,3),r.WriteMapContainerBegin(e,i.BondDataType.BT_STRING,i.BondDataType.BT_LIST),Object.keys(t).forEach((function(e){r.WriteString(e);var n=t[e];r.WriteContainerBegin(1,i.BondDataType.BT_STRUCT),r.WriteFieldBegin(i.BondDataType.BT_STRING,2),r.WriteString("act_default_source"),r.WriteFieldBegin(i.BondDataType.BT_STRING,5),r.WriteString(o.newGuid()),r.WriteFieldBegin(i.BondDataType.BT_INT64,6),r.WriteInt64(o.numberToBondInt64(Date.now())),r.WriteFieldBegin(i.BondDataType.BT_LIST,8),r.WriteContainerBegin(n.length,i.BondDataType.BT_STRUCT);for(var a=0;a<n.length;++a)r.WriteBlob(n[a]);r.WriteStructEnd(!1)})),r.WriteStructEnd(!1),n.GetBuffer()},t.getEventBlob=function(t){var e=new i.IO.MemoryStream,n=new i.CompactBinaryProtocolWriter(e);n.WriteFieldBegin(i.BondDataType.BT_STRING,1),n.WriteString(t.id),n.WriteFieldBegin(i.BondDataType.BT_INT64,3),n.WriteInt64(o.numberToBondInt64(t.timestamp)),n.WriteFieldBegin(i.BondDataType.BT_STRING,5),n.WriteString(t.type),n.WriteFieldBegin(i.BondDataType.BT_STRING,6),n.WriteString(t.name);var a=[],s=[];return Object.keys(t.properties).forEach((function(e){t.properties[e].pii===r.AWTPiiKind.NotSet?a.push(e):s.push(e)})),a.length&&(n.WriteFieldBegin(i.BondDataType.BT_MAP,13),n.WriteMapContainerBegin(a.length,i.BondDataType.BT_STRING,i.BondDataType.BT_STRING),a.forEach((function(e){n.WriteString(e),n.WriteString(t.properties[e].value)}))),s.length&&(n.WriteFieldBegin(i.BondDataType.BT_MAP,30),n.WriteMapContainerBegin(s.length,i.BondDataType.BT_STRING,i.BondDataType.BT_STRUCT),s.forEach((function(e){n.WriteString(e),n.WriteFieldBegin(i.BondDataType.BT_INT32,1),n.WriteInt32(1),n.WriteFieldBegin(i.BondDataType.BT_INT32,2),n.WriteInt32(t.properties[e].pii),n.WriteFieldBegin(i.BondDataType.BT_STRING,3),n.WriteString(t.properties[e].value),n.WriteStructEnd(!1)}))),n.WriteStructEnd(!1),e.GetBuffer()},t.base64Encode=function(t){return i.Encoding.Base64.GetString(t)},t}();e.default=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=/[xy]/g;e.numberToBondInt64=function(t){var e=new i.Int64("0");return e.low=4294967295&t,e.high=Math.floor(t/4294967296),e},e.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(r,(function(t){var e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)}))},e.isPii=function(t){return!isNaN(t)&&null!==t&&t>=0&&t<=13}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Version="1.2.2",e.FullVersionString="AWT-Web-CJS-"+e.Version},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1);e.AWTPiiKind=i.AWTPiiKind;var r=n(13);e.AWT=r.default,e.AWT_COLLECTOR_URL_UNITED_STATES="https://us.pipe.aria.microsoft.com/Collector/3.0/",e.AWT_COLLECTOR_URL_GERMANY="https://de.pipe.aria.microsoft.com/Collector/3.0/",e.AWT_COLLECTOR_URL_JAPAN="https://jp.pipe.aria.microsoft.com/Collector/3.0/",e.AWT_COLLECTOR_URL_AUSTRALIA="https://au.pipe.aria.microsoft.com/Collector/3.0/",e.AWT_COLLECTOR_URL_EUROPE="https://eu.pipe.aria.microsoft.com/Collector/3.0/"},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.BT_STOP=0]="BT_STOP",t[t.BT_STOP_BASE=1]="BT_STOP_BASE",t[t.BT_UINT8=3]="BT_UINT8",t[t.BT_UINT32=5]="BT_UINT32",t[t.BT_UINT64=6]="BT_UINT64",t[t.BT_STRING=9]="BT_STRING",t[t.BT_STRUCT=10]="BT_STRUCT",t[t.BT_LIST=11]="BT_LIST",t[t.BT_MAP=13]="BT_MAP",t[t.BT_INT32=16]="BT_INT32",t[t.BT_INT64=17]="BT_INT64",t[t.BT_UNAVAILABLE=127]="BT_UNAVAILABLE"}(e.BondDataType||(e.BondDataType={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(){}return t.GetBytes=function(t){for(var e=[],n=0;n<t.length;++n){var i=t.charCodeAt(n);i<128?e.push(i):i<2048?e.push(192|i>>6,128|63&i):i<55296||i>=57344?e.push(224|i>>12,128|i>>6&63,128|63&i):(i=65536+((1023&i)<<10|1023&t.charCodeAt(++n)),e.push(240|i>>18,128|i>>12&63,128|i>>6&63,128|63&i))}return e},t}();e.Utf8=r;var o=function(){function t(){}return t.GetString=function(t){for(var e,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=[],r=t.length%3,o=0,a=t.length-r;o<a;o+=3){var s=(t[o]<<16)+(t[o+1]<<8)+t[o+2];i.push([n.charAt((e=s)>>18&63),n.charAt(e>>12&63),n.charAt(e>>6&63),n.charAt(63&e)].join(""))}switch(r){case 1:s=t[t.length-1],i.push(n.charAt(s>>2)),i.push(n.charAt(s<<4&63)),i.push("==");break;case 2:var u=(t[t.length-2]<<8)+t[t.length-1];i.push(n.charAt(u>>10)),i.push(n.charAt(u>>4&63)),i.push(n.charAt(u<<2&63)),i.push("=")}return i.join("")},t}();e.Base64=o;var a=function(){function t(){}return t.GetBytes=function(t){for(var e=[];4294967168&t;)e.push(127&t|128),t>>>=7;return e.push(127&t),e},t}();e.Varint=a;var s=function(){function t(){}return t.GetBytes=function(t){for(var e=t.low,n=t.high,i=[];n||4294967168&e;)i.push(127&e|128),e=(127&n)<<25|e>>>7,n>>>=7;return i.push(127&e),i},t}();e.Varint64=s;var u=function(){function t(){}return t.EncodeZigzag32=function(t){return(t=i.Number.ToInt32(t))<<1^t>>31},t.EncodeZigzag64=function(t){var e=t.low,n=t.high,r=n<<1|e>>>31,o=e<<1;2147483648&n&&(r=~r,o=~o);var a=new i.UInt64("0");return a.low=o,a.high=r,a},t}();e.Zigzag=u},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(0),r=function(){function t(){this._buffer=[]}return t.prototype.WriteByte=function(t){this._buffer.push(i.Number.ToByte(t))},t.prototype.Write=function(t,e,n){for(;n--;)this.WriteByte(t[e++])},t.prototype.GetBuffer=function(){return this._buffer},t}();e.MemoryStream=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6);e.BondDataType=i.BondDataType;var r=n(7);e.Encoding=r;var o=n(8);e.IO=o;var a=n(0);e.Int64=a.Int64,e.UInt64=a.UInt64,e.Number=a.Number;var s=function(){function t(t){this._stream=t}return t.prototype.WriteBlob=function(t){this._stream.Write(t,0,t.length)},t.prototype.WriteContainerBegin=function(t,e){this.WriteUInt8(e),this.WriteUInt32(t)},t.prototype.WriteMapContainerBegin=function(t,e,n){this.WriteUInt8(e),this.WriteUInt8(n),this.WriteUInt32(t)},t.prototype.WriteFieldBegin=function(t,e){e<=5?this._stream.WriteByte(t|e<<5):e<=255?(this._stream.WriteByte(192|t),this._stream.WriteByte(e)):(this._stream.WriteByte(224|t),this._stream.WriteByte(e),this._stream.WriteByte(e>>8))},t.prototype.WriteInt32=function(t){t=r.Zigzag.EncodeZigzag32(t),this.WriteUInt32(t)},t.prototype.WriteInt64=function(t){this.WriteUInt64(r.Zigzag.EncodeZigzag64(t))},t.prototype.WriteString=function(t){if(""===t)this.WriteUInt32(0);else{var e=r.Utf8.GetBytes(t);this.WriteUInt32(e.length),this._stream.Write(e,0,e.length)}},t.prototype.WriteStructEnd=function(t){this.WriteUInt8(t?i.BondDataType.BT_STOP_BASE:i.BondDataType.BT_STOP)},t.prototype.WriteUInt32=function(t){var e=r.Varint.GetBytes(a.Number.ToUInt32(t));this._stream.Write(e,0,e.length)},t.prototype.WriteUInt64=function(t){var e=r.Varint64.GetBytes(t);this._stream.Write(e,0,e.length)},t.prototype.WriteUInt8=function(t){this._stream.WriteByte(a.Number.ToUInt8(t))},t}();e.CompactBinaryProtocolWriter=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this._killedTokenDictionary={}}return t.prototype.setKillSwitchTenants=function(t,e){var n=this;if(t&&e)try{var i=t.split(",");if("this-request-only"===e)return i;var r=1e3*parseInt(e,10);i.forEach((function(t){n._killedTokenDictionary[t]=Date.now()+r}))}catch(t){return[]}return[]},t.prototype.isTenantKilled=function(t){return void 0!==this._killedTokenDictionary[t]&&this._killedTokenDictionary[t]>Date.now()||(delete this._killedTokenDictionary[t],!1)},t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=function(){function t(t,e){this._maxRequestSize=t,this._outboundQueue=e,this._currentBatch={},this._currentBatchSize=0}return t.prototype.addEventToBatch=function(t){var e=i.default.getEventBlob(t);e.length>this._maxRequestSize||(this._currentBatchSize+e.length>this._maxRequestSize?this.flushBatch():(void 0===this._currentBatch[t.tenantToken]&&(this._currentBatch[t.tenantToken]=[]),this._currentBatch[t.tenantToken].push(e),this._currentBatchSize+=e.length))},t.prototype.flushBatch=function(){this._currentBatchSize>0&&(this._outboundQueue.push(this._currentBatch),this._currentBatch={},this._currentBatchSize=0)},t}();e.default=r},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){}return t.shouldRetryForStatus=function(t){return!(t>=300&&t<500&&408!==t||501===t||505===t)},t.getMillisToBackoffForRetry=function(t){var e,n=Math.floor(1200*Math.random())+2400;return e=Math.pow(4,t)*n,Math.min(e,12e4)},t}();e.default=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(1),r=n(14),o=n(3),a=n(4),s=/^[a-zA-Z0-9]([a-zA-Z0-9]|_){2,98}[a-zA-Z0-9]$/,u=/\./g,c=/^[a-zA-Z0-9](([a-zA-Z0-9|_|\.]){0,98}[a-zA-Z0-9])?$/,l=function(){function t(){}return t.initialize=function(t,e){if(void 0===e&&(e={}),this._isInitialized)throw"Already Initialized";this._defaultTenantToken=t,this._overrideValuesFromConfig(e),r.default.initialize(this._config),this._isInitialized=!0},t.flush=function(t){this._isInitialized&&!this._isDestroyed&&r.default.flush(t)},t.flushAndTeardown=function(){this._isInitialized&&!this._isDestroyed&&(this._isDestroyed=!0,r.default.flushAndTeardown())},t.setContext=function(t,e,n){void 0===n&&(n="allTkns"),null!==(e=this._sanitizeProperty(t,e))&&(this._contextProperties[n]||(this._contextProperties[n]={}),this._contextProperties[n][t]=e)},t.logEvent=function(t){var e=this;if(this._isInitialized){if(!t.name||!t.properties)return;t.name=t.name.toLowerCase(),t.name.replace(u,"_");var n="";if(t.type?(t.type.toLowerCase(),n="custom."):t.type="custom",!s.test(t.name)||!s.test(t.type))return;if(t.type=n+t.type,isNaN(t.timestamp)&&(t.timestamp=(new Date).getTime()),t.tenantToken||(t.tenantToken=this._defaultTenantToken),t.id=o.newGuid(),Object.keys(t.properties).forEach((function(n){t.properties[n]=e._sanitizeProperty(n,t.properties[n]),null===t.properties[n]&&delete t.properties[n]})),this._addContextIfAbsent(t,t.tenantToken),this._addContextIfAbsent(t,"allTkns"),0===Object.keys(t.properties).length)return;this._setDefaultProperty(t,"EventInfo.InitId",this._getInitId(t.tenantToken)),this._setDefaultProperty(t,"EventInfo.Sequence",this._getSequenceId(t.tenantToken)),this._setDefaultProperty(t,"EventInfo.SdkVersion",a.FullVersionString),this._setDefaultProperty(t,"EventInfo.Name",t.name),this._setDefaultProperty(t,"EventInfo.Time",new Date(t.timestamp).toISOString()),r.default.sendEvent(t)}},t._overrideValuesFromConfig=function(t){t.collectorUrl&&(this._config.collectorUrl=t.collectorUrl),t.sendingTimer>1e3&&(this._config.sendingTimer=t.sendingTimer)},t._getInitId=function(t){return void 0===this._initIdMap[t]&&(this._initIdMap[t]=o.newGuid()),this._initIdMap[t]},t._getSequenceId=function(t){return void 0===this._sequenceIdMap[t]&&(this._sequenceIdMap[t]=0),(++this._sequenceIdMap[t]).toString()},t._setDefaultProperty=function(t,e,n){t.properties[e]={value:n,pii:i.AWTPiiKind.NotSet}},t._addContextIfAbsent=function(t,e){if(this._contextProperties[e]){var n=this._contextProperties[e];Object.keys(n).forEach((function(e){t.properties[e]||(t.properties[e]=n[e])}))}},t._sanitizeProperty=function(t,e){return"string"!=typeof e&&"number"!=typeof e&&"boolean"!=typeof e||(e={value:e}),c.test(t)&&null!=e&&null!==e.value&&void 0!==e.value&&""!==e.value?(void 0===e.pii&&(e.pii=i.AWTPiiKind.NotSet),e.value=e.value.toString(),o.isPii(e.pii)?e:null):null},t._isInitialized=!1,t._isDestroyed=!1,t._contextProperties={},t._sequenceIdMap={},t._initIdMap={},t._config={collectorUrl:"https://browser.pipe.aria.microsoft.com/Collector/3.0/",sendingTimer:1e3},t}();e.default=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(11),r=n(2),o=n(12),a=n(10),s=n(4),u=function(){function t(){}return t.initialize=function(t){this._inboundQueues.push([]),this._recordBatcher=new i.default(2936012,this._outboundQueue),this._newEventsAllowed=!0,"undefined"==typeof Uint8Array&&(this._urlString+="&content-encoding=base64"),this._sendingTimer=t.sendingTimer,this._urlString=t.collectorUrl+this._urlString+"&x-apikey="},t.sendEvent=function(t){var e=this;this._newEventsAllowed&&(this._inboundQueues[this._inboundQueues.length-1].push(t),!this._running&&this._timeout<0&&!this._isCurrentlyFlushing&&(this._timeout=setTimeout((function(){return e._batchAndSendEvents(!1)}),this._sendingTimer)))},t.flushAndTeardown=function(){this._newEventsAllowed=!1,this._batchAndSendEvents(!0)},t.flush=function(t){this._inboundQueues.push([]),this._isCurrentlyFlushing?this._flushQueue.push(t):(this._isCurrentlyFlushing=!0,this._flush(t))},t._batchAndSendEvents=function(t){for(this._running=!0;this._inboundQueues[0].length>0&&this._outboundQueue.length<1;)this._recordBatcher.addEventToBatch(this._inboundQueues[0].pop());0===this._outboundQueue.length&&this._recordBatcher.flushBatch(),this._sendRequest(this._outboundQueue.pop(),0,t)},t._retryRequestIfNeeded=function(t,e,n,i,r){var a=this,s=!0;t&&void 0!==t.status&&(this._killSwitch.setKillSwitchTenants(t.getResponseHeader("kill-tokens"),t.getResponseHeader("kill-duration-seconds")).forEach((function(t){delete e[t],n--})),(!o.default.shouldRetryForStatus(t.status)||n<=0)&&(s=!1)),s&&r<4?setTimeout((function(){return a._sendRequest(e,r+1,!1)}),o.default.getMillisToBackoffForRetry(r)):this._handleRequestFinished(null)},t._sendRequest=function(t,e,n){var i=this;try{var o=new XMLHttpRequest,a=0,s="";if(Object.keys(t).forEach((function(e){i._killSwitch.isTenantKilled(e)?delete t[e]:(s.length>0&&(s+=","),s+=e,a++)})),o.open("POST",this._urlString+s,!n),n||(o.ontimeout=function(){i._retryRequestIfNeeded(o,t,a,s,e)},o.onerror=function(){i._retryRequestIfNeeded(o,t,a,s,e)},o.onload=function(){i._handleRequestFinished(o)}),a>0){var u=r.default.getPayloadBlob(t,a);"undefined"==typeof Uint8Array?o.send(r.default.base64Encode(u)):o.send(new Uint8Array(u))}else n&&this._handleRequestFinished(null)}catch(t){this._handleRequestFinished(null)}},t._handleRequestFinished=function(t){var e=this;t&&this._killSwitch.setKillSwitchTenants(t.getResponseHeader("kill-tokens"),t.getResponseHeader("kill-duration-seconds")),this._inboundQueues[0].length>0?this._timeout=setTimeout((function(){return e._batchAndSendEvents(!1)}),this._sendingTimer):(this._timeout=-1,this._running=!1)},t._flush=function(t){var e=this;this._running||(this._timeout>-1&&(clearTimeout(this._timeout),this._timeout=-1),this._inboundQueues[0].length>0&&this._batchAndSendEvents(!1)),this._checkPrimaryInboundQueueEmpty((function(){e._inboundQueues.shift(),null!=t&&t(),e._flushQueue.length>0?setTimeout((function(){return e._flush(e._flushQueue.shift())}),e._sendingTimer):(e._isCurrentlyFlushing=!1,e._inboundQueues[0].length>0&&(e._timeout=setTimeout((function(){return e._batchAndSendEvents(!1)}),e._sendingTimer)))}))},t._checkPrimaryInboundQueueEmpty=function(t){var e=this;0===this._inboundQueues[0].length?this._checkOutboundQueueEmptyAndSent(t):setTimeout((function(){return e._checkPrimaryInboundQueueEmpty(t)}),250)},t._checkOutboundQueueEmptyAndSent=function(t){var e=this;this._running?setTimeout((function(){return e._checkOutboundQueueEmptyAndSent(t)}),250):t()},t._outboundQueue=[],t._inboundQueues=[],t._newEventsAllowed=!1,t._killSwitch=new a.default,t._isCurrentlyFlushing=!1,t._flushQueue=[],t._running=!1,t._timeout=-1,t._urlString="?qsp=true&content-type=application%2Fbond-compact-binary&client-id=NO_AUTH&sdk-version="+s.FullVersionString,t}();e.default=u},function(t,e,n){t.exports=n(5)}])},t.exports=i()},function(t,e,n){"use strict";n.r(e);n(22);var i,r="0.0.0",o=n(0),a=o.Utils.guid,s=o.Utils.overrideValues,u=o.Utils.isNOU,c=o.Utils.isBoolean,l=o.Utils.isString,p=o.Utils.isObject;function d(t,e){if(!p(t))throw e+" is not an object: "+t}function h(t,e){if(!function(t){return"number"==typeof t}(t))throw e+" is not a number: "+t}function f(t,e){if(!l(t))throw e+" is not a string: "+t}function g(t,e){if(!c(t))throw e+" is not a boolean: "+t}function v(t,e){var n=new Promise((function(e,n){var i=setTimeout((function(){clearTimeout(i),n("Timed out in "+t+"ms.")}),t)}));return Promise.race([e,n])}!function(t){t[t.Smile=0]="Smile",t[t.Frown=1]="Frown",t[t.Idea=2]="Idea",t[t.Bug=3]="Bug"}(i||(i={}));var m=function(){function t(){}return t.WebSurfacesLink="https://contentstorage.osi.office.net/dynamiccanvas/programmablesurfaces/prod/officewebsurfaces.core.min.js",t}(),y=function(){function t(){}return t.TMSAppID="4c4f550b-42b2-4a16-93f9-fdb9e01bb6ed",t.TULIPSAppID="05c88d91-956e-46b4-91b0-77a33cc21a4d",t}(),S=["af","am","ar","as","az","be","bg","bn-BD","bn-IN","bs","ca","ca-Es-VALENCIA","chr-Cher","cs","cy","da","de","el","en-GB","es","es-MX","et","eu","fa","fi","fil","fr","fr-CA","ga","gd","gl","gu","ha-Latn-NG","he","hi","hr","hu","hy","id","is","it","ja","ka","kk","km-KH","kn","ko","kok","ky","lb","lo","lt","lv","mi","mk","ml","mn","mr","ms","mt","nb-NO","ne","nl","nn-NO","or","pa","pl","prs","pt-BR","pt-PT","quz","ro","ru","sd","si","sk","sl","sq","sr-Cyrl-BA","sr-Cyrl-RS","sr-Latn-RS","sv","sw","ta","te","th","tk","tr","tt","ug","uk","ur","uz-Latn-UZ","vi","zh-Hans","zh-Hant"],T={"ZH-CN":"zh-Hans","ZH-HK":"zh-Hant","ZH-MO":"zh-Hant","ZH-SG":"zh-Hans","ZH-TW":"zh-Hant"};var C=new(function(){function t(){}return t.validateCategoryOptions=function(t){if(!t)return{show:!1};if(g(t.show,"categories.show"),t.customCategories){!function(t,e){if(!Array.isArray(t))throw e+" is not an array: "+t}(t.customCategories,"categories.customCategories");for(var e=0,n=t.customCategories;e<n.length;e++){var i=n[e];if(f(i,"custom category '"+i+"'"),i.length>20)throw"custom category '"+i+"' too long, max 20 characters."}}return t},t.prototype.getCommonInitOptions=function(){return this.commonInitOptions},t.prototype.getInAppFeedbackInitOptions=function(){return this.inAppFeedbackInitOptions},t.prototype.getInAppFeedbackLaunchOptions=function(){return this.inAppFeedbackLaunchOptions},t.prototype.getFloodgateInitOptions=function(){return this.floodgateInitOptions},t.prototype.getFloodgateSurvey=function(){return this.floodgateSurvey},t.prototype.getSdkSessionId=function(){return this.sdkSessionId||(this.sdkSessionId=a()),this.sdkSessionId},t.prototype.setCommonInitOptions=function(t){d(t,"passedInitOptions");var e={appId:t.appId,applicationGroup:t.applicationGroup||{},build:t.build,cid:t.cid,environment:t.environment,intlFilename:t.intlFilename,intlUrl:t.intlUrl,webSurfacesResourceBaseUrl:t.webSurfacesResourceBaseUrl,locale:t.locale,onError:t.onError,originalLocale:t.locale,primaryColour:t.primaryColour,secondaryColour:t.secondaryColour,sessionId:t.sessionId,stylesUrl:t.stylesUrl,telemetryGroup:t.telemetryGroup||{},userEmail:t.userEmail,userEmailConsentDefault:t.userEmailConsentDefault,webGroup:t.webGroup||{}};if(h(e.appId,"initOptions.appId"),!(e.appId%1==0&&e.appId>0))throw"initOptions.appId is not a positive integer: "+e.appId;if(f(e.stylesUrl,"initOptions.stylesUrl"),f(e.intlUrl,"initOptions.intlUrl"),void 0!==e.intlFilename?f(e.intlFilename,"initOptions.intlFilename"):e.intlFilename="officebrowserfeedbackstrings.js",h(e.environment,"initOptions.environment"),1!==e.environment&&0!==e.environment)throw"initOptions.environment has a bad value: "+e.environment;if(void 0!==e.userEmail&&f(e.userEmail,"initOptions.userEmail"),void 0!==e.userEmailConsentDefault&&g(e.userEmailConsentDefault,"initOptions.userEmailConsentDefault"),void 0!==e.sessionId?f(e.sessionId,"initOptions.sessionId"):e.sessionId="00000000-0000-0000-0000-000000000000",e.telemetryGroup.processSessionId=e.sessionId,void 0!==e.cid&&(f(e.cid,"initOptions.cid"),e.applicationGroup.extendedManifestData=JSON.stringify({cid:e.cid})),void 0!==e.build){f(e.build,"initOptions.build");new RegExp("^[0-9]{1,9}(\\.[0-9]{1,9})?(\\.[0-9]{1,9})?(\\.[0-9]{1,9})?$").test(e.build)||(e.build="0.0.0.0")}else e.build="0.0.0.0";e.telemetryGroup.officeBuild=e.build;var n=new RegExp("^#[0-9a-f]{3}([0-9a-f]{3})?$","i");void 0!==e.primaryColour&&(n.test(e.primaryColour)||(e.primaryColour=void 0)),void 0!==e.secondaryColour&&(n.test(e.secondaryColour)||(e.secondaryColour=void 0)),void 0!==e.locale?(f(e.locale,"initOptions.locale"),e.locale=function(t){var e=t.toLocaleUpperCase();if(e in T)return T[e];for(var n=0,i=S;n<i.length;n++){if((s=i[n]).toUpperCase()===e)return s}for(var r=e.split("-")[0],o=0,a=S;o<a.length;o++){var s;if((s=a[o]).toUpperCase()===r)return s}return"en"}(e.locale)):e.locale="en",void 0===e.onError&&(e.onError=function(t){}),this.commonInitOptions=e},t.prototype.setInAppFeedbackInitOptions=function(t){d(t,"passedInitOptions");var e={bugForm:t.bugForm,onDismiss:t.onDismiss,screenshot:t.screenshot,userEmail:t.userEmail,userVoice:void 0!==t.userVoice?{url:t.userVoice.url}:void 0};void 0===e.onDismiss&&(e.onDismiss=function(t){}),void 0!==e.bugForm?g(e.bugForm,"initOptions.bugForm"):e.bugForm=!1,void 0!==e.userEmail&&f(e.userEmail,"initOptions.userEmail"),void 0!==e.screenshot?g(e.screenshot,"initOptions.screenshot"):e.screenshot=!0,void 0!==e.userVoice&&(d(e.userVoice,"initOptions.userVoice"),f(e.userVoice.url,"initOptions.userVoice.url")),this.inAppFeedbackInitOptions=e},t.prototype.setInAppFeedbackLaunchOptions=function(e){if(!this.commonInitOptions)throw"commonInitOptions not set";e||(e={}),this.commonInitOptions.applicationGroup=s(e.applicationGroup,this.commonInitOptions.applicationGroup),this.commonInitOptions.telemetryGroup=s(e.telemetryGroup,this.commonInitOptions.telemetryGroup),this.commonInitOptions.webGroup=s(e.webGroup,this.commonInitOptions.webGroup),e.categories=t.validateCategoryOptions(e.categories),this.inAppFeedbackLaunchOptions=e},t.prototype.setFloodgateInitOptions=function(t){d(t,"passedInitOptions");var e={autoDismiss:t.autoDismiss,campaignDefinitions:t.campaignDefinitions,campaignFlights:t.campaignFlights,campaignQueryParameters:t.campaignQueryParameters,onDismiss:t.onDismiss,onSurveyActivatedCallback:t.onSurveyActivatedCallback,settingStorageCallback:t.settingStorageCallback,uIStringGetter:t.uIStringGetter,authTokenCallback:t.authTokenCallback};if(void 0===e.autoDismiss&&(e.autoDismiss=0),void 0===e.onDismiss&&(e.onDismiss=function(t,e){}),void 0===e.onSurveyActivatedCallback){e.onSurveyActivatedCallback={onSurveyActivated:function(t){t.launch()}}}void 0===e.uIStringGetter&&(e.uIStringGetter=function(t){return t}),this.floodgateInitOptions=e},t.prototype.setFloodgateSurvey=function(t){this.floodgateSurvey=t},t}());function E(){return C}var A=window,_=A.OfficeBrowserFeedback=A.OfficeBrowserFeedback||{},w=_.floodgate=_.floodgate||{};function b(){return A}var I=function(){function t(t,e){if(!t)throw new Error("name must not be null");if(!e)throw new Error("version must not be null");this.name=t,this.version=e}return t.prototype.getName=function(){return this.name},t.prototype.getPlatform=function(){return t.PLATFORM},t.prototype.getVersion=function(){return this.version},t.PLATFORM="Web",t}(),D=function(){function t(t){if(!t)throw new Error("id must not be null");this.id=t}return t.prototype.getId=function(){return this.id},t}(),F=function(){function t(t,e,n){this.id=t,this.sessionId=e,this.version=n}return t.prototype.getId=function(){return this.id},t.prototype.getSessionId=function(){return this.sessionId},t.prototype.getVersion=function(){return this.version},t}(),O=function(){function t(e,n,i){if(!e)throw new Error("name must not be null");if(!n)throw new Error("sessionId must not be null");if(!i&&0!==i||i<0)throw new Error("sequence must not be negative");this.name=e,this.id=n+t.ID_DELIMITER+i,this.sequence=i}return t.prototype.getName=function(){return this.name},t.prototype.getId=function(){return this.id},t.prototype.getSource=function(){return t.SOURCE},t.prototype.getSchemaVersion=function(){return t.SCHEMA_VERSION},t.prototype.getSequence=function(){return this.sequence},t.ID_DELIMITER=".",t.SOURCE="MsoThin",t.SCHEMA_VERSION=1,t}(),L=function(){function t(t){this.audienceGroup=t}return t.prototype.getAudienceGroup=function(){return this.audienceGroup},t}(),P=n(44);function N(){return P.AWT}var U,M,B,k=function(){function t(t,e,n,i,r,o){if(!t)throw new Error("tenantToken must not be null");if(!e)throw new Error("namespace must not be null");if(!n)throw new Error("app must not be null");if(!i)throw new Error("session must not be null");N().initialize(t),this.namespace=e,this.oesApp=n,this.oesSession=i,this.oesHost=r,this.oesRelease=o,this.sequence=1}return t.setApp=function(t,e){t["App.Name"]=e.getName(),t["App.Platform"]=e.getPlatform(),t["App.Version"]=e.getVersion()},t.setSession=function(t,e){t["Session.Id"]=e.getId()},t.setHost=function(t,e){e&&(t["Host.Id"]=e.getId(),t["Host.Version"]=e.getVersion())},t.setEvent=function(t,e){t["Event.Name"]=e.getName(),t["Event.Id"]=e.getId(),t["Event.Source"]=e.getSource(),t["Event.SchemaVersion"]=e.getSchemaVersion(),t["Event.Sequence"]=e.getSequence()},t.setRelease=function(t,e){e&&(t["Release.AudienceGroup"]=e.getAudienceGroup())},t.prototype.logEvent=function(e,n){if(!e)throw new Error("eventName must not be null");var i=new O(this.namespace+t.EVENT_NAME_DELIMITER+e,this.oesSession.getId(),this.sequence),r={};if(null!=n)for(var o in n)n.hasOwnProperty(o)&&(r[t.CUSTOM_PROPERTIES_FIELD_PREFIX+o]=n[o]);t.setApp(r,this.oesApp),t.setSession(r,this.oesSession),t.setHost(r,this.oesHost),t.setRelease(r,this.oesRelease),t.setEvent(r,i),N().logEvent({name:i.getName(),properties:r}),this.sequence++},t.EVENT_NAME_DELIMITER="_",t.CUSTOM_PROPERTIES_FIELD_PREFIX="Data.",t}(),R=function(){function t(){}return t.create=function(t,e,n,i,r,o){return new k(t,e,n,i,r,o)},t}(),x=n(8),V=x.IFloodgateStorageProvider.FileType,G=((U={})[V.CampaignDefinitions]="obf-CampaignDefinitions",U[V.CampaignStates]="obf-CampaignStates",U[V.FloodgateSettings]="obf-FloodgateSettings",U[V.GovernedChannelStates]="obf-GovernedChannelStates",U[V.SurveyActivationStats]="obf-SurveyActivationStats",U[V.SurveyEventActivityStats]="obf-SurveyEventActivityStats",U[V.TmsCache_CampaignContent]="obf-TmsCampaignContent",U[V.TmsCache_MessageMetadata]="obf-TmsMessageMetadata",U[V.TmsCache_UserGovernance]="obf-TmsUserGovernance",U[V.Tms_DynamicSettings]="obf-TmsDynamicSettings",U[V.LogLevelSettings]="obf-LogLevelSettings",U[V.UserFacts]="obf-UserFacts",U),z=function(){function t(){}return t.isStorageAvailable=function(){try{var t="__storage_test__";return b().localStorage.setItem(t,t),b().localStorage.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==b().localStorage.length}},t.prototype.fileLock=function(t){},t.prototype.fileUnlock=function(t){},t.prototype.read=function(t){if(!(t in V))return"";var e,n=G[t];try{e=b().localStorage.getItem(n)}catch(t){return H().logEvent(j.Survey.Floodgate.FileRead.Failed.VALUE,2,{ErrorMessage:t.toString(),FileName:n}),""}return e},t.prototype.write=function(t,e){if(t in V){var n=G[t];try{b().localStorage.setItem(n,e)}catch(t){return void H().logEvent(j.Survey.Floodgate.FileWrite.Failed.VALUE,2,{ErrorMessage:t.toString(),FileName:n})}}},t}(),q=n(2),j=function(){function t(){}var e,n,i,r,o,a,s,u,c,l,p,d,h,f,g,v,m,y,S,T,C,E,A,_,w,b,I,D,F,O,L,P,N,U,M,B,k,R,x,V,G,z,q,j,J,W,H,K;return t.InApp=((e=function(){}).UI=((n=function(){}).Picker=((i=function(){}).Shown=((r=function(){}).VALUE={name:"InApp_UI_Picker_Shown"},r),i),n.Form=((o=function(){}).Shown=((a=function(){}).VALUE={name:"InApp_UI_Form_Shown"},a),o.Submit=((s=function(){}).VALUE={name:"InApp_UI_Form_Submit"},s),o),n),e),t.Survey=((u=function(){}).UI=((c=function(){}).Prompt=((l=function(){}).Shown=((p=function(){}).VALUE={name:"Survey_UI_Prompt_Shown"},p),l),c.Form=((d=function(){}).Shown=((h=function(){}).VALUE={name:"Survey_UI_Form_Shown"},h),d.Submit=((f=function(){}).VALUE={name:"Survey_UI_Form_Submit"},f),d),c),u.Floodgate=((g=function(){}).TriggerMet=((v=function(){}).VALUE={name:"Survey_Floodgate_TriggerMet"},v),g.UserSelected=((m=function(){}).VALUE={name:"Survey_Floodgate_UserSelected"},m),g.CampaignLoad=((y=function(){}).Failed=((S=function(){}).VALUE={name:"Survey_Floodgate_CampaignLoad_Failed"},S),y),g.UserFactsLoad=((T=function(){}).Failed=((C=function(){}).VALUE={name:"Survey_Floodgate_UserFactsLoad_Failed"},C),T),g.FileWrite=((E=function(){}).Failed=((A=function(){}).VALUE={name:"Survey_Floodgate_FileWrite_Failed"},A),E),g.FileRead=((_=function(){}).Failed=((w=function(){}).VALUE={name:"Survey_Floodgate_FileRead_Failed"},w),_),g),u),t.Shared=((b=function(){}).Upload=((I=function(){}).Failed=((D=function(){}).VALUE={name:"Shared_Upload_Failed"},D),I),b.Screenshot=((F=function(){}).Render=((O=function(){}).Failed=((L=function(){}).VALUE={name:"Shared_Screenshot_Render_Failed"},L),O.Success=((P=function(){}).VALUE={name:"Shared_Screenshot_Render_Success"},P),O),F.GetContent=((N=function(){}).Failed=((U=function(){}).DefaultImage=((M=function(){}).Returned=((B=function(){}).VALUE={name:"Shared_Screenshot_GetContent_Failed_DefaultImage_Returned"},B),M),U),N),F),b),t.WebSurfaces=((k=function(){}).Common=((R=function(){}).Error=((x=function(){}).VALUE={name:"WebSurfaces_Common_Error"},x),R.Info=((V=function(){}).VALUE={name:"WebSurfaces_Common_Info"},V),R),k.Messaging=((G=function(){}).Requests=((z=function(){}).VALUE={name:"WebSurfaces_Messaging_Requests"},z),G),k),t.UserFacts=((q=function(){}).Common=((j=function(){}).Error=((J=function(){}).VALUE={name:"UserFacts_Common_Error"},J),j.Info=((W=function(){}).VALUE={name:"UserFacts_Common_Info"},W),j),q.Messaging=((H=function(){}).Requests=((K=function(){}).VALUE={name:"UserFacts_Messaging_Requests"},K),H),q),t}(),J=u,W="Office_Feedback";function H(){return M}var K=function(){function t(t){if(!t)throw new Error("telemetryLogger must not be null");this.telemetryLogger=t}return t.prototype.logEvent=function(e,n,i){if(!e)throw new Error("eventId must not be null");if(J(n)||0===n){if(0===B){this.isConsoleLogEnabled&&console&&console.log("Floodgate event: ",t.EVENT_NAME,"logSeverity must not be null or none"),this.telemetryLogger.logEvent(t.EVENT_NAME,{ErrorMessage:"logSeverity must not be null or none"})}return!1}return(i=i||{})[t.EVENT_ID]=e.name,this.isLoggingEnabled(n)&&this.telemetryLogger.logEvent(t.EVENT_NAME,i),this.isConsoleLogEnabled&&console&&console.log("Floodgate event: ",t.EVENT_NAME,n,i),!0},t.prototype.isLoggingEnabled=function(t){if(J(this.logLevel)){var e=this.getCurrentLogLevel();this.logLevel=J(e)?2:e}return t<=this.logLevel},t.prototype.getCurrentLogLevel=function(){try{var t="undefined"!=typeof URLSearchParams&&new URLSearchParams(window.location.search)||void 0;t&&t.get("obfconsolelog")&&(this.isConsoleLogEnabled=!0);var e=t&&t.get("obfloglevel");if(!J(e))return this.isConsoleLogEnabled=!0,parseInt(e,10);if(z.isStorageAvailable()){var n=(new z).read(q.FileType.LogLevelSettings);if(!J(n)){var i=this.parseObject(n);if(!J(i)&&i.content)return i.content.consoleLog&&(this.isConsoleLogEnabled=!0),i.content.logLevel}}}catch(t){return void(this.isConsoleLogEnabled&&console.log("Error while getting the current log level: ",t))}return null},t.prototype.parseObject=function(t){try{return JSON.parse(t)}catch(t){return this.isConsoleLogEnabled&&console.log("Error while parsing the json string for log level: ",t),null}},t.EVENT_NAME="SDK",t.EVENT_ID="EventId",t}(),Y=function(){function t(){}return t.getTenantToken=function(e){return 0===e?t.TENANT_TOKEN_PRODUCTION:t.TENANT_TOKEN_PRE_PRODUCTION},t.TENANT_TOKEN_PRODUCTION="d79e824386c4441cb8c1d4ae15690526-bd443309-5494-444a-aba9-0af9eef99f84-7360",t.TENANT_TOKEN_PRE_PRODUCTION="2bf6a2ffddca4a80a892a0b182132961-625cb102-8b0c-480e-af53-92e48695d08d-7736",t}(),Q="OfficeFeedbackSDK",Z=!1;function X(){if(!Z){if(!b().OfficeBrowserFeedback.initOptions)throw new Error("Window.OfficeBrowserFeedback.initOptions not set");b().OfficeBrowserFeedback.sdkVersion=r,E().setCommonInitOptions(b().OfficeBrowserFeedback.initOptions);var t,e,n,i,o,a,s,u,c=E().getCommonInitOptions();t=c.environment,e=Q,n=r,i=c.telemetryGroup?c.telemetryGroup.audienceGroup:void 0,o=c.appId.toString(),a=c.sessionId,s=c.build,u=E().getSdkSessionId(),M=new K(R.create(Y.getTenantToken(t),W,new I(e,n),new D(u),new F(o,a,s),new L(i))),B=t,Z=!0}}var $=function(){return($=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function tt(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{u(i.next(t))}catch(t){o(t)}}function s(t){try{u(i.throw(t))}catch(t){o(t)}}function u(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(a,s)}u((i=i.apply(t,e||[])).next())}))}function et(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var nt=u,it=function(t){this.contentType=t},rt=function(){function t(t){this.useLocalStorage=!1,this.initialize(t)}return t.prototype.setItem=function(t){this.cachedItems[t.contentType]=t,this.updateItemInLocalStorage(t)},t.prototype.has=function(t){return t in this.cachedItems},t.prototype.getItem=function(t){return this.cachedItems[t]},t.prototype.initialize=function(t){this.cachedItems={},z.isStorageAvailable()&&(this.floodgateStorage=new z,this.useLocalStorage=!0,this.initCachedItemsFromLocalStorage(t))},t.prototype.initCachedItemsFromLocalStorage=function(t){if(this.useLocalStorage&&!nt(t))for(var e=0,n=t;e<n.length;e++){var i=n[e],r=this.floodgateStorage.read(this.mapContentTypeToFloodgateProviderKey(i));if(!nt(r)){var o=this.parseObjectFromCache(r);nt(o)||(o.expiryDate="string"==typeof o.expiryDate?new Date(o.expiryDate):o.expiryDate,this.cachedItems[o.contentType]=o)}}},t.prototype.updateItemInLocalStorage=function(t){this.useLocalStorage&&this.floodgateStorage.write(this.mapContentTypeToFloodgateProviderKey(t.contentType),JSON.stringify(t))},t.prototype.parseObjectFromCache=function(t){try{return JSON.parse(t)}catch(t){return null}},t.prototype.mapContentTypeToFloodgateProviderKey=function(t){switch(t){case"CampaignContent":return q.FileType.TmsCache_CampaignContent;case"MessageMetadata":return q.FileType.TmsCache_MessageMetadata;case"UserGovernance":return q.FileType.TmsCache_UserGovernance;case"DynamicSettings":return q.FileType.Tms_DynamicSettings;case"LogLevelSettings":return q.FileType.LogLevelSettings;case"UserFacts":return q.FileType.UserFacts;default:throw new Error("Unmapped ContentType in TmsCache")}},t}(),ot=u,at=null;function st(t,e){if(!at&&z.isStorageAvailable()&&(at=new rt(["DynamicSettings"])),!at)return e;var n=at.getItem("DynamicSettings"),i=n&&n.content;return ot(i)||!i.hasOwnProperty(t)||ot(i[t])?e:i[t]}var ut={searchParams:"URLSearchParams"in self,iterable:"Symbol"in self&&"iterator"in Symbol,blob:"FileReader"in self&&"Blob"in self&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in self,arrayBuffer:"ArrayBuffer"in self};if(ut.arrayBuffer)var ct=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],lt=ArrayBuffer.isView||function(t){return t&&ct.indexOf(Object.prototype.toString.call(t))>-1};function pt(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function dt(t){return"string"!=typeof t&&(t=String(t)),t}function ht(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return ut.iterable&&(e[Symbol.iterator]=function(){return e}),e}function ft(t){this.map={},t instanceof ft?t.forEach((function(t,e){this.append(e,t)}),this):Array.isArray(t)?t.forEach((function(t){this.append(t[0],t[1])}),this):t&&Object.getOwnPropertyNames(t).forEach((function(e){this.append(e,t[e])}),this)}function gt(t){if(t.bodyUsed)return Promise.reject(new TypeError("Already read"));t.bodyUsed=!0}function vt(t){return new Promise((function(e,n){t.onload=function(){e(t.result)},t.onerror=function(){n(t.error)}}))}function mt(t){var e=new FileReader,n=vt(e);return e.readAsArrayBuffer(t),n}function yt(t){if(t.slice)return t.slice(0);var e=new Uint8Array(t.byteLength);return e.set(new Uint8Array(t)),e.buffer}function St(){return this.bodyUsed=!1,this._initBody=function(t){var e;this._bodyInit=t,t?"string"==typeof t?this._bodyText=t:ut.blob&&Blob.prototype.isPrototypeOf(t)?this._bodyBlob=t:ut.formData&&FormData.prototype.isPrototypeOf(t)?this._bodyFormData=t:ut.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)?this._bodyText=t.toString():ut.arrayBuffer&&ut.blob&&((e=t)&&DataView.prototype.isPrototypeOf(e))?(this._bodyArrayBuffer=yt(t.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):ut.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(t)||lt(t))?this._bodyArrayBuffer=yt(t):this._bodyText=t=Object.prototype.toString.call(t):this._bodyText="",this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):ut.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},ut.blob&&(this.blob=function(){var t=gt(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?gt(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(mt)}),this.text=function(){var t,e,n,i=gt(this);if(i)return i;if(this._bodyBlob)return t=this._bodyBlob,e=new FileReader,n=vt(e),e.readAsText(t),n;if(this._bodyArrayBuffer)return Promise.resolve(function(t){for(var e=new Uint8Array(t),n=new Array(e.length),i=0;i<e.length;i++)n[i]=String.fromCharCode(e[i]);return n.join("")}(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},ut.formData&&(this.formData=function(){return this.text().then(Et)}),this.json=function(){return this.text().then(JSON.parse)},this}ft.prototype.append=function(t,e){t=pt(t),e=dt(e);var n=this.map[t];this.map[t]=n?n+", "+e:e},ft.prototype.delete=function(t){delete this.map[pt(t)]},ft.prototype.get=function(t){return t=pt(t),this.has(t)?this.map[t]:null},ft.prototype.has=function(t){return this.map.hasOwnProperty(pt(t))},ft.prototype.set=function(t,e){this.map[pt(t)]=dt(e)},ft.prototype.forEach=function(t,e){for(var n in this.map)this.map.hasOwnProperty(n)&&t.call(e,this.map[n],n,this)},ft.prototype.keys=function(){var t=[];return this.forEach((function(e,n){t.push(n)})),ht(t)},ft.prototype.values=function(){var t=[];return this.forEach((function(e){t.push(e)})),ht(t)},ft.prototype.entries=function(){var t=[];return this.forEach((function(e,n){t.push([n,e])})),ht(t)},ut.iterable&&(ft.prototype[Symbol.iterator]=ft.prototype.entries);var Tt=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function Ct(t,e){var n,i,r=(e=e||{}).body;if(t instanceof Ct){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new ft(t.headers)),this.method=t.method,this.mode=t.mode,this.signal=t.signal,r||null==t._bodyInit||(r=t._bodyInit,t.bodyUsed=!0)}else this.url=String(t);if(this.credentials=e.credentials||this.credentials||"same-origin",!e.headers&&this.headers||(this.headers=new ft(e.headers)),this.method=(n=e.method||this.method||"GET",i=n.toUpperCase(),Tt.indexOf(i)>-1?i:n),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function Et(t){var e=new FormData;return t.trim().split("&").forEach((function(t){if(t){var n=t.split("="),i=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(i),decodeURIComponent(r))}})),e}function At(t,e){e||(e={}),this.type="default",this.status=void 0===e.status?200:e.status,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in e?e.statusText:"OK",this.headers=new ft(e.headers),this.url=e.url||"",this._initBody(t)}Ct.prototype.clone=function(){return new Ct(this,{body:this._bodyInit})},St.call(Ct.prototype),St.call(At.prototype),At.prototype.clone=function(){return new At(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new ft(this.headers),url:this.url})},At.error=function(){var t=new At(null,{status:0,statusText:""});return t.type="error",t};var _t=[301,302,303,307,308];At.redirect=function(t,e){if(-1===_t.indexOf(e))throw new RangeError("Invalid status code");return new At(null,{status:e,headers:{location:t}})};var wt=self.DOMException;try{new wt}catch(t){(wt=function(t,e){this.message=t,this.name=e;var n=Error(t);this.stack=n.stack}).prototype=Object.create(Error.prototype),wt.prototype.constructor=wt}function bt(t,e){return new Promise((function(n,i){var r=new Ct(t,e);if(r.signal&&r.signal.aborted)return i(new wt("Aborted","AbortError"));var o=new XMLHttpRequest;function a(){o.abort()}o.onload=function(){var t,e,i={status:o.status,statusText:o.statusText,headers:(t=o.getAllResponseHeaders()||"",e=new ft,t.replace(/\r?\n[\t ]+/g," ").split(/\r?\n/).forEach((function(t){var n=t.split(":"),i=n.shift().trim();if(i){var r=n.join(":").trim();e.append(i,r)}})),e)};i.url="responseURL"in o?o.responseURL:i.headers.get("X-Request-URL");var r="response"in o?o.response:o.responseText;n(new At(r,i))},o.onerror=function(){i(new TypeError("Network request failed"))},o.ontimeout=function(){i(new TypeError("Network request failed"))},o.onabort=function(){i(new wt("Aborted","AbortError"))},o.open(r.method,r.url,!0),"include"===r.credentials?o.withCredentials=!0:"omit"===r.credentials&&(o.withCredentials=!1),"responseType"in o&&ut.blob&&(o.responseType="blob"),r.headers.forEach((function(t,e){o.setRequestHeader(e,t)})),r.signal&&(r.signal.addEventListener("abort",a),o.onreadystatechange=function(){4===o.readyState&&r.signal.removeEventListener("abort",a)}),o.send(void 0===r._bodyInit?null:r._bodyInit)}))}bt.polyfill=!0,self.fetch||(self.fetch=bt,self.Headers=ft,self.Request=Ct,self.Response=At);var It=u,Dt=function(){function t(t){this.sessionId=t}return t.prototype.sendGetRequest=function(t,e){return tt(this,void 0,void 0,(function(){return et(this,(function(n){return[2,this.timeoutFetch(t,{method:"GET",headers:this.createHeaders(e)})]}))}))},t.prototype.sendPostRequest=function(t,e,n){return tt(this,void 0,void 0,(function(){return et(this,(function(i){return[2,fetch(t,{method:"POST",headers:this.createHeaders(n),body:e})]}))}))},t.prototype.timeoutFetch=function(t,e){return void 0===e&&(e={}),new Promise((function(n,i){fetch(t,e).then(n,i),setTimeout((function(){return i(new Error("Service request timed out"))}),5e3)}))},t.prototype.createHeaders=function(t){var e="undefined"!=typeof Headers&&new Headers;return e&&(It(t)||e.append("Authorization","Bearer "+t),e.append("X-CorrelationId",a()),this.sessionId&&e.append("X-UserSessionId",this.sessionId)),e},t}();function Ft(t,e){void 0===e&&(e=!0);var n="";for(var i in t||[])if(t.hasOwnProperty(i)){var r=t[i];if(null!=r&&"object"!=typeof r)n+=(n?"&":"")+(i+"="+(e?encodeURIComponent(r):r))}return n}var Ot,Lt=u,Pt=function(){},Nt=function(){function t(t,e,n,i,r,o,a,s,u,c){this.locale="en-us",this.country="US",this.locale=i,this.country=r,this.authTokenCallback=a,this.app=t,this.platform=e,this.version=n,this.sessionId=o,this.campaignFlights=s,this.campaignParameters=u,this.tmsgCache=this.tmsgCache||c||new rt(["MessageMetadata","UserGovernance","CampaignContent","DynamicSettings","LogLevelSettings","UserFacts"])}return t.prototype.getContent=function(t){return tt(this,void 0,void 0,(function(){return et(this,(function(e){switch(e.label){case 0:return[4,this.refreshItemsInCacheFromTmsService([t])];case 1:return e.sent(),[2,this.retrieveCacheItemAndCreateContentResponse(t)]}}))}))},t.prototype.getMultipleContents=function(t){return tt(this,void 0,void 0,(function(){var e,n,i,r,o,a,s;return et(this,(function(u){switch(u.label){case 0:return[4,this.refreshItemsInCacheFromTmsService(t)];case 1:for(u.sent(),e=new Array,n=new Array,i=0,r=t;i<r.length;i++)o=r[i],a=this.tmsgCache.getItem(o),s=this.createContentResponse(o,a),e.push(s);return this.refreshItemsInCacheFromTmsService(n),[2,e]}}))}))},t.prototype.getUserFactsContent=function(t){return tt(this,void 0,void 0,(function(){return et(this,(function(e){switch(e.label){case 0:return[4,this.refreshItemsInCacheFromTulipsService(t)];case 1:return e.sent(),[2,this.retrieveCacheItemAndCreateContentResponse(t)]}}))}))},t.prototype.sendBeaconRequestToService=function(t,e,n,i,r,o,a,s){return tt(this,void 0,void 0,(function(){var u,c,l,p,d,h;return et(this,(function(f){switch(f.label){case 0:return this.sessionId=a,this.authTokenCallback=s,[4,this.getAuthToken(y.TMSAppID)];case 1:return u=f.sent(),c=void 0,u?[3,4]:(l=this.authTokenCallback.getUserPuid)?[4,this.authTokenCallback.getUserPuid()]:[3,3];case 2:l=f.sent(),f.label=3;case 3:c=l,f.label=4;case 4:return f.trys.push([4,6,,7]),p=$($({app:t},e),{country:o,locale:r,platform:n,puid:c,version:i}),[4,this.sendRequest(p,u,"TmsActionUrl","https://messaging.office.com/lifecycle/SetCampaignAction?")];case 5:return(d=f.sent())&&200===d.status||H().logEvent(j.WebSurfaces.Common.Error.VALUE,2,this.createTelemetryData(d,"Beacon")),[3,7];case 6:return h=f.sent(),H().logEvent(j.WebSurfaces.Common.Error.VALUE,2,$({ErrorMessage:"Error fetching from TMS SetCampaignAction endpoint"+(h&&h.message?": "+h.message:"")},this.createTelemetryData(null,"Beacon"))),[3,7];case 7:return[2]}}))}))},t.prototype.createTelemetryData=function(t,e){var n=+new Date,i=t||{},r=i.headers,o=i.status,a=i.statusText,s=r&&r.get("X-UserSessionId"),u=r&&r.get("X-CorrelationId");return{Type:e,TimeMilliseconds:+new Date-n,SessionId:s||this.sessionId,CorrelationId:u||void 0,HttpStatusCode:o||void 0,HttpStatusText:a||void 0}},t.prototype.sendRequest=function(t,e,n,i){return tt(this,void 0,void 0,(function(){var r,o;return et(this,(function(a){switch(a.label){case 0:return this.tmsgTransport=this.tmsgTransport||new Dt(this.sessionId),r=Ft(t),o=st(n,i),[4,this.tmsgTransport.sendGetRequest(o+r,e)];case 1:return[2,a.sent()]}}))}))},t.prototype.retrieveCacheItemAndCreateContentResponse=function(t){var e=this.tmsgCache.getItem(t),n=this.createContentResponse(t,e);return(Lt(e)||e.expiryDate.getMilliseconds()>Date.now())&&("UserFacts"===t?this.refreshItemsInCacheFromTulipsService(t):this.refreshItemsInCacheFromTmsService([t])),n},t.prototype.createContentResponse=function(t,e){var n=new Pt;return n.content=void 0!==e?e.content:null,n.contentType=t,n},t.prototype.createCacheItem=function(t,e,n){var i=new it(e);return i.content=t,i.lastRetrievedDate=new Date,i.expiryDate=new Date(Date.now()+n),i},t.prototype.getAuthToken=function(t){return tt(this,void 0,void 0,(function(){var e,n,i,r,o,a=this;return et(this,(function(s){switch(s.label){case 0:if(!this.authTokenCallback||!this.authTokenCallback.getAuthToken)return[2,null];e=+new Date,n=function(){return+new Date-e},i=function(e){return void 0===e&&(e=void 0),{ErrorMessage:e,SessionId:a.sessionId,TimeMilliseconds:n(),Type:t}},s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.authTokenCallback.getAuthToken(t)];case 2:return r=s.sent(),H().logEvent(j.WebSurfaces.Common.Info.VALUE,3,i()),[2,r];case 3:return o=s.sent(),H().logEvent(j.WebSurfaces.Common.Error.VALUE,2,i("Error getting token "+(o&&o.message?": "+o.message:""))),[3,4];case 4:return[2,null]}}))}))},t.prototype.refreshItemsInCacheFromTmsService=function(t){return tt(this,void 0,void 0,(function(){var e,n,i,r,o,a,s,u,c,l,p,d,h,f;return et(this,(function(g){switch(g.label){case 0:if(0===t.length)return[2];for(e=new Array,n=0,i=t;n<i.length;n++)r=i[n],o=this.tmsgCache.getItem(r),(Lt(o)||!o.expiryDate||o.expiryDate.getMilliseconds()>Date.now())&&e.push(r);return 0===e.length?[2]:[4,this.getAuthToken(y.TMSAppID)];case 1:return a=g.sent(),s=void 0,a?[3,4]:(u=this.authTokenCallback.getUserPuid)?[4,this.authTokenCallback.getUserPuid()]:[3,3];case 2:u=g.sent(),g.label=3;case 3:s=u,g.label=4;case 4:return g.trys.push([4,9,,10]),c=document&&(document.documentElement||document.getElementsByTagName("body")[0]),l={hasStorage:z.isStorageAvailable(),pageWidth:window.innerWidth||c.clientWidth,pageHeight:window.innerHeight||c.clientHeight,screenWidth:screen?screen.width:void 0,screenHeight:screen?screen.height:void 0,colorDepth:screen?screen.colorDepth:void 0},p={country:this.country,locale:this.locale,app:this.app,platform:this.platform,version:this.version,campaignParams:Ft(l)+"&more=true&"+(this.campaignParameters||""),contentType:t.join(";"),puid:s,OFC_FLIGHTS:this.campaignFlights},[4,this.sendRequest(p,a,"TmsServiceUrl","https://messaging.office.com/lifecycle/CampaignMetadataAggregator?")];case 5:return 200!==(d=g.sent()).status?[3,7]:[4,d.json()];case 6:return h=g.sent(),-1!==t.indexOf("MessageMetadata")&&void 0!==h.MessageMetadata&&this.tmsgCache.setItem(this.createCacheItem(h.MessageMetadata,"MessageMetadata",144e5)),-1!==t.indexOf("UserGovernance")&&void 0!==h.UserGovernanceRules&&this.tmsgCache.setItem(this.createCacheItem(h.UserGovernanceRules,"UserGovernance",144e5)),-1!==t.indexOf("CampaignContent")&&void 0!==h.CampaignContent&&this.tmsgCache.setItem(this.createCacheItem(h.CampaignContent,"CampaignContent",144e5)),-1!==t.indexOf("DynamicSettings")&&void 0!==h.DynamicSettings&&this.tmsgCache.setItem(this.createCacheItem(h.DynamicSettings,"DynamicSettings",144e5)),-1!==t.indexOf("LogLevelSettings")&&void 0!==h.LogLevelSettings&&this.tmsgCache.setItem(this.createCacheItem(h.LogLevelSettings,"LogLevelSettings",144e5)),H().logEvent(j.WebSurfaces.Messaging.Requests.VALUE,3,this.createTelemetryData(d,t.join(";"))),[3,8];case 7:H().logEvent(j.WebSurfaces.Common.Error.VALUE,2,this.createTelemetryData(d,t.join(";"))),g.label=8;case 8:return[3,10];case 9:return f=g.sent(),H().logEvent(j.WebSurfaces.Common.Error.VALUE,2,$({ErrorMessage:"Error fetching from TMS"+(f&&f.message?": "+f.message:"")},this.createTelemetryData(null,t.join(";")))),[3,10];case 10:return[2]}}))}))},t.prototype.refreshItemsInCacheFromTulipsService=function(t){return tt(this,void 0,void 0,(function(){var e,n,i,r,o,a,s;return et(this,(function(u){switch(u.label){case 0:return e=!1,n=this.tmsgCache.getItem(t),(Lt(n)||!n.expiryDate||n.expiryDate.getMilliseconds()>Date.now())&&(e=!0),!1===e?[2]:[4,this.getAuthToken(y.TULIPSAppID)];case 1:if(!(i=u.sent()))return[2];u.label=2;case 2:return u.trys.push([2,7,,8]),[4,this.sendRequest({},i,"TulipsServiceUrl","https://substrate.office.com/OfficePersonalizationUserLifecycle/api/facts")];case 3:return 200!==(r=u.sent()).status&&204!==r.status?[3,5]:[4,r.json()];case 4:return o=u.sent(),-1!==t.indexOf("UserFacts")&&void 0!==o&&(a=this.addClientIngestionTimeAndNormalizeKeys(o),this.tmsgCache.setItem(this.createCacheItem(a,"UserFacts",864e5))),H().logEvent(j.UserFacts.Messaging.Requests.VALUE,3,this.createTelemetryData(r,t)),[3,6];case 5:H().logEvent(j.UserFacts.Common.Error.VALUE,2,this.createTelemetryData(r,t)),u.label=6;case 6:return[3,8];case 7:return s=u.sent(),H().logEvent(j.UserFacts.Common.Error.VALUE,2,$({ErrorMessage:"Error fetching from TULIPS"+(s&&s.message?": "+s.message:"")},this.createTelemetryData(null,t))),[3,8];case 8:return[2]}}))}))},t.prototype.addClientIngestionTimeAndNormalizeKeys=function(t){var e=this,n=new Date(Date.now()).toISOString();return t.map((function(t){var i=e.normalizeKeys(t);return i.clientIngestionDateTime=n,i}))},t.prototype.normalizeKeys=function(t){for(var e={},n=0,i=Object.keys(t);n<i.length;n++){var r=i[n];e[r.charAt(0).toLowerCase()+r.substring(1)]=t[r]}return e},t}(),Ut=u,Mt=function(){function t(){this.configuration=E();var t=this.configuration&&this.configuration.getFloodgateInitOptions(),e=t&&t.authTokenCallback;if(e&&(e.getAuthToken||e.getUserPuid)){var n=this.configuration.getCommonInitOptions();this.tmsgClient=new Nt(n.appId.toString(),"Web",n.build,n.originalLocale,this.extractCountryFromLocale(n.originalLocale),this.configuration.getSdkSessionId(),t.authTokenCallback,t.campaignFlights,t.campaignQueryParameters)}}return t.prototype.getCampaignDefinitions=function(){return this.tmsgClient?this.tmsgClient.getContent("CampaignContent").then((function(t){return t.content})):Promise.resolve(null)},t.prototype.getUserGovernanceRules=function(){return this.tmsgClient?this.tmsgClient.getContent("UserGovernance").then((function(t){return t.content})):Promise.resolve(null)},t.prototype.getMessageMetadata=function(){return this.tmsgClient?this.tmsgClient.getContent("MessageMetadata").then((function(t){return t.content})):Promise.resolve(null)},t.prototype.getUserFacts=function(){return this.tmsgClient?this.tmsgClient.getUserFactsContent("UserFacts").then((function(t){return t.content})):Promise.resolve(null)},t.prototype.setCampaignAction=function(t){if(this.tmsgClient){var e=this.configuration.getCommonInitOptions(),n=this.configuration.getFloodgateInitOptions();this.tmsgClient.sendBeaconRequestToService(e.appId.toString(),t,"Web",e.build,e.originalLocale,this.extractCountryFromLocale(e.originalLocale),this.configuration.getSdkSessionId(),n.authTokenCallback)}},t.prototype.extractCountryFromLocale=function(t){if(!Ut(t)){var e=t.split("-");return 2===e.length?e[1]:void 0}},t}();function Bt(){return Ot||(Ot=new Mt),Ot}var kt=o.Utils.isNOU,Rt=function(){function t(){}return t.prototype.makeSurveyLauncher=function(t){return this.AcceptsSurvey(t)?new xt(t):null},t.prototype.AcceptsSurvey=function(e){return!kt(e)&&e.getType()===o.Api.ISurvey.Type.GenericMessagingSurface&&e.getLauncherType().toLocaleLowerCase()===t.LAUNCHER_TYPE},t.LAUNCHER_TYPE="coachingux",t}(),xt=function(){function t(t){this.survey=t}return t.prototype.launch=function(){var t=this.survey&&this.survey.getSurveyInfo(),e=t&&t.getMetadata(),n=e&&e.getContentMetadata();if(n){var i,r,o=new Date,a=function(){var t=b();return t&&t.OfficeWebSurfaces},s=function(e){var i=a();e&&i.Initialize(e),i.RemoveSurface(),i.RenderSurface(n,null,t.getBackEndId())},u=function(t){H().logEvent(j.WebSurfaces.Common.Error.VALUE,1,{ErrorMessage:"Error loading websurfaces"+(t&&t.message?": "+t.message:""),TimeMilliseconds:Date.now()-+o})};try{if(a())return void s();(i=st("WebSurfacesLink",m.WebSurfacesLink),r=null,void 0===r&&(r=window.origin),new Promise((function(t,e){var n=document.createElement("script");n.async=!0,n.readyState?n.onreadystatechange=function(){"loaded"!==n.readyState&&"complete"!==n.readyState||(n.onreadystatechange=null,t())}:n.onload=function(){t()},n.onerror=function(){e()},n.src=i,r&&"null"!==r&&(n.crossOrigin="anonymous");var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o)}))).then((function(){var e=E().getCommonInitOptions(),n=$($({},e),{beaconCallback:function(t){t&&Bt().setCampaignAction(t)},surfaceInitTime:o,surfaceId:t.getBackEndId(),logSessionId:E().getSdkSessionId(),logSettings:st("LogLevelSettings",void 0)});s(n)})).catch((function(t){u(t)}))}catch(t){u(t)}}},t}(),Vt=function(){function t(t){if(this.showPrompt=!0,this.showEmailRequest=!1,!t)throw Error("survey must not be null");this.survey=t;var e=t.getComponent("Prompt"),n=t.getComponent("Comment"),i=t.getComponent("Rating");if(!e)throw Error("prompt component must not be null");if(this.prompt=e,this.showEmailRequest=t.getSurveyInfo().isAdditionalDataRequested(0),!n)throw Error("comment component must not be null");if(this.comment=n,!i)throw Error("rating component must not be null");this.rating=i}return t.prototype.getPromptQuestion=function(){return this.prompt.getQuestion()},t.prototype.getTitle=function(){return this.prompt.getTitle()},t.prototype.getPromptYesButtonText=function(){return this.prompt.getYesButtonText()},t.prototype.getPromptNoButtonText=function(){return this.prompt.getNoButtonText()},t.prototype.getRatingValuesAscending=function(){return this.rating.getRatingValuesAscending()},t.prototype.getRatingQuestion=function(){return this.rating.getQuestion()},t.prototype.getCommentQuestion=function(){return this.comment.getQuestion()},t.prototype.setValues=function(t,e){this.rating.setSelectedRatingIndex(t),this.comment.setSubmittedText(e)},t.prototype.getJsonElements=function(){return this.survey.getJsonElements()},t.prototype.getSurveyType=function(){return this.survey.getType()},t.prototype.getCampaignId=function(){return this.survey.getSurveyInfo().getBackEndId()},t.prototype.getId=function(){return this.survey.getSurveyInfo().getId()},t}(),Gt=o.Utils.isNOU,zt=function(){function t(){}return t.prototype.makeSurveyLauncher=function(t){return this.AcceptsSurvey(t)?new qt(t):null},t.prototype.AcceptsSurvey=function(t){return!Gt(t)&&t.getType()!==o.Api.ISurvey.Type.GenericMessagingSurface},t.LAUNCHER_TYPE=o.Api.ISurvey.LAUNCHER_TYPE_DEFAULT,t}(),qt=function(){function t(t){this.survey=t}return t.prototype.launch=function(){b().OfficeBrowserFeedback.floodgate.showSurvey(new Vt(this.survey))},t}(),jt=o.Utils.isNOU,Jt=function(){function t(t,e){this.rudeSurveyLauncherFactory=t,this.coachingUXLauncherFactory=e}return t.make=function(){return new t(new zt,new Rt)},t.prototype.makeSurveyLauncher=function(t){if(jt(t))return null;switch(t.getLauncherType().toLocaleLowerCase()){case Rt.LAUNCHER_TYPE:return this.makeGenericMessagingSurfaceLauncher(t);case zt.LAUNCHER_TYPE:default:return this.makeRudeSurveyLauncher(t)}},t.prototype.AcceptsSurvey=function(t){if(jt(t))return!1;switch(t.getLauncherType().toLocaleLowerCase()){case Rt.LAUNCHER_TYPE:return!jt(this.coachingUXLauncherFactory)&&this.coachingUXLauncherFactory.AcceptsSurvey(t);case zt.LAUNCHER_TYPE:default:return!jt(this.rudeSurveyLauncherFactory)&&this.rudeSurveyLauncherFactory.AcceptsSurvey(t)}},t.prototype.makeGenericMessagingSurfaceLauncher=function(t){return jt(this.coachingUXLauncherFactory)?null:this.coachingUXLauncherFactory.makeSurveyLauncher(t)},t.prototype.makeRudeSurveyLauncher=function(t){return jt(this.rudeSurveyLauncherFactory)?null:this.rudeSurveyLauncherFactory.makeSurveyLauncher(t)},t}(),Wt=4e3;var Ht="https://petrol-int.office.microsoft.com/v1/feedback",Kt="https://petrol.office.microsoft.com/v1/feedback";function Yt(t,e,n,i){if(void 0===e)return Promise.reject(new Error("Manifest cannot be undefined"));var r,o,a,s,u,c=new FormData;return c.append("Manifest",e),n&&c.append("Screenshot",n),i&&c.append("Diagnostics",i),r="POST",o=t?Kt:Ht,a=c,s=function(t,e,n){200!==t.status&&n(new Error("Non-200 response with status code: "+t.status+", response: "+t.responseText)),e()},(u=function(t){return new Promise((function(e,n){var i=new XMLHttpRequest;i.open(r,o,!0),i.timeout=Wt,i.onload=function(){s(i,e,n)},i.ontimeout=function(){t>0?u(t-1).then(e,n):n(new Error("Request to '"+o+"' timed out. timeout: "+Wt))},i.onerror=function(){t>0?u(t-1).then(e,n):n(new Error("Request to '"+o+"' errored. "+i.status+": "+i.responseText))},i.send(a)}))})(2)}var Qt=function(){function t(t){this.screenshot=t}return t.prototype.getContent=function(){var t;try{t=this.screenshot.toDataURL("image/jpeg").split(",")[1]}catch(e){H().logEvent(j.Shared.Screenshot.GetContent.Failed.DefaultImage.Returned.VALUE,2,{ErrorMessage:e.toString()}),t="iVBORw0KGgoAAAANSUhEUgAAAN0AAAA+AQMAAACV2ox1AAAABGdBTUEAALGPC/xhBQAAAAZQTFRFAAAA////pdmf3QAAAAlwSFlzAAAOwgAADsIBFShKgAAAAjtJREFUSMfV1M1rE0EUAHDBa5r8A9vkL6giFiI0JH+Ih9KLx8TaukkJugShHgrJzYvkVPQkUqgwSePLEELaU+zBg8JKVvSQQNydlsadwCQzziRZ82ETxYMfc3gD8+MxjzcfV8T80f0vkQ8i68tAPSMSQ0PkI6QDpEPkZBHy1Wp1/zjni2lrZq2T2uikDG17A54Hr0vsvwXIl3WXt02zeIHQBSq3DxHk7VO55zIFgLLrcmaaQBGiqCwQArBVQTbNZODNBB5Ee2EEr5eGiDG4k5mcqcy+Ksh+N8K2+bRI1Z68fRMVoV+XmcFwpQJZGohpkds1WtjppGLaq51a2b8yp310UW9/H8VfRj68CIKRsWCFPCCEM419S4bSAOmPmdb3TBrQ4lmnt9n4/Hiv5fTunsOzXbJfLR2rU3Fd5ugOe9mw0lvNOCNxyDdIHkpHCv0S3a+MS0yT+4wkAKx1gBJeVxeMRhSeNZpXJfY+zqAVl+g0mCFRJMgs6oy9+MCMrWZaJJwiWFjuWcIShf+Wk2W9e59OHu21WPdsswZNLKs9wV77mJiaMVbBQ+/1jGZDofFLuOBU/jzG6OQKnkLOZ5EvwolMX2Q19TAX9MWyy/aNarewfZptechdLn8B3TatB/YXB2j4MKw3jTHKX4AO0CbqaSddMokHUbr0PpSXmFG4O4WIu86asCVihfoM6nUmse5gGkbJOyThVesX4UI0d00LBYMr55VuIZl8MkY1uOiTy9v3c+ShuXj5+NdQdL8B+5gmw8WZuREAAAAASUVORK5CYII="}for(var e=atob(t),n=[],i=0;i<e.length;i++)n.push(e.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})},t}(),Zt=function(){function t(t,e,n,i,r,o,a,s){this.manifestData={appId:e,application:o,clientFeedbackId:r,manifestType:t,source:"Client",submitTime:n,telemetry:a,type:Xt(i),web:s}}return t.prototype.setComment=function(t){this.manifestData.comment=t},t.prototype.setEmail=function(t){this.manifestData.email=t},t.prototype.setCategory=function(t){this.manifestData.telemetry=this.manifestData.telemetry||{},this.manifestData.telemetry.featureArea=t},t.prototype.setValues=function(t){if(t)for(var e in t)t.hasOwnProperty(e)&&(this.manifestData.hasOwnProperty(e)?this.manifestData[e]=s(t[e],this.manifestData[e]):this.manifestData[e]=t[e])},t.prototype.getContent=function(){return new Blob([JSON.stringify(this.manifestData)],{type:"application/json"})},t}();function Xt(t){return"Survey"===t?t:i[t]}var $t,te=function(){function t(t,e,n,i,r,o,s){this.manifest=new Zt(e,n,(new Date).toISOString(),i,a(),r,o,s),this.environment=t}return t.prototype.setComment=function(t){this.manifest.setComment(t)},t.prototype.setEmail=function(t){this.manifest.setEmail(t)},t.prototype.setCategory=function(t){this.manifest.setCategory(t)},t.prototype.setScreenshot=function(t){this.screenshot=new Qt(t)},t.prototype.setManifestValues=function(t){this.manifest.setValues(t)},t.prototype.submit=function(){var t=this.manifest.getContent(),e=void 0;return this.screenshot&&(e=this.screenshot.getContent()),Yt(0===this.environment,t,e).catch((function(t){E().getCommonInitOptions().onError("Payload submission failed: "+t.message),H().logEvent(j.Shared.Upload.Failed.VALUE,2,{ErrorMessage:t.message})}))},t}(),ee=function(){function t(){}return t.prototype.makeTransporter=function(t){return new te(E().getCommonInitOptions().environment,t,E().getCommonInitOptions().appId,"Survey",E().getCommonInitOptions().applicationGroup,E().getCommonInitOptions().telemetryGroup,E().getCommonInitOptions().webGroup)},t}(),ne=function(){function t(){}return t.prototype.getLanguage=function(){return E().getCommonInitOptions().originalLocale},t}();var ie,re,oe,ae,se,ue=function(){function t(){}return t.prototype.loadStringResource=function(t){var e=$t;switch(t){case 5:return e.Floodgate.Nps.Rating.Points11Value0;case 6:return e.Floodgate.Nps.Rating.Points11Value1;case 7:return e.Floodgate.Nps.Rating.Points11Value2;case 8:return e.Floodgate.Nps.Rating.Points11Value3;case 9:return e.Floodgate.Nps.Rating.Points11Value4;case 10:return e.Floodgate.Nps.Rating.Points11Value5;case 11:return e.Floodgate.Nps.Rating.Points11Value6;case 12:return e.Floodgate.Nps.Rating.Points11Value7;case 13:return e.Floodgate.Nps.Rating.Points11Value8;case 14:return e.Floodgate.Nps.Rating.Points11Value9;case 15:return e.Floodgate.Nps.Rating.Points11Value10;case 16:return e.Floodgate.Nps.Rating.Points5Value1;case 17:return e.Floodgate.Nps.Rating.Points5Value2;case 18:return e.Floodgate.Nps.Rating.Points5Value3;case 19:return e.Floodgate.Nps.Rating.Points5Value4;case 20:return e.Floodgate.Nps.Rating.Points5Value5;case 4:return e.Floodgate.Nps.Rating.Question;case 21:return e.Floodgate.Nps.Comment.Question;case 3:return e.Floodgate.Nps.Prompt.No;case 1:return e.Floodgate.Nps.Prompt.Question;case 0:return e.Floodgate.Nps.Prompt.Title;case 2:return e.Floodgate.Nps.Prompt.Yes;default:return""}},t.prototype.getCustomString=function(t){return E().getFloodgateInitOptions().uIStringGetter(t)},t}(),ce=n(6),le=function(){function t(){this.loadAsyncTriggered=!1,this.campaignDefinitions=[]}return t.prototype.load=function(){return this.loadAsyncTriggered||(this.loadAsync(),this.loadAsyncTriggered=!0),this.campaignDefinitions||[]},t.prototype.loadAsync=function(){var t=this,e=Bt().getCampaignDefinitions();e.then((function(e){t.loadCampaignDefinitions(e),t.loadAsyncTriggered=!0}));var n=v(st("TmsLoadTimeout",1e3),e);return new Promise((function(e,i){n.then((function(n){t.loadCampaignDefinitions(n),t.loadAsyncTriggered=!0,e(t.campaignDefinitions)})).catch((function(n){e(t.campaignDefinitions)}))}))},t.prototype.loadCampaignDefinitions=function(t){var e=t&&t.campaigns;e&&(this.campaignDefinitions=Object(ce.FilterValidCampaignDefinitions)(e).result)},t}(),pe=function(){function t(){this.loadAsyncTriggered=!1,this.userFacts=[],this.nameAndUserFactMap={}}return t.prototype.load=function(){return this.loadAsyncTriggered||(this.loadAsync(),this.loadAsyncTriggered=!0),this.userFacts||[]},t.prototype.loadAsync=function(){var t=this,e=Bt().getUserFacts().then((function(e){t.loadUserFacts(e)}));return v(st("TulipsLoadTimeout",1e3),e).then((function(){return t.userFacts})).catch((function(){return t.userFacts}))},t.prototype.getUserFact=function(t){return this.nameAndUserFactMap[t]},t.prototype.loadUserFacts=function(t){var e=this;t&&(this.userFacts=t||[],this.userFacts.map((function(t){e.nameAndUserFactMap[t.userFactName]=t})),this.loadAsyncTriggered=!0)},t}(),de=n(3),he=!1,fe=0,ge=null,ve=null,me=null;function ye(t){ge=t}function Se(){return ge}function Te(t,e){if(void 0===e&&(e=null),ge)return ge;fe++;var n=new Promise((function(n,i){var r=function(t){var e=o.FloodgateEngine.getTelemetryLogger();e&&e.log_Event(de.TelemetryEvent.Floodgate.Start.Failed,{Count:fe,ErrorMessage:t}),i(t)};try{if(!e&&!ve){var a=E().getFloodgateInitOptions();a&&a.authTokenCallback&&(ve=new le,me=new pe)}if(!(ie=e||o.FloodgateEngine.make(E().getCommonInitOptions().build||"",Jt.make(),E().getFloodgateInitOptions().onSurveyActivatedCallback,new z,E().getFloodgateInitOptions().settingStorageCallback,re||new ue,new ne,new ee,[ve],me)))return ye(null),void r("Failed to create floodgate engine");if(t||fe>1)ie.start(),n();else{var s=ie.startAsync();if(!s)return ye(null),void r("Failed to get floodgate engine");s.then((function(){n()})).catch((function(t){ye(null),r("Failed to start floodgate engine: "+(t&&t.message))}))}}catch(t){ye(null),r("Failed to start floodgate engine: "+(t&&t.toString()))}}));return ye(n),n.catch((function(t){ye(null)})),n}function Ce(t){return void 0===t&&(t=!1),Te(t)}function Ee(){ie&&ie.stop(),ye(null)}function Ae(){fe=0,ge=null,ie=null,ve=null,me=null}oe=function(){return ie},w.getEngine=oe,ae=Ce,w.start=ae,se=Ee,w.stop=se;var _e=function(){function t(){this.SAMPLING_PERCENTAGE=1,this.SAMPLING_RANGE=100,this.SAMPLING_RESULT=Math.floor(Math.random()*this.SAMPLING_RANGE)}return t.prototype.log_TriggerMet=function(t,e,n){H().logEvent(j.Survey.Floodgate.TriggerMet.VALUE,1,{CampaignId:t,SurveyId:e,SurveyType:n})},t.prototype.log_UserSelected=function(t,e,n){this.isLoggingSignalUnsampled()&&H().logEvent(j.Survey.Floodgate.UserSelected.VALUE,1,{CampaignId:t,SurveyId:e,SurveyType:n})},t.prototype.log_CampaignLoad_Failed=function(t){H().logEvent(j.Survey.Floodgate.CampaignLoad.Failed.VALUE,2,{ErrorMessage:t})},t.prototype.log_Error=function(t,e){var n={name:t};H().logEvent(n,2,{ErrorMessage:e})},t.prototype.log_Event=function(t,e){var n={name:t};H().logEvent(n,1,e)},t.prototype.isLoggingSignalUnsampled=function(){return this.SAMPLING_RESULT<this.SAMPLING_PERCENTAGE},t}();n.d(e,"initialize",(function(){return Ie})),n.d(e,"reset",(function(){return De})),n.d(e,"getEngineStartPromise",(function(){return Se})),n.d(e,"resetEngine",(function(){return Ae})),n.d(e,"setEngineStartPromise",(function(){return ye})),n.d(e,"start",(function(){return Ce})),n.d(e,"startInternal",(function(){return Te})),n.d(e,"stop",(function(){return Ee}));var we,be=function(){function t(){}return t.prototype.loadStringResource=function(t){return"na"},t.prototype.getCustomString=function(t){return"na"},t}();function Ie(){return new Promise((function(t,e){var n=function(t){var n=o.FloodgateEngine.getTelemetryLogger();n&&n.log_Event(de.TelemetryEvent.Floodgate.Initialize.Failed,{ErrorMessage:t}),e(t)};if(he)t();else{try{X()}catch(t){return void n("CommonApp initialization failed: {"+t+"}")}o.FloodgateEngine.setTelemetryLogger(new _e);try{i=new be,re=i,function(){if(!z.isStorageAvailable())throw new Error("window.localStorage is not available.");b().OfficeBrowserFeedback.floodgate=b().OfficeBrowserFeedback.floodgate||{};var t=b().OfficeBrowserFeedback.floodgate.initOptions;if(void 0!==(t=t||{}).campaignDefinitions){var e=Object(ce.FilterValidCampaignDefinitions)(t.campaignDefinitions);if(e.error)throw new Error("floodgate.initOptions.campaignDefinitions error: "+e.error);(new z).write(x.IFloodgateStorageProvider.FileType.CampaignDefinitions,JSON.stringify(t.campaignDefinitions))}E().setFloodgateInitOptions(b().OfficeBrowserFeedback.floodgate.initOptions),he=!0}()}catch(t){return void n("CommonFloodgate initialization failed: {"+t+"}")}var i;t()}}))}function De(){Z=!1,he=!1,Ae()}we=Ie,w.initialize=we}]);
//# sourceMappingURL=officebrowserfeedback_floodgate_bare.min.js.map